var __LiteMol_Core=function(){"use strict";/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   3.2.1
 */
var t=function(t){"use strict";function e(t){return typeof t==="function"||typeof t==="object"&&t!==null}function r(t){return typeof t==="function"}function n(t){return typeof t==="object"&&t!==null}var i;if(!Array.isArray){i=function(t){return Object.prototype.toString.call(t)==="[object Array]"}}else{i=Array.isArray}var o=i;var s=0;var a;var u;var c=function t(e,r){x[s]=e;x[s+1]=r;s+=2;if(s===2){if(u){u(C)}else{I()}}};function f(t){u=t}function h(t){c=t}var l=typeof window!=="undefined"?window:undefined;var d=l||{};var p=d.MutationObserver||d.WebKitMutationObserver;var v=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var m=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function y(){return function(){process.nextTick(C)}}function g(){return function(){a(C)}}function b(){var t=0;var e=new p(C);var r=document.createTextNode("");e.observe(r,{characterData:true});return function(){r.data=t=++t%2}}function _(){var t=new MessageChannel;t.port1.onmessage=C;return function(){t.port2.postMessage(0)}}function w(){return function(){setTimeout(C,1)}}var x=new Array(1e3);function C(){for(var t=0;t<s;t+=2){var e=x[t];var r=x[t+1];e(r);x[t]=undefined;x[t+1]=undefined}s=0}var I;if(v){I=y()}else if(p){I=b()}else if(m){I=_()}else{I=w()}function S(t,e){var r=this;var n=new this.constructor(T);if(n[P]===undefined){et(n)}var i=r._state;if(i){var o=arguments[i-1];c(function(){J(i,n,o,r._result)})}else{Z(r,n,t,e)}return n}var A=S;function k(t){var e=this;if(t&&typeof t==="object"&&t.constructor===e){return t}var r=new e(T);j(r,t);return r}var E=k;var P=Math.random().toString(36).substring(16);function T(){}var F=void 0;var D=1;var M=2;var N=new G;function R(){return new TypeError("You cannot resolve a promise with itself")}function q(){return new TypeError("A promises callback cannot return that same promise.")}function O(t){try{return t.then}catch(t){N.error=t;return N}}function U(t,e,r,n){try{t.call(e,r,n)}catch(t){return t}}function B(t,e,r){c(function(t){var n=false;var i=U(r,e,function(r){if(n){return}n=true;if(e!==r){j(t,r)}else{X(t,r)}},function(e){if(n){return}n=true;Y(t,e)},"Settle: "+(t._label||" unknown promise"));if(!n&&i){n=true;Y(t,i)}},t)}function z(t,e){if(e._state===D){X(t,e._result)}else if(e._state===M){Y(t,e._result)}else{Z(e,undefined,function(e){j(t,e)},function(e){Y(t,e)})}}function L(t,e,n){if(e.constructor===t.constructor&&n===A&&constructor.resolve===E){z(t,e)}else{if(n===N){Y(t,N.error)}else if(n===undefined){X(t,e)}else if(r(n)){B(t,e,n)}else{X(t,e)}}}function j(t,r){if(t===r){Y(t,R())}else if(e(r)){L(t,r,O(r))}else{X(t,r)}}function V(t){if(t._onerror){t._onerror(t._result)}H(t)}function X(t,e){if(t._state!==F){return}t._result=e;t._state=D;if(t._subscribers.length!==0){c(H,t)}}function Y(t,e){if(t._state!==F){return}t._state=M;t._result=e;c(V,t)}function Z(t,e,r,n){var i=t._subscribers;var o=i.length;t._onerror=null;i[o]=e;i[o+D]=r;i[o+M]=n;if(o===0&&t._state){c(H,t)}}function H(t){var e=t._subscribers;var r=t._state;if(e.length===0){return}var n,i,o=t._result;for(var s=0;s<e.length;s+=3){n=e[s];i=e[s+r];if(n){J(r,n,i,o)}else{i(o)}}t._subscribers.length=0}function G(){this.error=null}var W=new G;function Q(t,e){try{return t(e)}catch(t){W.error=t;return W}}function J(t,e,n,i){var o=r(n),s,a,u,c;if(o){s=Q(n,i);if(s===W){c=true;a=s.error;s=null}else{u=true}if(e===s){Y(e,q());return}}else{s=i;u=true}if(e._state!==F){}else if(o&&u){j(e,s)}else if(c){Y(e,a)}else if(t===D){X(e,s)}else if(t===M){Y(e,s)}}function K(t,e){try{e(function e(r){j(t,r)},function e(r){Y(t,r)})}catch(e){Y(t,e)}}var $=0;function tt(){return $++}function et(t){t[P]=$++;t._state=undefined;t._result=undefined;t._subscribers=[]}function rt(t){return new lt(this,t).promise}var nt=rt;function it(t){var e=this;if(!o(t)){return new e(function(t,e){e(new TypeError("You must pass an array to race."))})}else{return new e(function(r,n){var i=t.length;for(var o=0;o<i;o++){e.resolve(t[o]).then(r,n)}})}}var ot=it;function st(t){var e=this;var r=new e(T);Y(r,t);return r}var at=st;function ut(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ct(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ft=ht;function ht(t){this[P]=tt();this._result=this._state=undefined;this._subscribers=[];if(T!==t){typeof t!=="function"&&ut();this instanceof ht?K(this,t):ct()}}ht.all=nt;ht.race=ot;ht.resolve=E;ht.reject=at;ht._setScheduler=f;ht._setAsap=h;ht._asap=c;ht.prototype={constructor:ht,then:A,catch:function(t){return this.then(null,t)}};var lt=dt;function dt(t,e){this._instanceConstructor=t;this.promise=new t(T);if(!this.promise[P]){et(this.promise)}if(Array.isArray(e)){this._input=e;this.length=e.length;this._remaining=e.length;this._result=new Array(this.length);if(this.length===0){X(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){X(this.promise,this._result)}}}else{Y(this.promise,pt())}}function pt(){return new Error("Array Methods must be provided an Array")}dt.prototype._enumerate=function(){var t=this.length;var e=this._input;for(var r=0;this._state===F&&r<t;r++){this._eachEntry(e[r],r)}};dt.prototype._eachEntry=function(t,e){var r=this._instanceConstructor;var n=r.resolve;if(n===E){var i=O(t);if(i===A&&t._state!==F){this._settledAt(t._state,e,t._result)}else if(typeof i!=="function"){this._remaining--;this._result[e]=t}else if(r===ft){var o=new r(T);L(o,t,i);this._willSettleAt(o,e)}else{this._willSettleAt(new r(function(e){e(t)}),e)}}else{this._willSettleAt(n(t),e)}};dt.prototype._settledAt=function(t,e,r){var n=this.promise;if(n._state===F){this._remaining--;if(t===M){Y(n,r)}else{this._result[e]=r}}if(this._remaining===0){X(n,this._result)}};dt.prototype._willSettleAt=function(t,e){var r=this;Z(t,undefined,function(t){r._settledAt(D,e,t)},function(t){r._settledAt(M,e,t)})};function vt(){var t;if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}}var e=t.Promise;if(e&&Object.prototype.toString.call(e.resolve())==="[object Promise]"&&!e.cast){return}t.Promise=ft}var mt=vt;var yt={Promise:ft,polyfill:mt};mt();t.ES6Promise=yt};var e;if(typeof window!=="undefined"&&window&&window.Promise){e=window.Promise}else if(typeof global!=="undefined"&&global&&global.Promise){e=global.Promise}else{var r={};t(r);e=r.ES6Promise.Promise}
// Copyright (c) Microsoft, All rights reserved. See License.txt in the project root for license information.
/*
 * Copyright (c) Microsoft.  All rights reserved.
Microsoft Open Technologies would like to thank its contributors, a list
of whom are at http://rx.codeplex.com/wikipage?title=Contributors.

Licensed under the Apache License, Version 2.0 (the "License"); you
may not use this file except in compliance with the License. You may
obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied. See the License for the specific language governing permissions
and limitations under the License.
 * 
 */
var n={};(function(t,e,r){var n={function:true,object:true};function i(t){return t&&t.Object===Object?t:null}var o=n[typeof exports]&&exports&&!exports.nodeType?exports:null;var s=n[typeof module]&&module&&!module.nodeType?module:null;var a=i(o&&s&&typeof global==="object"&&global);var u=i(n[typeof self]&&self);var c=i(n[typeof window]&&window);var f=s&&s.exports===o?o:null;var h=i(n[typeof this]&&this);var l=a||c!==(h&&h.window)&&c||u||h||Function("return this")();var d={internals:{},config:{Promise:e},helpers:{}};var p=d.helpers.noop=function(){},v=d.helpers.identity=function(t){return t},m=d.helpers.defaultNow=Date.now,y=d.helpers.defaultComparer=function(t,e){return zt(t,e)},g=d.helpers.defaultSubComparer=function(t,e){return t>e?1:t<e?-1:0},b=d.helpers.defaultKeySerializer=function(t){return t.toString()},_=d.helpers.defaultError=function(t){throw t},w=d.helpers.isPromise=function(t){return!!t&&typeof t.subscribe!=="function"&&typeof t.then==="function"},x=d.helpers.isFunction=function(){var t=function(t){return typeof t=="function"||false};if(t(/x/)){t=function(t){return typeof t=="function"&&toString.call(t)=="[object Function]"}}return t}();function C(t){var e=t.length,r=new Array(e);for(var n=0;n<e;n++){r[n]=t[n]}return r}var I={e:{}};function S(t){return function e(){try{return t.apply(this,arguments)}catch(t){I.e=t;return I}}}var A=d.internals.tryCatch=function t(e){if(!x(e)){throw new TypeError("fn must be a function")}return S(e)};function k(t){throw t}d.config.longStackSupport=false;var E=false,P=A(function(){throw new Error})();E=!!P.e&&!!P.e.stack;var T=O(),F;var D="From previous event:";function M(t,e){if(E&&e.stack&&typeof t==="object"&&t!==null&&t.stack&&t.stack.indexOf(D)===-1){var r=[];for(var n=e;!!n;n=n.source){if(n.stack){r.unshift(n.stack)}}r.unshift(t.stack);var i=r.join("\n"+D+"\n");t.stack=N(i)}}function N(t){var e=t.split("\n"),r=[];for(var n=0,i=e.length;n<i;n++){var o=e[n];if(!R(o)&&!q(o)&&o){r.push(o)}}return r.join("\n")}function R(t){var e=U(t);if(!e){return false}var r=e[0],n=e[1];return r===F&&n>=T&&n<=Ti}function q(t){return t.indexOf("(module.js:")!==-1||t.indexOf("(node.js:")!==-1}function O(){if(!E){return}try{throw new Error}catch(n){var t=n.stack.split("\n");var e=t[0].indexOf("@")>0?t[1]:t[2];var r=U(e);if(!r){return}F=r[0];return r[1]}}function U(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e){return[e[1],Number(e[2])]}var r=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(r){return[r[1],Number(r[2])]}var n=/.*@(.+):(\d+)$/.exec(t);if(n){return[n[1],Number(n[2])]}}var B=d.EmptyError=function(){this.message="Sequence contains no elements.";Error.call(this)};B.prototype=Object.create(Error.prototype);B.prototype.name="EmptyError";var z=d.ObjectDisposedError=function(){this.message="Object has been disposed";Error.call(this)};z.prototype=Object.create(Error.prototype);z.prototype.name="ObjectDisposedError";var L=d.ArgumentOutOfRangeError=function(){this.message="Argument out of range";Error.call(this)};L.prototype=Object.create(Error.prototype);L.prototype.name="ArgumentOutOfRangeError";var j=d.NotSupportedError=function(t){this.message=t||"This operation is not supported";Error.call(this)};j.prototype=Object.create(Error.prototype);j.prototype.name="NotSupportedError";var V=d.NotImplementedError=function(t){this.message=t||"This operation is not implemented";Error.call(this)};V.prototype=Object.create(Error.prototype);V.prototype.name="NotImplementedError";var X=d.helpers.notImplemented=function(){throw new V};var Y=d.helpers.notSupported=function(){throw new j};var Z=typeof Symbol==="function"&&Symbol.iterator||"_es6shim_iterator_";if(l.Set&&typeof(new l.Set)["@@iterator"]==="function"){Z="@@iterator"}var H=d.doneEnumerator={done:true,value:r};var G=d.helpers.isIterable=function(t){return t&&t[Z]!==r};var W=d.helpers.isArrayLike=function(t){return t&&t.length!==r};d.helpers.iterator=Z;var Q=d.internals.bindCallback=function(t,e,r){if(typeof e==="undefined"){return t}switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,i){return t.call(e,r,n,i)}}return function(){return t.apply(e,arguments)}};var J=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],K=J.length;var $="[object Arguments]",tt="[object Array]",et="[object Boolean]",rt="[object Date]",nt="[object Error]",it="[object Function]",ot="[object Map]",st="[object Number]",at="[object Object]",ut="[object RegExp]",ct="[object Set]",ft="[object String]",ht="[object WeakMap]";var lt="[object ArrayBuffer]",dt="[object Float32Array]",pt="[object Float64Array]",vt="[object Int8Array]",mt="[object Int16Array]",yt="[object Int32Array]",gt="[object Uint8Array]",bt="[object Uint8ClampedArray]",_t="[object Uint16Array]",wt="[object Uint32Array]";var xt={};xt[dt]=xt[pt]=xt[vt]=xt[mt]=xt[yt]=xt[gt]=xt[bt]=xt[_t]=xt[wt]=true;xt[$]=xt[tt]=xt[lt]=xt[et]=xt[rt]=xt[nt]=xt[it]=xt[ot]=xt[st]=xt[at]=xt[ut]=xt[ct]=xt[ft]=xt[ht]=false;var Ct=Object.prototype,It=Ct.hasOwnProperty,St=Ct.toString,At=Math.pow(2,53)-1;var kt=Object.keys||function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(i){if(typeof i!=="object"&&(typeof i!=="function"||i===null)){throw new TypeError("Object.keys called on non-object")}var o=[],s,a;for(s in i){if(t.call(i,s)){o.push(s)}}if(e){for(a=0;a<n;a++){if(t.call(i,r[a])){o.push(r[a])}}}return o}}();function Et(t,e,n,i,o,s){var a=kt(t),u=a.length,c=kt(e),f=c.length;if(u!==f&&!i){return false}var h=u,l;while(h--){l=a[h];if(!(i?l in e:It.call(e,l))){return false}}var d=i;while(++h<u){l=a[h];var p=t[l],v=e[l],m;if(!(m===r?n(p,v,i,o,s):m)){return false}d||(d=l==="constructor")}if(!d){var y=t.constructor,g=e.constructor;if(y!==g&&("constructor"in t&&"constructor"in e)&&!(typeof y==="function"&&y instanceof y&&typeof g==="function"&&g instanceof g)){return false}}return true}function Pt(t,e,r){switch(r){case et:case rt:return+t===+e;case nt:return t.name===e.name&&t.message===e.message;case st:return t!==+t?e!==+e:t===+e;case ut:case ft:return t===e+""}return false}var Tt=d.internals.isObject=function(t){var e=typeof t;return!!t&&(e==="object"||e==="function")};function Ft(t){return!!t&&typeof t==="object"}function Dt(t){return typeof t==="number"&&t>-1&&t%1===0&&t<=At}var Mt=function(){try{Object({toString:0}+"")}catch(t){return function(){return false}}return function(t){return typeof t.toString!=="function"&&typeof(t+"")==="string"}}();function Nt(t){return Ft(t)&&Dt(t.length)&&!!xt[St.call(t)]}var Rt=Array.isArray||function(t){return Ft(t)&&Dt(t.length)&&St.call(t)===tt};function qt(t,e){var r=-1,n=t.length;while(++r<n){if(e(t[r],r,t)){return true}}return false}function Ot(t,e,n,i,o,s){var a=-1,u=t.length,c=e.length;if(u!==c&&!(i&&c>u)){return false}while(++a<u){var f=t[a],h=e[a],l;if(l!==r){if(l){continue}return false}if(i){if(!qt(e,function(t){return f===t||n(f,t,i,o,s)})){return false}}else if(!(f===h||n(f,h,i,o,s))){return false}}return true}function Ut(t,e,r,n,i,o){var s=Rt(t),a=Rt(e),u=tt,c=tt;if(!s){u=St.call(t);if(u===$){u=at}else if(u!==at){s=Nt(t)}}if(!a){c=St.call(e);if(c===$){c=at}}var f=u===at&&!Mt(t),h=c===at&&!Mt(e),l=u===c;if(l&&!(s||f)){return Pt(t,e,u)}if(!n){var d=f&&It.call(t,"__wrapped__"),p=h&&It.call(e,"__wrapped__");if(d||p){return r(d?t.value():t,p?e.value():e,n,i,o)}}if(!l){return false}i||(i=[]);o||(o=[]);var v=i.length;while(v--){if(i[v]===t){return o[v]===e}}i.push(t);o.push(e);var m=(s?Ot:Et)(t,e,r,n,i,o);i.pop();o.pop();return m}function Bt(t,e,r,n,i){if(t===e){return true}if(t==null||e==null||!Tt(t)&&!Ft(e)){return t!==t&&e!==e}return Ut(t,e,Bt,r,n,i)}var zt=d.internals.isEqual=function(t,e){return Bt(t,e)};var Lt={}.hasOwnProperty,jt=Array.prototype.slice;var Vt=d.internals.inherits=function(t,e){function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r};var Xt=d.internals.addProperties=function(t){for(var e=[],r=1,n=arguments.length;r<n;r++){e.push(arguments[r])}for(var i=0,o=e.length;i<o;i++){var s=e[i];for(var a in s){t[a]=s[a]}}};var Yt=d.internals.addRef=function(t,e){return new xi(function(r){return new ne(e.getDisposable(),t.subscribe(r))})};function Zt(t,e){var r=new Array(t);for(var n=0;n<t;n++){r[n]=e()}return r}var Ht=d.CompositeDisposable=function(){var t=[],e,r;if(Array.isArray(arguments[0])){t=arguments[0]}else{r=arguments.length;t=new Array(r);for(e=0;e<r;e++){t[e]=arguments[e]}}this.disposables=t;this.isDisposed=false;this.length=t.length};var Gt=Ht.prototype;Gt.add=function(t){if(this.isDisposed){t.dispose()}else{this.disposables.push(t);this.length++}};Gt.remove=function(t){var e=false;if(!this.isDisposed){var r=this.disposables.indexOf(t);if(r!==-1){e=true;this.disposables.splice(r,1);this.length--;t.dispose()}}return e};Gt.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var t=this.disposables.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=this.disposables[r]}this.disposables=[];this.length=0;for(r=0;r<t;r++){e[r].dispose()}}};var Wt=d.Disposable=function(t){this.isDisposed=false;this.action=t||p};Wt.prototype.dispose=function(){if(!this.isDisposed){this.action();this.isDisposed=true}};var Qt=Wt.create=function(t){return new Wt(t)};var Jt=Wt.empty={dispose:p};var Kt=Wt.isDisposable=function(t){return t&&x(t.dispose)};var $t=Wt.checkDisposed=function(t){if(t.isDisposed){throw new z}};var te=Wt._fixup=function(t){return Kt(t)?t:Jt};var ee=d.SingleAssignmentDisposable=function(){this.isDisposed=false;this.current=null};ee.prototype.getDisposable=function(){return this.current};ee.prototype.setDisposable=function(t){if(this.current){throw new Error("Disposable has already been assigned")}var e=this.isDisposed;!e&&(this.current=t);e&&t&&t.dispose()};ee.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var t=this.current;this.current=null;t&&t.dispose()}};var re=d.SerialDisposable=function(){this.isDisposed=false;this.current=null};re.prototype.getDisposable=function(){return this.current};re.prototype.setDisposable=function(t){var e=this.isDisposed;if(!e){var r=this.current;this.current=t}r&&r.dispose();e&&t&&t.dispose()};re.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var t=this.current;this.current=null}t&&t.dispose()};var ne=d.BinaryDisposable=function(t,e){this._first=t;this._second=e;this.isDisposed=false};ne.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var t=this._first;this._first=null;t&&t.dispose();var e=this._second;this._second=null;e&&e.dispose()}};var ie=d.NAryDisposable=function(t){this._disposables=t;this.isDisposed=false};ie.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;for(var t=0,e=this._disposables.length;t<e;t++){this._disposables[t].dispose()}this._disposables.length=0}};var oe=d.RefCountDisposable=function(){function t(t){this.disposable=t;this.disposable.count++;this.isInnerDisposed=false}t.prototype.dispose=function(){if(!this.disposable.isDisposed&&!this.isInnerDisposed){this.isInnerDisposed=true;this.disposable.count--;if(this.disposable.count===0&&this.disposable.isPrimaryDisposed){this.disposable.isDisposed=true;this.disposable.underlyingDisposable.dispose()}}};function e(t){this.underlyingDisposable=t;this.isDisposed=false;this.isPrimaryDisposed=false;this.count=0}e.prototype.dispose=function(){if(!this.isDisposed&&!this.isPrimaryDisposed){this.isPrimaryDisposed=true;if(this.count===0){this.isDisposed=true;this.underlyingDisposable.dispose()}}};e.prototype.getDisposable=function(){return this.isDisposed?Jt:new t(this)};return e}();var se=d.internals.ScheduledItem=function(t,e,r,n,i){this.scheduler=t;this.state=e;this.action=r;this.dueTime=n;this.comparer=i||g;this.disposable=new ee};se.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())};se.prototype.compareTo=function(t){return this.comparer(this.dueTime,t.dueTime)};se.prototype.isCancelled=function(){return this.disposable.isDisposed};se.prototype.invokeCore=function(){return te(this.action(this.scheduler,this.state))};var ae=d.Scheduler=function(){function t(){}t.isScheduler=function(e){return e instanceof t};var e=t.prototype;e.schedule=function(t,e){throw new V};e.scheduleFuture=function(e,r,n){var i=r;i instanceof Date&&(i=i-this.now());i=t.normalize(i);if(i===0){return this.schedule(e,n)}return this._scheduleFuture(e,i,n)};e._scheduleFuture=function(t,e,r){throw new V};t.now=m;t.prototype.now=m;t.normalize=function(t){t<0&&(t=0);return t};return t}();var ue=ae.normalize,ce=ae.isScheduler;(function(t){function e(t,e){var r=e[0],n=e[1],i=new Ht;n(r,o);return i;function o(e){var r=false,s=false;var a=t.schedule(e,u);if(!s){i.add(a);r=true}function u(t,e){if(r){i.remove(a)}else{s=true}n(e,o);return Jt}}}function r(t,e){var r=e[0],n=e[1],i=new Ht;n(r,o);return i;function o(e,r){var s=false,a=false;var u=t.scheduleFuture(e,r,c);if(!a){i.add(u);s=true}function c(t,e){if(s){i.remove(u)}else{a=true}n(e,o);return Jt}}}t.scheduleRecursive=function(t,r){return this.schedule([t,r],e)};t.scheduleRecursiveFuture=function(t,e,n){return this.scheduleFuture([t,n],e,r)}})(ae.prototype);(function(t){t.schedulePeriodic=function(t,e,r){if(typeof l.setInterval==="undefined"){throw new j}e=ue(e);var n=t,i=l.setInterval(function(){n=r(n)},e);return Qt(function(){l.clearInterval(i)})}})(ae.prototype);var fe=function(t){Vt(e,t);function e(){t.call(this)}e.prototype.schedule=function(t,e){return te(e(this,t))};return e}(ae);var he=ae.immediate=new fe;var le=function(t){var e;function r(){while(e.length>0){var t=e.dequeue();!t.isCancelled()&&t.invoke()}}Vt(n,t);function n(){t.call(this)}n.prototype.schedule=function(t,n){var i=new se(this,t,n,this.now());if(!e){e=new Ce(4);e.enqueue(i);var o=A(r)();e=null;if(o===I){k(o.e)}}else{e.enqueue(i)}return i.disposable};n.prototype.scheduleRequired=function(){return!e};return n}(ae);var de=ae.currentThread=new le;var pe=d.internals.SchedulePeriodicRecursive=function(){function t(t){return function e(r,n){n(0,t._period);var i=A(t._action)(t._state);if(i===I){t._cancel.dispose();k(i.e)}t._state=i}}function e(t,e,r,n){this._scheduler=t;this._state=e;this._period=r;this._action=n}e.prototype.start=function(){var e=new ee;this._cancel=e;e.setDisposable(this._scheduler.scheduleRecursiveFuture(0,this._period,t(this)));return e};return e}();var ve,me;var ye=function(){var t,e=p;if(!!l.setTimeout){t=l.setTimeout;e=l.clearTimeout}else if(!!l.WScript){t=function(t,e){l.WScript.Sleep(e);t()}}else{throw new j}return{setTimeout:t,clearTimeout:e}}();var ge=ye.setTimeout,be=ye.clearTimeout;(function(){var t=1,e={},r=false;me=function(t){delete e[t]};function n(t){if(r){ge(function(){n(t)},0)}else{var i=e[t];if(i){r=true;var o=A(i)();me(t);r=false;if(o===I){k(o.e)}}}}var i=new RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var o=typeof(o=a&&f&&a.setImmediate)=="function"&&!i.test(o)&&o;function s(){if(!l.postMessage||l.importScripts){return false}var t=false,e=l.onmessage;l.onmessage=function(){t=true};l.postMessage("","*");l.onmessage=e;return t}if(x(o)){ve=function(r){var i=t++;e[i]=r;o(function(){n(i)});return i}}else if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){ve=function(r){var i=t++;e[i]=r;process.nextTick(function(){n(i)});return i}}else if(s()){var u="ms.rx.schedule"+Math.random();var c=function(t){if(typeof t.data==="string"&&t.data.substring(0,u.length)===u){n(t.data.substring(u.length))}};l.addEventListener("message",c,false);ve=function(r){var n=t++;e[n]=r;l.postMessage(u+n,"*");return n}}else if(!!l.MessageChannel){var h=new l.MessageChannel;h.port1.onmessage=function(t){n(t.data)};ve=function(r){var n=t++;e[n]=r;h.port2.postMessage(n);return n}}else if("document"in l&&"onreadystatechange"in l.document.createElement("script")){ve=function(r){var i=l.document.createElement("script");var o=t++;e[o]=r;i.onreadystatechange=function(){n(o);i.onreadystatechange=null;i.parentNode.removeChild(i);i=null};l.document.documentElement.appendChild(i);return o}}else{ve=function(r){var i=t++;e[i]=r;ge(function(){n(i)},0);return i}}})();var _e=function(t){Vt(e,t);function e(){t.call(this)}function r(t,e,r,n){return function i(){t.setDisposable(Wt._fixup(e(r,n)))}}function n(t){this._id=t;this.isDisposed=false}n.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;me(this._id)}};function i(t){this._id=t;this.isDisposed=false}i.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;be(this._id)}};e.prototype.schedule=function(t,e){var i=new ee,o=ve(r(i,e,this,t));return new ne(i,new n(o))};e.prototype._scheduleFuture=function(t,e,n){if(e===0){return this.schedule(t,n)}var o=new ee,s=ge(r(o,n,this,t),e);return new ne(o,new i(s))};function o(t,e,r){return function(){e(t,r)}}e.prototype.scheduleLongRunning=function(t,e){var r=Qt(p);ve(o(t,e,r));return r};return e}(ae);var we=ae["default"]=ae.async=new _e;function xe(t,e){this.id=t;this.value=e}xe.prototype.compareTo=function(t){var e=this.value.compareTo(t.value);e===0&&(e=this.id-t.id);return e};var Ce=d.internals.PriorityQueue=function(t){this.items=new Array(t);this.length=0};var Ie=Ce.prototype;Ie.isHigherPriority=function(t,e){return this.items[t].compareTo(this.items[e])<0};Ie.percolate=function(t){if(t>=this.length||t<0){return}var e=t-1>>1;if(e<0||e===t){return}if(this.isHigherPriority(t,e)){var r=this.items[t];this.items[t]=this.items[e];this.items[e]=r;this.percolate(e)}};Ie.heapify=function(t){+t||(t=0);if(t>=this.length||t<0){return}var e=2*t+1,r=2*t+2,n=t;if(e<this.length&&this.isHigherPriority(e,n)){n=e}if(r<this.length&&this.isHigherPriority(r,n)){n=r}if(n!==t){var i=this.items[t];this.items[t]=this.items[n];this.items[n]=i;this.heapify(n)}};Ie.peek=function(){return this.items[0].value};Ie.removeAt=function(t){this.items[t]=this.items[--this.length];this.items[this.length]=r;this.heapify()};Ie.dequeue=function(){var t=this.peek();this.removeAt(0);return t};Ie.enqueue=function(t){var e=this.length++;this.items[e]=new xe(Ce.count++,t);this.percolate(e)};Ie.remove=function(t){for(var e=0;e<this.length;e++){if(this.items[e].value===t){this.removeAt(e);return true}}return false};Ce.count=0;var Se=d.Notification=function(){function t(){}t.prototype._accept=function(t,e,r){throw new V};t.prototype._acceptObserver=function(t,e,r){throw new V};t.prototype.accept=function(t,e,r){return t&&typeof t==="object"?this._acceptObserver(t):this._accept(t,e,r)};t.prototype.toObservable=function(t){var e=this;ce(t)||(t=he);return new xi(function(r){return t.schedule(e,function(t,e){e._acceptObserver(r);e.kind==="N"&&r.onCompleted()})})};return t}();var Ae=function(t){Vt(e,t);function e(t){this.value=t;this.kind="N"}e.prototype._accept=function(t){return t(this.value)};e.prototype._acceptObserver=function(t){return t.onNext(this.value)};e.prototype.toString=function(){return"OnNext("+this.value+")"};return e}(Se);var ke=function(t){Vt(e,t);function e(t){this.error=t;this.kind="E"}e.prototype._accept=function(t,e){return e(this.error)};e.prototype._acceptObserver=function(t){return t.onError(this.error)};e.prototype.toString=function(){return"OnError("+this.error+")"};return e}(Se);var Ee=function(t){Vt(e,t);function e(){this.kind="C"}e.prototype._accept=function(t,e,r){return r()};e.prototype._acceptObserver=function(t){return t.onCompleted()};e.prototype.toString=function(){return"OnCompleted()"};return e}(Se);var Pe=Se.createOnNext=function(t){return new Ae(t)};var Te=Se.createOnError=function(t){return new ke(t)};var Fe=Se.createOnCompleted=function(){return new Ee};var De=d.Observer=function(){};var Me=De.create=function(t,e,r){t||(t=p);e||(e=_);r||(r=p);return new Re(t,e,r)};var Ne=d.internals.AbstractObserver=function(t){Vt(e,t);function e(){this.isStopped=false}e.prototype.next=X;e.prototype.error=X;e.prototype.completed=X;e.prototype.onNext=function(t){!this.isStopped&&this.next(t)};e.prototype.onError=function(t){if(!this.isStopped){this.isStopped=true;this.error(t)}};e.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.completed()}};e.prototype.dispose=function(){this.isStopped=true};e.prototype.fail=function(t){if(!this.isStopped){this.isStopped=true;this.error(t);return true}return false};return e}(De);var Re=d.AnonymousObserver=function(t){Vt(e,t);function e(e,r,n){t.call(this);this._onNext=e;this._onError=r;this._onCompleted=n}e.prototype.next=function(t){this._onNext(t)};e.prototype.error=function(t){this._onError(t)};e.prototype.completed=function(){this._onCompleted()};return e}(Ne);var qe;var Oe=d.Observable=function(){function t(t,e){return function(r){var n=r.onError;r.onError=function(e){M(e,t);n.call(r,e)};return e.call(t,r)}}function e(){if(d.config.longStackSupport&&E){var e=this._subscribe;var r=A(k)(new Error).e;this.stack=r.stack.substring(r.stack.indexOf("\n")+1);this._subscribe=t(this,e)}}qe=e.prototype;e.isObservable=function(t){return t&&x(t.subscribe)};qe.subscribe=qe.forEach=function(t,e,r){return this._subscribe(typeof t==="object"?t:Me(t,e,r))};qe.subscribeOnNext=function(t,e){return this._subscribe(Me(typeof e!=="undefined"?function(r){t.call(e,r)}:t))};qe.subscribeOnError=function(t,e){return this._subscribe(Me(null,typeof e!=="undefined"?function(r){t.call(e,r)}:t))};qe.subscribeOnCompleted=function(t,e){return this._subscribe(Me(null,null,typeof e!=="undefined"?function(){t.call(e)}:t))};return e}();var Ue=d.internals.ScheduledObserver=function(t){Vt(e,t);function e(e,r){t.call(this);this.scheduler=e;this.observer=r;this.isAcquired=false;this.hasFaulted=false;this.queue=[];this.disposable=new re}function r(t,e){return function(){t.onNext(e)}}function n(t,e){return function(){t.onError(e)}}function i(t){return function(){t.onCompleted()}}e.prototype.next=function(t){this.queue.push(r(this.observer,t))};e.prototype.error=function(t){this.queue.push(n(this.observer,t))};e.prototype.completed=function(){this.queue.push(i(this.observer))};function o(t,e){var r;if(t.queue.length>0){r=t.queue.shift()}else{t.isAcquired=false;return}var n=A(r)();if(n===I){t.queue=[];t.hasFaulted=true;return k(n.e)}e(t)}e.prototype.ensureActive=function(){var t=false;if(!this.hasFaulted&&this.queue.length>0){t=!this.isAcquired;this.isAcquired=true}t&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(this,o))};e.prototype.dispose=function(){t.prototype.dispose.call(this);this.disposable.dispose()};return e}(Ne);var Be=d.ObservableBase=function(t){Vt(n,t);function e(t){return t&&x(t.dispose)?t:x(t)?Qt(t):Jt}function r(t,r){var n=r[0],i=r[1];var o=A(i.subscribeCore).call(i,n);if(o===I&&!n.fail(I.e)){k(I.e)}n.setDisposable(e(o))}function n(){t.call(this)}n.prototype._subscribe=function(t){var e=new Ci(t),n=[e,this];if(de.scheduleRequired()){de.schedule(n,r)}else{r(null,n)}return e};n.prototype.subscribeCore=X;return n}(Oe);var ze=d.FlatMapObservable=function(t){Vt(e,t);function e(e,r,n,i){this.resultSelector=x(n)?n:null;this.selector=Q(x(r)?r:function(){return r},i,3);this.source=e;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new r(t,this.selector,this.resultSelector,this))};Vt(r,Ne);function r(t,e,r,n){this.i=0;this.selector=e;this.resultSelector=r;this.source=n;this.o=t;Ne.call(this)}r.prototype._wrapResult=function(t,e,r){return this.resultSelector?t.map(function(t,n){return this.resultSelector(e,t,r,n)},this):t};r.prototype.next=function(t){var e=this.i++;var r=A(this.selector)(t,e,this.source);if(r===I){return this.o.onError(r.e)}w(r)&&(r=Yn(r));(W(r)||G(r))&&(r=Oe.from(r));this.o.onNext(this._wrapResult(r,t,e))};r.prototype.error=function(t){this.o.onError(t)};r.prototype.completed=function(){this.o.onCompleted()};return e}(Be);var Le=d.internals.Enumerable=function(){};function je(t){this._s=t;this.isDisposed=false}je.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;this._s.isDisposed=true}};var Ve=function(t){Vt(e,t);function e(e){this.sources=e;t.call(this)}function r(t,e){if(t.isDisposed){return}var r=A(t.e.next).call(t.e);if(r===I){return t.o.onError(r.e)}if(r.done){return t.o.onCompleted()}var i=r.value;w(i)&&(i=Yn(i));var o=new ee;t.subscription.setDisposable(o);o.setDisposable(i.subscribe(new n(t,e)))}e.prototype.subscribeCore=function(t){var e=new re;var n={isDisposed:false,o:t,subscription:e,e:this.sources[Z]()};var i=de.scheduleRecursive(n,r);return new ie([e,i,new je(n)])};function n(t,e){this._state=t;this._recurse=e;Ne.call(this)}Vt(n,Ne);n.prototype.next=function(t){this._state.o.onNext(t)};n.prototype.error=function(t){this._state.o.onError(t)};n.prototype.completed=function(){this._recurse(this._state)};return e}(Be);Le.prototype.concat=function(){return new Ve(this)};var Xe=function(t){function e(e){this.sources=e;t.call(this)}Vt(e,t);function r(t,e){if(t.isDisposed){return}var r=A(t.e.next).call(t.e);if(r===I){return t.o.onError(r.e)}if(r.done){return t.lastError!==null?t.o.onError(t.lastError):t.o.onCompleted()}var i=r.value;w(i)&&(i=Yn(i));var o=new ee;t.subscription.setDisposable(o);o.setDisposable(i.subscribe(new n(t,e)))}e.prototype.subscribeCore=function(t){var e=new re;var n={isDisposed:false,e:this.sources[Z](),subscription:e,lastError:null,o:t};var i=de.scheduleRecursive(n,r);return new ie([e,i,new je(n)])};function n(t,e){this._state=t;this._recurse=e;Ne.call(this)}Vt(n,Ne);n.prototype.next=function(t){this._state.o.onNext(t)};n.prototype.error=function(t){this._state.lastError=t;this._recurse(this._state)};n.prototype.completed=function(){this._state.o.onCompleted()};return e}(Be);Le.prototype.catchError=function(){return new Xe(this)};var Ye=function(t){Vt(e,t);function e(t,e){this.v=t;this.c=e==null?-1:e}e.prototype[Z]=function(){return new r(this)};function r(t){this.v=t.v;this.l=t.c}r.prototype.next=function(){if(this.l===0){return H}if(this.l>0){this.l--}return{done:false,value:this.v}};return e}(Le);var Ze=Le.repeat=function(t,e){return new Ye(t,e)};var He=function(t){Vt(e,t);function e(t,e,r){this.s=t;this.fn=e?Q(e,r,3):null}e.prototype[Z]=function(){return new r(this)};function r(t){this.i=-1;this.s=t.s;this.l=this.s.length;this.fn=t.fn}r.prototype.next=function(){return++this.i<this.l?{done:false,value:!this.fn?this.s[this.i]:this.fn(this.s[this.i],this.i,this.s)}:H};return e}(Le);var Ge=Le.of=function(t,e,r){return new He(t,e,r)};var We=function(t){Vt(e,t);function e(e){this.source=e;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new r(t))};Vt(r,Ne);function r(t){this.o=t;this.a=[];Ne.call(this)}r.prototype.next=function(t){this.a.push(t)};r.prototype.error=function(t){this.o.onError(t)};r.prototype.completed=function(){this.o.onNext(this.a);this.o.onCompleted()};return e}(Be);qe.toArray=function(){return new We(this)};Oe.create=function(t,e){return new xi(t,e)};var Qe=function(t){Vt(e,t);function e(e){this._f=e;t.call(this)}e.prototype.subscribeCore=function(t){var e=A(this._f)();if(e===I){return Ar(e.e).subscribe(t)}w(e)&&(e=Yn(e));return e.subscribe(t)};return e}(Be);var Je=Oe.defer=function(t){return new Qe(t)};var Ke=function(t){Vt(e,t);function e(e){this.scheduler=e;t.call(this)}e.prototype.subscribeCore=function(t){var e=new r(t,this.scheduler);return e.run()};function r(t,e){this.observer=t;this.scheduler=e}function n(t,e){e.onCompleted();return Jt}r.prototype.run=function(){var t=this.observer;return this.scheduler===he?n(null,t):this.scheduler.schedule(t,n)};return e}(Be);var $e=new Ke(he);var tr=Oe.empty=function(t){ce(t)||(t=he);return t===he?$e:new Ke(t)};var er=function(t){Vt(e,t);function e(e,r,n){this._iterable=e;this._fn=r;this._scheduler=n;t.call(this)}function r(t,e,r){return function n(i,o){var s=A(e.next).call(e);if(s===I){return t.onError(s.e)}if(s.done){return t.onCompleted()}var a=s.value;if(x(r)){a=A(r)(a,i);if(a===I){return t.onError(a.e)}}t.onNext(a);o(i+1)}}e.prototype.subscribeCore=function(t){var e=Object(this._iterable),n=cr(e);return this._scheduler.scheduleRecursive(0,r(t,n,this._fn))};return e}(Be);var rr=Math.pow(2,53)-1;function nr(t){this._s=t}nr.prototype[Z]=function(){return new ir(this._s)};function ir(t){this._s=t;this._l=t.length;this._i=0}ir.prototype[Z]=function(){return this};ir.prototype.next=function(){return this._i<this._l?{done:false,value:this._s.charAt(this._i++)}:H};function or(t){this._a=t}or.prototype[Z]=function(){return new sr(this._a)};function sr(t){this._a=t;this._l=hr(t);this._i=0}sr.prototype[Z]=function(){return this};sr.prototype.next=function(){return this._i<this._l?{done:false,value:this._a[this._i++]}:H};function ar(t){return typeof t==="number"&&l.isFinite(t)}function ur(t){return t!==t}function cr(t){var e=t[Z],n;if(!e&&typeof t==="string"){n=new nr(t);return n[Z]()}if(!e&&t.length!==r){n=new or(t);return n[Z]()}if(!e){throw new TypeError("Object is not iterable")}return t[Z]()}function fr(t){var e=+t;if(e===0){return e}if(isNaN(e)){return e}return e<0?-1:1}function hr(t){var e=+t.length;if(isNaN(e)){return 0}if(e===0||!ar(e)){return e}e=fr(e)*Math.floor(Math.abs(e));if(e<=0){return 0}if(e>rr){return rr}return e}var lr=Oe.from=function(t,e,r,n){if(t==null){throw new Error("iterable cannot be null.")}if(e&&!x(e)){throw new Error("mapFn when provided must be a function")}if(e){var i=Q(e,r,2)}ce(n)||(n=de);return new er(t,i,n)};var dr=function(t){Vt(e,t);function e(e,r){this._args=e;this._scheduler=r;t.call(this)}function r(t,e){var r=e.length;return function n(i,o){if(i<r){t.onNext(e[i]);o(i+1)}else{t.onCompleted()}}}e.prototype.subscribeCore=function(t){return this._scheduler.scheduleRecursive(0,r(t,this._args))};return e}(Be);var pr=Oe.fromArray=function(t,e){ce(e)||(e=de);return new dr(t,e)};var vr=function(t){Vt(e,t);function e(){t.call(this)}e.prototype.subscribeCore=function(t){return Jt};return e}(Be);var mr=new vr;var yr=Oe.never=function(){return mr};function gr(t,e){ce(t)||(t=de);return new dr(e,t)}Oe.of=function(){var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}return new dr(e,de)};Oe.ofWithScheduler=function(t){var e=arguments.length,r=new Array(e-1);for(var n=1;n<e;n++){r[n-1]=arguments[n]}return new dr(r,t)};var br=function(t){Vt(e,t);function e(e,r){this._o=e;this._keys=Object.keys(e);this._scheduler=r;t.call(this)}function r(t,e,r){return function n(i,o){if(i<r.length){var s=r[i];t.onNext([s,e[s]]);o(i+1)}else{t.onCompleted()}}}e.prototype.subscribeCore=function(t){return this._scheduler.scheduleRecursive(0,r(t,this._o,this._keys))};return e}(Be);Oe.pairs=function(t,e){e||(e=de);return new br(t,e)};var _r=function(t){Vt(e,t);function e(e,r,n){this.start=e;this.rangeCount=r;this.scheduler=n;t.call(this)}function r(t,e,r){return function n(i,o){if(i<e){r.onNext(t+i);o(i+1)}else{r.onCompleted()}}}e.prototype.subscribeCore=function(t){return this.scheduler.scheduleRecursive(0,r(this.start,this.rangeCount,t))};return e}(Be);Oe.range=function(t,e,r){ce(r)||(r=de);return new _r(t,e,r)};var wr=function(t){Vt(e,t);function e(e,r,n){this.value=e;this.repeatCount=r==null?-1:r;this.scheduler=n;t.call(this)}e.prototype.subscribeCore=function(t){var e=new xr(t,this);return e.run()};return e}(Be);function xr(t,e){this.observer=t;this.parent=e}xr.prototype.run=function(){var t=this.observer,e=this.parent.value;function r(r,n){if(r===-1||r>0){t.onNext(e);r>0&&r--}if(r===0){return t.onCompleted()}n(r)}return this.parent.scheduler.scheduleRecursive(this.parent.repeatCount,r)};Oe.repeat=function(t,e,r){ce(r)||(r=de);return new wr(t,e,r)};var Cr=function(t){Vt(e,t);function e(e,r){this._value=e;this._scheduler=r;t.call(this)}e.prototype.subscribeCore=function(t){var e=[this._value,t];return this._scheduler===he?r(null,e):this._scheduler.schedule(e,r)};function r(t,e){var r=e[0],n=e[1];n.onNext(r);n.onCompleted()
;return Jt}return e}(Be);var Ir=Oe["return"]=Oe.just=function(t,e){ce(e)||(e=he);return new Cr(t,e)};var Sr=function(t){Vt(e,t);function e(e,r){this._error=e;this._scheduler=r;t.call(this)}e.prototype.subscribeCore=function(t){var e=[this._error,t];return this._scheduler===he?r(null,e):this._scheduler.schedule(e,r)};function r(t,e){var r=e[0],n=e[1];n.onError(r);return Jt}return e}(Be);var Ar=Oe["throw"]=function(t,e){ce(e)||(e=he);return new Sr(t,e)};var kr=function(t){Vt(e,t);function e(e,r){this.source=e;this._fn=r;t.call(this)}e.prototype.subscribeCore=function(t){var e=new ee,r=new re;r.setDisposable(e);e.setDisposable(this.source.subscribe(new Er(t,r,this._fn)));return r};return e}(Be);var Er=function(t){Vt(e,t);function e(e,r,n){this._o=e;this._s=r;this._fn=n;t.call(this)}e.prototype.next=function(t){this._o.onNext(t)};e.prototype.completed=function(){return this._o.onCompleted()};e.prototype.error=function(t){var e=A(this._fn)(t);if(e===I){return this._o.onError(e.e)}w(e)&&(e=Yn(e));var r=new ee;this._s.setDisposable(r);r.setDisposable(e.subscribe(this._o))};return e}(Ne);qe["catch"]=function(t){return x(t)?new kr(this,t):Pr([this,t])};var Pr=Oe["catch"]=function(){var t;if(Array.isArray(arguments[0])){t=arguments[0]}else{var e=arguments.length;t=new Array(e);for(var r=0;r<e;r++){t[r]=arguments[r]}}return Ge(t).catchError()};qe.combineLatest=function(){var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}if(Array.isArray(e[0])){e[0].unshift(this)}else{e.unshift(this)}return Nr.apply(this,e)};function Tr(){return false}function Fr(){var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}return e}var Dr=function(t){Vt(e,t);function e(e,r){this._params=e;this._cb=r;t.call(this)}e.prototype.subscribeCore=function(t){var e=this._params.length,r=new Array(e);var n={hasValue:Zt(e,Tr),hasValueAll:false,isDone:Zt(e,Tr),values:new Array(e)};for(var i=0;i<e;i++){var o=this._params[i],s=new ee;r[i]=s;w(o)&&(o=Yn(o));s.setDisposable(o.subscribe(new Mr(t,i,this._cb,n)))}return new ie(r)};return e}(Be);var Mr=function(t){Vt(e,t);function e(e,r,n,i){this._o=e;this._i=r;this._cb=n;this._state=i;t.call(this)}function r(t){return function(e,r){return r!==t}}e.prototype.next=function(t){this._state.values[this._i]=t;this._state.hasValue[this._i]=true;if(this._state.hasValueAll||(this._state.hasValueAll=this._state.hasValue.every(v))){var e=A(this._cb).apply(null,this._state.values);if(e===I){return this._o.onError(e.e)}this._o.onNext(e)}else if(this._state.isDone.filter(r(this._i)).every(v)){this._o.onCompleted()}};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._state.isDone[this._i]=true;this._state.isDone.every(v)&&this._o.onCompleted()};return e}(Ne);var Nr=Oe.combineLatest=function(){var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}var n=x(e[t-1])?e.pop():Fr;Array.isArray(e[0])&&(e=e[0]);return new Dr(e,n)};qe.concat=function(){for(var t=[],e=0,r=arguments.length;e<r;e++){t.push(arguments[e])}t.unshift(this);return Or.apply(null,t)};var Rr=function(t){Vt(e,t);function e(e,r){this._s=e;this._fn=r;t.call(this)}e.prototype.next=function(t){this._s.o.onNext(t)};e.prototype.error=function(t){this._s.o.onError(t)};e.prototype.completed=function(){this._s.i++;this._fn(this._s)};return e}(Ne);var qr=function(t){Vt(e,t);function e(e){this._sources=e;t.call(this)}function r(t,e){if(t.disposable.isDisposed){return}if(t.i===t.sources.length){return t.o.onCompleted()}var r=t.sources[t.i];w(r)&&(r=Yn(r));var n=new ee;t.subscription.setDisposable(n);n.setDisposable(r.subscribe(new Rr(t,e)))}e.prototype.subscribeCore=function(t){var e=new re;var n=Qt(p);var i={o:t,i:0,subscription:e,disposable:n,sources:this._sources};var o=he.scheduleRecursive(i,r);return new ie([e,n,o])};return e}(Be);var Or=Oe.concat=function(){var t;if(Array.isArray(arguments[0])){t=arguments[0]}else{t=new Array(arguments.length);for(var e=0,r=arguments.length;e<r;e++){t[e]=arguments[e]}}return new qr(t)};qe.concatAll=function(){return this.merge(1)};var Ur=function(t){Vt(e,t);function e(e,r){this.source=e;this.maxConcurrent=r;t.call(this)}e.prototype.subscribeCore=function(t){var e=new Ht;e.add(this.source.subscribe(new Br(t,this.maxConcurrent,e)));return e};return e}(Be);var Br=function(t){function e(e,r,n){this.o=e;this.max=r;this.g=n;this.done=false;this.q=[];this.activeCount=0;t.call(this)}Vt(e,t);e.prototype.handleSubscribe=function(t){var e=new ee;this.g.add(e);w(t)&&(t=Yn(t));e.setDisposable(t.subscribe(new r(this,e)))};e.prototype.next=function(t){if(this.activeCount<this.max){this.activeCount++;this.handleSubscribe(t)}else{this.q.push(t)}};e.prototype.error=function(t){this.o.onError(t)};e.prototype.completed=function(){this.done=true;this.activeCount===0&&this.o.onCompleted()};function r(e,r){this.parent=e;this.sad=r;t.call(this)}Vt(r,t);r.prototype.next=function(t){this.parent.o.onNext(t)};r.prototype.error=function(t){this.parent.o.onError(t)};r.prototype.completed=function(){this.parent.g.remove(this.sad);if(this.parent.q.length>0){this.parent.handleSubscribe(this.parent.q.shift())}else{this.parent.activeCount--;this.parent.done&&this.parent.activeCount===0&&this.parent.o.onCompleted()}};return e}(Ne);qe.merge=function(t){return typeof t!=="number"?zr(this,t):new Ur(this,t)};var zr=Oe.merge=function(){var t,e=[],r,n=arguments.length;if(!arguments[0]){t=he;for(r=1;r<n;r++){e.push(arguments[r])}}else if(ce(arguments[0])){t=arguments[0];for(r=1;r<n;r++){e.push(arguments[r])}}else{t=he;for(r=0;r<n;r++){e.push(arguments[r])}}if(Array.isArray(e[0])){e=e[0]}return gr(t,e).mergeAll()};var Lr=d.CompositeError=function(t){this.innerErrors=t;this.message="This contains multiple errors. Check the innerErrors";Error.call(this)};Lr.prototype=Object.create(Error.prototype);Lr.prototype.name="CompositeError";var jr=function(t){Vt(e,t);function e(e){this.source=e;t.call(this)}e.prototype.subscribeCore=function(t){var e=new Ht,r=new ee,n={isStopped:false,errors:[],o:t};e.add(r);r.setDisposable(this.source.subscribe(new Vr(e,n)));return e};return e}(Be);var Vr=function(t){Vt(e,t);function e(e,r){this._group=e;this._state=r;t.call(this)}function r(t,e){if(e.length===0){t.onCompleted()}else if(e.length===1){t.onError(e[0])}else{t.onError(new Lr(e))}}e.prototype.next=function(t){var e=new ee;this._group.add(e);w(t)&&(t=Yn(t));e.setDisposable(t.subscribe(new n(e,this._group,this._state)))};e.prototype.error=function(t){this._state.errors.push(t);this._state.isStopped=true;this._group.length===1&&r(this._state.o,this._state.errors)};e.prototype.completed=function(){this._state.isStopped=true;this._group.length===1&&r(this._state.o,this._state.errors)};Vt(n,t);function n(e,r,n){this._inner=e;this._group=r;this._state=n;t.call(this)}n.prototype.next=function(t){this._state.o.onNext(t)};n.prototype.error=function(t){this._state.errors.push(t);this._group.remove(this._inner);this._state.isStopped&&this._group.length===1&&r(this._state.o,this._state.errors)};n.prototype.completed=function(){this._group.remove(this._inner);this._state.isStopped&&this._group.length===1&&r(this._state.o,this._state.errors)};return e}(Ne);Oe.mergeDelayError=function(){var t;if(Array.isArray(arguments[0])){t=arguments[0]}else{var e=arguments.length;t=new Array(e);for(var r=0;r<e;r++){t[r]=arguments[r]}}var n=gr(null,t);return new jr(n)};var Xr=function(t){Vt(e,t);function e(e){this.source=e;t.call(this)}e.prototype.subscribeCore=function(t){var e=new Ht,r=new ee;e.add(r);r.setDisposable(this.source.subscribe(new Yr(t,e)));return e};return e}(Be);var Yr=function(t){function e(e,r){this.o=e;this.g=r;this.done=false;t.call(this)}Vt(e,t);e.prototype.next=function(t){var e=new ee;this.g.add(e);w(t)&&(t=Yn(t));e.setDisposable(t.subscribe(new r(this,e)))};e.prototype.error=function(t){this.o.onError(t)};e.prototype.completed=function(){this.done=true;this.g.length===1&&this.o.onCompleted()};function r(e,r){this.parent=e;this.sad=r;t.call(this)}Vt(r,t);r.prototype.next=function(t){this.parent.o.onNext(t)};r.prototype.error=function(t){this.parent.o.onError(t)};r.prototype.completed=function(){this.parent.g.remove(this.sad);this.parent.done&&this.parent.g.length===1&&this.parent.o.onCompleted()};return e}(Ne);qe.mergeAll=function(){return new Xr(this)};var Zr=function(t){Vt(e,t);function e(e,r){this._s=e;this._o=w(r)?Yn(r):r;this._open=false;t.call(this)}e.prototype.subscribeCore=function(t){var e=new ee;e.setDisposable(this._s.subscribe(new Hr(t,this)));w(this._o)&&(this._o=Yn(this._o));var r=new ee;r.setDisposable(this._o.subscribe(new Gr(t,this,r)));return new ne(e,r)};return e}(Be);var Hr=function(t){Vt(e,t);function e(e,r){this._o=e;this._p=r;t.call(this)}e.prototype.next=function(t){this._p._open&&this._o.onNext(t)};e.prototype.error=function(t){this._o.onError(t)};e.prototype.onCompleted=function(){this._p._open&&this._o.onCompleted()};return e}(Ne);var Gr=function(t){Vt(e,t);function e(e,r,n){this._o=e;this._p=r;this._r=n;t.call(this)}e.prototype.next=function(){this._p._open=true;this._r.dispose()};e.prototype.error=function(t){this._o.onError(t)};e.prototype.onCompleted=function(){this._r.dispose()};return e}(Ne);qe.skipUntil=function(t){return new Zr(this,t)};var Wr=function(t){Vt(e,t);function e(e){this.source=e;t.call(this)}e.prototype.subscribeCore=function(t){var e=new re,n=this.source.subscribe(new r(t,e));return new ne(n,e)};Vt(r,Ne);function r(t,e){this.o=t;this.inner=e;this.stopped=false;this.latest=0;this.hasLatest=false;Ne.call(this)}r.prototype.next=function(t){var e=new ee,r=++this.latest;this.hasLatest=true;this.inner.setDisposable(e);w(t)&&(t=Yn(t));e.setDisposable(t.subscribe(new n(this,r)))};r.prototype.error=function(t){this.o.onError(t)};r.prototype.completed=function(){this.stopped=true;!this.hasLatest&&this.o.onCompleted()};Vt(n,Ne);function n(t,e){this.parent=t;this.id=e;Ne.call(this)}n.prototype.next=function(t){this.parent.latest===this.id&&this.parent.o.onNext(t)};n.prototype.error=function(t){this.parent.latest===this.id&&this.parent.o.onError(t)};n.prototype.completed=function(){if(this.parent.latest===this.id){this.parent.hasLatest=false;this.parent.stopped&&this.parent.o.onCompleted()}};return e}(Be);qe["switch"]=qe.switchLatest=function(){return new Wr(this)};var Qr=function(t){Vt(e,t);function e(e,r){this.source=e;this.other=w(r)?Yn(r):r;t.call(this)}e.prototype.subscribeCore=function(t){return new ne(this.source.subscribe(t),this.other.subscribe(new Jr(t)))};return e}(Be);var Jr=function(t){Vt(e,t);function e(e){this._o=e;t.call(this)}e.prototype.next=function(){this._o.onCompleted()};e.prototype.error=function(t){this._o.onError(t)};e.prototype.onCompleted=p;return e}(Ne);qe.takeUntil=function(t){return new Qr(this,t)};function Tr(){return false}function Fr(){var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}return e}var Kr=function(t){Vt(e,t);function e(e,r,n){this._s=e;this._ss=r;this._cb=n;t.call(this)}e.prototype.subscribeCore=function(t){var e=this._ss.length;var r={hasValue:Zt(e,Tr),hasValueAll:false,values:new Array(e)};var n=this._ss.length,i=new Array(n+1);for(var o=0;o<n;o++){var s=this._ss[o],a=new ee;w(s)&&(s=Yn(s));a.setDisposable(s.subscribe(new $r(t,o,r)));i[o]=a}var u=new ee;u.setDisposable(this._s.subscribe(new tn(t,this._cb,r)));i[n]=u;return new ie(i)};return e}(Be);var $r=function(t){Vt(e,t);function e(e,r,n){this._o=e;this._i=r;this._state=n;t.call(this)}e.prototype.next=function(t){this._state.values[this._i]=t;this._state.hasValue[this._i]=true;this._state.hasValueAll=this._state.hasValue.every(v)};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=p;return e}(Ne);var tn=function(t){Vt(e,t);function e(e,r,n){this._o=e;this._cb=r;this._state=n;t.call(this)}e.prototype.next=function(t){var e=[t].concat(this._state.values);if(!this._state.hasValueAll){return}var r=A(this._cb).apply(null,e);if(r===I){return this._o.onError(r.e)}this._o.onNext(r)};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._o.onCompleted()};return e}(Ne);qe.withLatestFrom=function(){if(arguments.length===0){throw new Error("invalid arguments")}var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}var n=x(e[t-1])?e.pop():Fr;Array.isArray(e[0])&&(e=e[0]);return new Kr(this,e,n)};function Tr(){return false}function en(){return[]}var rn=function(t){Vt(e,t);function e(e,r){this._s=e;this._cb=r;t.call(this)}e.prototype.subscribeCore=function(t){var e=this._s.length,r=new Array(e),n=Zt(e,Tr),i=Zt(e,en);for(var o=0;o<e;o++){var s=this._s[o],a=new ee;r[o]=a;w(s)&&(s=Yn(s));a.setDisposable(s.subscribe(new nn(t,o,this,i,n)))}return new ie(r)};return e}(Be);var nn=function(t){Vt(e,t);function e(e,r,n,i,o){this._o=e;this._i=r;this._p=n;this._q=i;this._d=o;t.call(this)}function r(t){return t.length>0}function n(t){return t.shift()}function i(t){return function(e,r){return r!==t}}e.prototype.next=function(t){this._q[this._i].push(t);if(this._q.every(r)){var e=this._q.map(n);var o=A(this._p._cb).apply(null,e);if(o===I){return this._o.onError(o.e)}this._o.onNext(o)}else if(this._d.filter(i(this._i)).every(v)){this._o.onCompleted()}};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._d[this._i]=true;this._d.every(v)&&this._o.onCompleted()};return e}(Ne);qe.zip=function(){if(arguments.length===0){throw new Error("invalid arguments")}var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}var n=x(e[t-1])?e.pop():Fr;Array.isArray(e[0])&&(e=e[0]);var i=this;e.unshift(i);return new rn(e,n)};Oe.zip=function(){var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}if(Array.isArray(e[0])){e=x(e[1])?e[0].concat(e[1]):e[0]}var n=e.shift();return n.zip.apply(n,e)};function Tr(){return false}function en(){return[]}function Fr(){var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}return e}var on=function(t){Vt(e,t);function e(e,r){this.sources=e;this._cb=r;t.call(this)}e.prototype.subscribeCore=function(t){var e=this.sources,r=e.length,n=new Array(r);var i={q:Zt(r,en),done:Zt(r,Tr),cb:this._cb,o:t};for(var o=0;o<r;o++){(function(t){var r=e[t],o=new ee;(W(r)||G(r))&&(r=lr(r));n[t]=o;o.setDisposable(r.subscribe(new sn(i,t)))})(o)}return new ie(n)};return e}(Be);var sn=function(t){Vt(e,t);function e(e,r){this._s=e;this._i=r;t.call(this)}function r(t){return t.length>0}function n(t){return t.shift()}function i(t){return function(e,r){return r!==t}}e.prototype.next=function(t){this._s.q[this._i].push(t);if(this._s.q.every(r)){var e=this._s.q.map(n),o=A(this._s.cb).apply(null,e);if(o===I){return this._s.o.onError(o.e)}this._s.o.onNext(o)}else if(this._s.done.filter(i(this._i)).every(v)){this._s.o.onCompleted()}};e.prototype.error=function(t){this._s.o.onError(t)};e.prototype.completed=function(){this._s.done[this._i]=true;this._s.done.every(v)&&this._s.o.onCompleted()};return e}(Ne);qe.zipIterable=function(){if(arguments.length===0){throw new Error("invalid arguments")}var t=arguments.length,e=new Array(t);for(var r=0;r<t;r++){e[r]=arguments[r]}var n=x(e[t-1])?e.pop():Fr;var i=this;e.unshift(i);return new on(e,n)};function an(t){return function e(r){return t.subscribe(r)}}qe.asObservable=function(){return new xi(an(this),this)};var un=function(t){Vt(e,t);function e(e){this.source=e;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new cn(t))};return e}(Be);var cn=function(t){Vt(e,t);function e(e){this._o=e;t.call(this)}e.prototype.next=function(t){t.accept(this._o)};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._o.onCompleted()};return e}(Ne);qe.dematerialize=function(){return new un(this)};var fn=function(t){Vt(e,t);function e(e,r,n){this.source=e;this.keyFn=r;this.comparer=n;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new hn(t,this.keyFn,this.comparer))};return e}(Be);var hn=function(t){Vt(e,t);function e(e,r,n){this.o=e;this.keyFn=r;this.comparer=n;this.hasCurrentKey=false;this.currentKey=null;t.call(this)}e.prototype.next=function(t){var e=t,r;if(x(this.keyFn)){e=A(this.keyFn)(t);if(e===I){return this.o.onError(e.e)}}if(this.hasCurrentKey){r=A(this.comparer)(this.currentKey,e);if(r===I){return this.o.onError(r.e)}}if(!this.hasCurrentKey||!r){this.hasCurrentKey=true;this.currentKey=e;this.o.onNext(t)}};e.prototype.error=function(t){this.o.onError(t)};e.prototype.completed=function(){this.o.onCompleted()};return e}(Ne);qe.distinctUntilChanged=function(t,e){e||(e=y);return new fn(this,t,e)};var ln=function(t){Vt(e,t);function e(e,r,n,i){this.source=e;this._oN=r;this._oE=n;this._oC=i;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new r(t,this))};Vt(r,Ne);function r(t,e){this.o=t;this.t=!e._oN||x(e._oN)?Me(e._oN||p,e._oE||p,e._oC||p):e._oN;this.isStopped=false;Ne.call(this)}r.prototype.next=function(t){var e=A(this.t.onNext).call(this.t,t);if(e===I){this.o.onError(e.e)}this.o.onNext(t)};r.prototype.error=function(t){var e=A(this.t.onError).call(this.t,t);if(e===I){return this.o.onError(e.e)}this.o.onError(t)};r.prototype.completed=function(){var t=A(this.t.onCompleted).call(this.t);if(t===I){return this.o.onError(t.e)}this.o.onCompleted()};return e}(Be);qe["do"]=qe.tap=qe.doAction=function(t,e,r){return new ln(this,t,e,r)};qe.doOnNext=qe.tapOnNext=function(t,e){return this.tap(typeof e!=="undefined"?function(r){t.call(e,r)}:t)};qe.doOnError=qe.tapOnError=function(t,e){return this.tap(p,typeof e!=="undefined"?function(r){t.call(e,r)}:t)};qe.doOnCompleted=qe.tapOnCompleted=function(t,e){return this.tap(p,null,typeof e!=="undefined"?function(){t.call(e)}:t)};var dn=function(t){Vt(e,t);function e(e,r,n){this.source=e;this._fn=Q(r,n,0);t.call(this)}e.prototype.subscribeCore=function(t){var e=A(this.source.subscribe).call(this.source,t);if(e===I){this._fn();k(e.e)}return new r(e,this._fn)};function r(t,e){this.isDisposed=false;this._s=t;this._fn=e}r.prototype.dispose=function(){if(!this.isDisposed){var t=A(this._s.dispose).call(this._s);this._fn();t===I&&k(t.e)}};return e}(Be);qe["finally"]=function(t,e){return new dn(this,t,e)};var pn=function(t){Vt(e,t);function e(e){this.source=e;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new r(t))};function r(t){this.o=t;this.isStopped=false}r.prototype.onNext=p;r.prototype.onError=function(t){if(!this.isStopped){this.isStopped=true;this.o.onError(t)}};r.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};r.prototype.dispose=function(){this.isStopped=true};r.prototype.fail=function(t){if(!this.isStopped){this.isStopped=true;this.observer.onError(t);return true}return false};return e}(Be);qe.ignoreElements=function(){return new pn(this)};var vn=function(t){Vt(e,t);function e(e,r){this.source=e;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new mn(t))};return e}(Be);var mn=function(t){Vt(e,t);function e(e){this._o=e;t.call(this)}e.prototype.next=function(t){this._o.onNext(Pe(t))};e.prototype.error=function(t){this._o.onNext(Te(t));this._o.onCompleted()};e.prototype.completed=function(){this._o.onNext(Fe());this._o.onCompleted()};return e}(Ne);qe.materialize=function(){return new vn(this)};qe.repeat=function(t){return Ze(this,t).concat()};qe.retry=function(t){return Ze(this,t).catchError()};function yn(t){return{"@@iterator":function(){return{next:function(){return{done:false,value:t}}}}}}var gn=function(t){function e(t){return{isDisposed:false,dispose:function(){if(!this.isDisposed){this.isDisposed=true;t.isDisposed=true}}}}function r(e,r){this.source=e;this._notifier=r;t.call(this)}Vt(r,t);r.prototype.subscribeCore=function(t){var r=new Si,n=new Si,i=this._notifier(r),o=i.subscribe(n);var s=this.source["@@iterator"]();var a={isDisposed:false},u,c=new re;var f=de.scheduleRecursive(null,function(e,i){if(a.isDisposed){return}var o=s.next();if(o.done){if(u){t.onError(u)}else{t.onCompleted()}return}var f=o.value;w(f)&&(f=Yn(f));var h=new ee;var l=new ee;c.setDisposable(new ne(l,h));h.setDisposable(f.subscribe(function(e){t.onNext(e)},function(e){l.setDisposable(n.subscribe(i,function(e){t.onError(e)},function(){t.onCompleted()}));r.onNext(e);h.dispose()},function(){t.onCompleted()}))});return new ie([o,c,f,e(a)])};return r}(Be);qe.retryWhen=function(t){return new gn(yn(this),t)};function yn(t){return{"@@iterator":function(){return{next:function(){return{done:false,value:t}}}}}}var bn=function(t){function e(t){return{isDisposed:false,dispose:function(){if(!this.isDisposed){this.isDisposed=true;t.isDisposed=true}}}}function r(e,r){this.source=e;this._notifier=r;t.call(this)}Vt(r,t);r.prototype.subscribeCore=function(t){var r=new Si,n=new Si,i=this._notifier(r),o=i.subscribe(n);var s=this.source["@@iterator"]();var a={isDisposed:false},u,c=new re;var f=de.scheduleRecursive(null,function(e,i){if(a.isDisposed){return}var o=s.next();if(o.done){if(u){t.onError(u)}else{t.onCompleted()}return}var f=o.value;w(f)&&(f=Yn(f));var h=new ee;var l=new ee;c.setDisposable(new ne(l,h));h.setDisposable(f.subscribe(function(e){t.onNext(e)},function(e){t.onError(e)},function(){l.setDisposable(n.subscribe(i,function(e){t.onError(e)},function(){t.onCompleted()}));r.onNext(null);h.dispose()}))});return new ie([o,c,f,e(a)])};return r}(Be);qe.repeatWhen=function(t){return new bn(yn(this),t)};var _n=function(t){Vt(e,t);function e(e,r,n,i){this.source=e;this.accumulator=r;this.hasSeed=n;this.seed=i;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new wn(t,this))};return e}(Be);var wn=function(t){Vt(e,t);function e(e,r){this._o=e;this._p=r;this._fn=r.accumulator;this._hs=r.hasSeed;this._s=r.seed;this._ha=false;this._a=null;this._hv=false;this._i=0;t.call(this)}e.prototype.next=function(t){!this._hv&&(this._hv=true);if(this._ha){this._a=A(this._fn)(this._a,t,this._i,this._p)}else{this._a=this._hs?A(this._fn)(this._s,t,this._i,this._p):t;this._ha=true}if(this._a===I){return this._o.onError(this._a.e)}this._o.onNext(this._a);this._i++};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){!this._hv&&this._hs&&this._o.onNext(this._s);this._o.onCompleted()};return e}(Ne);qe.scan=function(){var t=false,e,r=arguments[0];if(arguments.length===2){t=true;e=arguments[1]}return new _n(this,r,t,e)};var xn=function(t){Vt(e,t);function e(e,r){this.source=e;this._c=r;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new Cn(t,this._c))};return e}(Be);var Cn=function(t){Vt(e,t);function e(e,r){this._o=e;this._c=r;this._q=[];t.call(this)}e.prototype.next=function(t){this._q.push(t);this._q.length>this._c&&this._o.onNext(this._q.shift())};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._o.onCompleted()};return e}(Ne);qe.skipLast=function(t){if(t<0){throw new L}return new xn(this,t)};qe.startWith=function(){var t,e,r=0;if(!!arguments.length&&ce(arguments[0])){e=arguments[0];r=1}else{e=he}for(var n=[],i=r,o=arguments.length;i<o;i++){n.push(arguments[i])}return Or.apply(null,[pr(n,e),this])};var In=function(t){Vt(e,t);function e(e,r){this._o=e;this._c=r;this._q=[];t.call(this)}e.prototype.next=function(t){this._q.push(t);this._q.length>this._c&&this._q.shift()};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){while(this._q.length>0){this._o.onNext(this._q.shift())}this._o.onCompleted()};return e}(Ne);qe.takeLast=function(t){if(t<0){throw new L}var e=this;return new xi(function(r){return e.subscribe(new In(r,t))},e)};qe.flatMapConcat=qe.concatMap=function(t,e,r){return new ze(this,t,e,r).merge(1)};var Sn=function(t){Vt(e,t);function e(e,r,n){this.source=e;this.selector=Q(r,n,3);t.call(this)}function r(t,e){return function(r,n,i){return t.call(this,e.selector(r,n,i),n,i)}}e.prototype.internalMap=function(t,n){return new e(this.source,r(t,this),n)};e.prototype.subscribeCore=function(t){return this.source.subscribe(new n(t,this.selector,this))};Vt(n,Ne);function n(t,e,r){this.o=t;this.selector=e;this.source=r;this.i=0;Ne.call(this)}n.prototype.next=function(t){var e=A(this.selector)(t,this.i++,this.source);if(e===I){return this.o.onError(e.e)}this.o.onNext(e)};n.prototype.error=function(t){this.o.onError(t)};n.prototype.completed=function(){this.o.onCompleted()};return e}(Be);qe.map=qe.select=function(t,e){var r=typeof t==="function"?t:function(){return t};return this instanceof Sn?this.internalMap(r,e):new Sn(this,r,e)};function An(t,e){return function n(i){var o=i;for(var s=0;s<e;s++){var a=o[t[s]];if(typeof a!=="undefined"){o=a}else{return r}}return o}}qe.pluck=function(){var t=arguments.length,e=new Array(t);if(t===0){throw new Error("List of properties cannot be empty.")}for(var r=0;r<t;r++){e[r]=arguments[r]}return this.map(An(e,t))};qe.flatMap=qe.selectMany=qe.mergeMap=function(t,e,r){return new ze(this,t,e,r).mergeAll()};qe.flatMapLatest=qe.switchMap=function(t,e,r){return new ze(this,t,e,r).switchLatest()};var kn=function(t){Vt(e,t);function e(e,r){this.source=e;this._count=r;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new r(t,this._count))};function r(t,e){this._o=t;this._r=e;Ne.call(this)}Vt(r,Ne);r.prototype.next=function(t){if(this._r<=0){this._o.onNext(t)}else{this._r--}};r.prototype.error=function(t){this._o.onError(t)};r.prototype.completed=function(){this._o.onCompleted()};return e}(Be);qe.skip=function(t){if(t<0){throw new L}return new kn(this,t)};var En=function(t){Vt(e,t);function e(e,r){this.source=e;this._fn=r;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new Pn(t,this))};return e}(Be);var Pn=function(t){Vt(e,t);function e(e,r){this._o=e;this._p=r;this._i=0;this._r=false;t.call(this)}e.prototype.next=function(t){if(!this._r){var e=A(this._p._fn)(t,this._i++,this._p);if(e===I){return this._o.onError(e.e)}this._r=!e}this._r&&this._o.onNext(t)};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._o.onCompleted()};return e}(Ne);qe.skipWhile=function(t,e){var r=Q(t,e,3);return new En(this,r)};var Tn=function(t){Vt(e,t);function e(e,r){this.source=e;this._count=r;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new r(t,this._count))};function r(t,e){this._o=t;this._c=e;this._r=e;Ne.call(this)}Vt(r,Ne);r.prototype.next=function(t){if(this._r-- >0){this._o.onNext(t);this._r<=0&&this._o.onCompleted()}};r.prototype.error=function(t){this._o.onError(t)};r.prototype.completed=function(){this._o.onCompleted()};return e}(Be);qe.take=function(t,e){if(t<0){throw new L}if(t===0){return tr(e)}return new Tn(this,t)};var Fn=function(t){Vt(e,t);function e(e,r){this.source=e;this._fn=r;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new Dn(t,this))};return e}(Be);var Dn=function(t){Vt(e,t);function e(e,r){this._o=e;this._p=r;this._i=0;this._r=true;t.call(this)}e.prototype.next=function(t){if(this._r){this._r=A(this._p._fn)(t,this._i++,this._p);if(this._r===I){return this._o.onError(this._r.e)}}if(this._r){this._o.onNext(t)}else{this._o.onCompleted()}};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._o.onCompleted()};return e}(Ne);qe.takeWhile=function(t,e){var r=Q(t,e,3);return new Fn(this,r)};var Mn=function(t){Vt(e,t);function e(e,r,n){this.source=e;this.predicate=Q(r,n,3);t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new n(t,this.predicate,this))};function r(t,e){return function(r,n,i){return e.predicate(r,n,i)&&t.call(this,r,n,i)}}e.prototype.internalFilter=function(t,n){return new e(this.source,r(t,this),n)};Vt(n,Ne);function n(t,e,r){this.o=t;this.predicate=e;this.source=r;this.i=0;Ne.call(this)}n.prototype.next=function(t){var e=A(this.predicate)(t,this.i++,this.source);if(e===I){return this.o.onError(e.e)}e&&this.o.onNext(t)};n.prototype.error=function(t){this.o.onError(t)};n.prototype.completed=function(){this.o.onCompleted()};return e}(Be);qe.filter=qe.where=function(t,e){return this instanceof Mn?this.internalFilter(t,e):new Mn(this,t,e)};function Nn(t,e,r,n){var i=new Ai;n.push(Rn(i,e,r));t.apply(e,n);return i.asObservable()}function Rn(t,e,r){return function n(){var i=arguments.length,o=new Array(i);for(var s=0;s<i;s++){o[s]=arguments[s]}if(x(r)){o=A(r).apply(e,o);if(o===I){return t.onError(o.e)}t.onNext(o)}else{if(o.length<=1){t.onNext(o[0])}else{t.onNext(o)}}t.onCompleted()}}Oe.fromCallback=function(t,e,r){return function(){typeof e==="undefined"&&(e=this);var n=arguments.length,i=new Array(n);for(var o=0;o<n;o++){i[o]=arguments[o]}return Nn(t,e,r,i)}};function qn(t,e,r,n){var i=new Ai;n.push(On(i,e,r));t.apply(e,n);return i.asObservable()}function On(t,e,r){return function n(){var i=arguments[0];if(i){return t.onError(i)}var o=arguments.length,s=[];for(var a=1;a<o;a++){s[a-1]=arguments[a]}if(x(r)){var s=A(r).apply(e,s);if(s===I){return t.onError(s.e)}t.onNext(s)}else{if(s.length<=1){t.onNext(s[0])}else{t.onNext(s)}}t.onCompleted()}}Oe.fromNodeCallback=function(t,e,r){return function(){typeof e==="undefined"&&(e=this);var n=arguments.length,i=new Array(n);for(var o=0;o<n;o++){i[o]=arguments[o]}return qn(t,e,r,i)}};function Un(t){if(l.StaticNodeList){return t instanceof l.StaticNodeList||t instanceof l.NodeList}else{return Object.prototype.toString.call(t)==="[object NodeList]"}}function Bn(t,e,r){this._e=t;this._n=e;this._fn=r;this._e.addEventListener(this._n,this._fn,false);this.isDisposed=false}Bn.prototype.dispose=function(){if(!this.isDisposed){this._e.removeEventListener(this._n,this._fn,false);this.isDisposed=true}};function zn(t,e,r){var n=new Ht;var i=Object.prototype.toString.call(t);if(Un(t)||i==="[object HTMLCollection]"){for(var o=0,s=t.length;o<s;o++){n.add(zn(t.item(o),e,r))}}else if(t){n.add(new Bn(t,e,r))}return n}d.config.useNativeEvents=false;var Ln=function(t){Vt(e,t);function e(e,r,n){this._el=e;this._n=r;this._fn=n;t.call(this)}function r(t,e){return function r(){var n=arguments[0];if(x(e)){n=A(e).apply(null,arguments);if(n===I){return t.onError(n.e)}}t.onNext(n)}}e.prototype.subscribeCore=function(t){return zn(this._el,this._n,r(t,this._fn))};return e}(Be);Oe.fromEvent=function(t,e,r){if(t.addListener){return Vn(function(r){t.addListener(e,r)},function(r){t.removeListener(e,r)},r)}if(!d.config.useNativeEvents){if(typeof t.on==="function"&&typeof t.off==="function"){return Vn(function(r){t.on(e,r)},function(r){t.off(e,r)},r)}}return new Ln(t,e,r).publish().refCount()};var jn=function(t){Vt(e,t);function e(e,r,n){this._add=e;this._del=r;this._fn=n;t.call(this)}function r(t,e){return function r(){var n=arguments[0];if(x(e)){n=A(e).apply(null,arguments);if(n===I){return t.onError(n.e)}}t.onNext(n)}}e.prototype.subscribeCore=function(t){var e=r(t,this._fn);var i=this._add(e);return new n(this._del,e,i)};function n(t,e,r){this._del=t;this._fn=e;this._ret=r;this.isDisposed=false}n.prototype.dispose=function(){if(!this.isDisposed){x(this._del)&&this._del(this._fn,this._ret);this.isDisposed=true}};return e}(Be);var Vn=Oe.fromEventPattern=function(t,e,r){return new jn(t,e,r).publish().refCount()};var Xn=function(t){Vt(e,t);function e(e,r){this._p=e;this._s=r;t.call(this)}function r(t,e){var r=e[0],n=e[1];r.onNext(n);r.onCompleted()}function n(t,e){var r=e[0],n=e[1];r.onError(n)}e.prototype.subscribeCore=function(t){var e=new ee,i=this,o=this._p;if(x(o)){o=A(o)();if(o===I){t.onError(o.e);return e}}o.then(function(n){e.setDisposable(i._s.schedule([t,n],r))},function(r){e.setDisposable(i._s.schedule([t,r],n))});return e};return e}(Be);var Yn=Oe.fromPromise=function(t,e){e||(e=we);return new Xn(t,e)};qe.toPromise=function(t){t||(t=d.config.Promise);if(!t){throw new j("Promise type not provided nor in Rx.config.Promise")}var e=this;return new t(function(t,r){var n;e.subscribe(function(t){n=t},r,function(){t(n)})})}
;Oe.startAsync=function(t){var e=A(t)();if(e===I){return Ar(e.e)}return Yn(e)};var Zn=function(t){Vt(e,t);function e(e,r,n){this.source=e;this._fn1=r;this._fn2=n;t.call(this)}e.prototype.subscribeCore=function(t){var e=this.source.multicast(this._fn1());return new ne(this._fn2(e).subscribe(t),e.connect())};return e}(Be);qe.multicast=function(t,e){return x(t)?new Zn(this,t,e):new Gn(this,t)};qe.publish=function(t){return t&&x(t)?this.multicast(function(){return new Si},t):this.multicast(new Si)};qe.share=function(){return this.publish().refCount()};qe.publishLast=function(t){return t&&x(t)?this.multicast(function(){return new Ai},t):this.multicast(new Ai)};qe.publishValue=function(t,e){return arguments.length===2?this.multicast(function(){return new Ei(e)},t):this.multicast(new Ei(t))};qe.shareValue=function(t){return this.publishValue(t).refCount()};qe.replay=function(t,e,r,n){return t&&x(t)?this.multicast(function(){return new Pi(e,r,n)},t):this.multicast(new Pi(e,r,n))};qe.shareReplay=function(t,e,r){return this.replay(null,t,e,r).refCount()};var Hn=function(t){Vt(e,t);function e(e){this.source=e;this._count=0;this._connectableSubscription=null;t.call(this)}e.prototype.subscribeCore=function(t){var e=this.source.subscribe(t);++this._count===1&&(this._connectableSubscription=this.source.connect());return new r(this,e)};function r(t,e){this._p=t;this._s=e;this.isDisposed=false}r.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;this._s.dispose();--this._p._count===0&&this._p._connectableSubscription.dispose()}};return e}(Be);var Gn=d.ConnectableObservable=function(t){Vt(e,t);function e(e,r){this.source=e;this._connection=null;this._source=e.asObservable();this._subject=r;t.call(this)}function r(t,e){this._p=t;this._s=e}r.prototype.dispose=function(){if(this._s){this._s.dispose();this._s=null;this._p._connection=null}};e.prototype.connect=function(){if(!this._connection){if(this._subject.isStopped){return Jt}var t=this._source.subscribe(this._subject);this._connection=new r(this,t)}return this._connection};e.prototype._subscribe=function(t){return this._subject.subscribe(t)};e.prototype.refCount=function(){return new Hn(this)};return e}(Oe);var Wn=function(t){Vt(e,t);function e(e,r){this._dt=e;this._s=r;t.call(this)}e.prototype.subscribeCore=function(t){return this._s.scheduleFuture(t,this._dt,r)};function r(t,e){e.onNext(0);e.onCompleted()}return e}(Be);function Qn(t,e){return new Wn(t,e)}function Jn(t,e,r){return new xi(function(n){var i=t,o=ue(e);return r.scheduleRecursiveFuture(0,i,function(t,e){if(o>0){var s=r.now();i=new Date(i.getTime()+o);i.getTime()<=s&&(i=new Date(s+o))}n.onNext(t);e(t+1,new Date(i))})})}function Kn(t,e,r){return t===e?new xi(function(t){return r.schedulePeriodic(0,e,function(e){t.onNext(e);return e+1})}):Je(function(){return Jn(new Date(r.now()+t),e,r)})}var $n=Oe.interval=function(t,e){return Kn(t,t,ce(e)?e:we)};var ti=Oe.timer=function(t,e,n){var i;ce(n)||(n=we);if(e!=null&&typeof e==="number"){i=e}else if(ce(e)){n=e}if((t instanceof Date||typeof t==="number")&&i===r){return Qn(t,n)}if(t instanceof Date&&i!==r){return Jn(t,e,n)}return Kn(t,i,n)};function ei(t,e,r){return new xi(function(n){var i=false,o=new re,s=null,a=[],u=false,c;c=t.materialize().timestamp(r).subscribe(function(t){var c,f;if(t.value.kind==="E"){a=[];a.push(t);s=t.value.error;f=!u}else{a.push({value:t.value,timestamp:t.timestamp+e});f=!i;i=true}if(f){if(s!==null){n.onError(s)}else{c=new ee;o.setDisposable(c);c.setDisposable(r.scheduleRecursiveFuture(null,e,function(t,e){var o,c,f,h;if(s!==null){return}u=true;do{f=null;if(a.length>0&&a[0].timestamp-r.now()<=0){f=a.shift().value}if(f!==null){f.accept(n)}}while(f!==null);h=false;c=0;if(a.length>0){h=true;c=Math.max(0,a[0].timestamp-r.now())}else{i=false}o=s;u=false;if(o!==null){n.onError(o)}else if(h){e(null,c)}}))}}});return new ne(c,o)},t)}function ri(t,e,r){return Je(function(){return ei(t,e-r.now(),r)})}function ni(t,e,r){var n,i;if(x(e)){i=e}else{n=e;i=r}return new xi(function(e){var r=new Ht,o=false,s=new re;function a(){s.setDisposable(t.subscribe(function(t){var n=A(i)(t);if(n===I){return e.onError(n.e)}var o=new ee;r.add(o);o.setDisposable(n.subscribe(function(){e.onNext(t);r.remove(o);u()},function(t){e.onError(t)},function(){e.onNext(t);r.remove(o);u()}))},function(t){e.onError(t)},function(){o=true;s.dispose();u()}))}function u(){o&&r.length===0&&e.onCompleted()}if(!n){a()}else{s.setDisposable(n.subscribe(a,function(t){e.onError(t)},a))}return new ne(s,r)},t)}qe.delay=function(){var t=arguments[0];if(typeof t==="number"||t instanceof Date){var e=t,r=arguments[1];ce(r)||(r=we);return e instanceof Date?ri(this,e,r):ei(this,e,r)}else if(Oe.isObservable(t)||x(t)){return ni(this,t,arguments[1])}else{throw new Error("Invalid arguments")}};var ii=function(t){Vt(e,t);function e(e,r,n){ce(n)||(n=we);this.source=e;this._dt=r;this._s=n;t.call(this)}e.prototype.subscribeCore=function(t){var e=new re;return new ne(this.source.subscribe(new oi(t,this._dt,this._s,e)),e)};return e}(Be);var oi=function(t){Vt(e,t);function e(e,r,n,i){this._o=e;this._d=r;this._scheduler=n;this._c=i;this._v=null;this._hv=false;this._id=0;t.call(this)}function r(t,e){e.self._hv&&e.self._id===e.currentId&&e.self._o.onNext(e.x);e.self._hv=false}e.prototype.next=function(t){this._hv=true;this._v=t;var e=++this._id,r=new ee;this._c.setDisposable(r);r.setDisposable(this._scheduler.scheduleFuture(this,this._d,function(r,n){n._hv&&n._id===e&&n._o.onNext(t);n._hv=false}))};e.prototype.error=function(t){this._c.dispose();this._o.onError(t);this._hv=false;this._id++};e.prototype.completed=function(){this._c.dispose();this._hv&&this._o.onNext(this._v);this._o.onCompleted();this._hv=false;this._id++};return e}(Ne);function si(t,e){return new xi(function(r){var n,i=false,o=new re,s=0;var a=t.subscribe(function(t){var a=A(e)(t);if(a===I){return r.onError(a.e)}w(a)&&(a=Yn(a));i=true;n=t;s++;var u=s,c=new ee;o.setDisposable(c);c.setDisposable(a.subscribe(function(){i&&s===u&&r.onNext(n);i=false;c.dispose()},function(t){r.onError(t)},function(){i&&s===u&&r.onNext(n);i=false;c.dispose()}))},function(t){o.dispose();r.onError(t);i=false;s++},function(){o.dispose();i&&r.onNext(n);r.onCompleted();i=false;s++});return new ne(a,o)},t)}qe.debounce=function(){if(x(arguments[0])){return si(this,arguments[0])}else if(typeof arguments[0]==="number"){return new ii(this,arguments[0],arguments[1])}else{throw new Error("Invalid arguments")}};var ai=function(t){Vt(e,t);function e(e,r){this.source=e;this._s=r;t.call(this)}e.prototype.subscribeCore=function(t){return this.source.subscribe(new ui(t,this._s))};return e}(Be);var ui=function(t){Vt(e,t);function e(e,r){this._o=e;this._s=r;t.call(this)}e.prototype.next=function(t){this._o.onNext({value:t,timestamp:this._s.now()})};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._o.onCompleted()};return e}(Ne);qe.timestamp=function(t){ce(t)||(t=we);return new ai(this,t)};var ci=function(t){Vt(e,t);function e(e,r){this.source=e;this._sampler=r;t.call(this)}e.prototype.subscribeCore=function(t){var e={o:t,atEnd:false,value:null,hasValue:false,sourceSubscription:new ee};e.sourceSubscription.setDisposable(this.source.subscribe(new hi(e)));return new ne(e.sourceSubscription,this._sampler.subscribe(new fi(e)))};return e}(Be);var fi=function(t){Vt(e,t);function e(e){this._s=e;t.call(this)}e.prototype._handleMessage=function(){if(this._s.hasValue){this._s.hasValue=false;this._s.o.onNext(this._s.value)}this._s.atEnd&&this._s.o.onCompleted()};e.prototype.next=function(){this._handleMessage()};e.prototype.error=function(t){this._s.onError(t)};e.prototype.completed=function(){this._handleMessage()};return e}(Ne);var hi=function(t){Vt(e,t);function e(e){this._s=e;t.call(this)}e.prototype.next=function(t){this._s.hasValue=true;this._s.value=t};e.prototype.error=function(t){this._s.o.onError(t)};e.prototype.completed=function(){this._s.atEnd=true;this._s.sourceSubscription.dispose()};return e}(Ne);qe.sample=function(t,e){ce(e)||(e=we);return typeof t==="number"?new ci(this,$n(t,e)):new ci(this,t)};var li=d.TimeoutError=function(t){this.message=t||"Timeout has occurred";this.name="TimeoutError";Error.call(this)};li.prototype=Object.create(Error.prototype);function di(t,e,r,n){if(x(e)){n=r;r=e;e=yr()}Oe.isObservable(n)||(n=Ar(new li));return new xi(function(i){var o=new re,s=new re,a=new ee;o.setDisposable(a);var u=0,c=false;function f(t){var e=u,r=new ee;function a(){c=e===u;return c}s.setDisposable(r);r.setDisposable(t.subscribe(function(){a()&&o.setDisposable(n.subscribe(i));r.dispose()},function(t){a()&&i.onError(t)},function(){a()&&o.setDisposable(n.subscribe(i))}))}f(e);function h(){var t=!c;if(t){u++}return t}a.setDisposable(t.subscribe(function(t){if(h()){i.onNext(t);var e=A(r)(t);if(e===I){return i.onError(e.e)}f(w(e)?Yn(e):e)}},function(t){h()&&i.onError(t)},function(){h()&&i.onCompleted()}));return new ne(o,s)},t)}function pi(t,e,r,n){if(ce(r)){n=r;r=Ar(new li)}if(r instanceof Error){r=Ar(r)}ce(n)||(n=we);Oe.isObservable(r)||(r=Ar(new li));return new xi(function(i){var o=0,s=new ee,a=new re,u=false,c=new re;a.setDisposable(s);function f(){var t=o;c.setDisposable(n.scheduleFuture(null,e,function(){u=o===t;if(u){w(r)&&(r=Yn(r));a.setDisposable(r.subscribe(i))}}))}f();s.setDisposable(t.subscribe(function(t){if(!u){o++;i.onNext(t);f()}},function(t){if(!u){o++;i.onError(t)}},function(){if(!u){o++;i.onCompleted()}}));return new ne(a,c)},t)}qe.timeout=function(){var t=arguments[0];if(t instanceof Date||typeof t==="number"){return pi(this,t,arguments[1],arguments[2])}else if(Oe.isObservable(t)||x(t)){return di(this,t,arguments[1],arguments[2])}else{throw new Error("Invalid arguments")}};qe.throttle=function(t,e){ce(e)||(e=we);var r=+t||0;if(r<=0){throw new RangeError("windowDuration cannot be less or equal zero.")}var n=this;return new xi(function(t){var i=0;return n.subscribe(function(n){var o=e.now();if(i===0||o-i>=r){i=o;t.onNext(n)}},function(e){t.onError(e)},function(){t.onCompleted()})},n)};var vi=function(t){Vt(e,t);function e(e,r){this.source=e;this.controller=new Si;this.paused=true;if(r&&r.subscribe){this.pauser=this.controller.merge(r)}else{this.pauser=this.controller}t.call(this)}e.prototype._subscribe=function(t){var e=this.source.publish(),r=e.subscribe(t),n=Jt;var i=this.pauser.startWith(!this.paused).distinctUntilChanged().subscribe(function(t){if(t){n=e.connect()}else{n.dispose();n=Jt}});return new ie([r,n,i])};e.prototype.pause=function(){this.paused=true;this.controller.onNext(false)};e.prototype.resume=function(){this.paused=false;this.controller.onNext(true)};return e}(Oe);qe.pausable=function(t){return new vi(this,t)};function mi(t,e,r){return new xi(function(n){var i=[false,false],o=false,s=false,a=new Array(2),u;function c(t,e){a[e]=t;i[e]=true;if(o||(o=i.every(v))){if(u){return n.onError(u)}var c=A(r).apply(null,a);if(c===I){return n.onError(c.e)}n.onNext(c)}s&&a[1]&&n.onCompleted()}return new ne(t.subscribe(function(t){c(t,0)},function(t){if(a[1]){n.onError(t)}else{u=t}},function(){s=true;a[1]&&n.onCompleted()}),e.subscribe(function(t){c(t,1)},function(t){n.onError(t)},function(){s=true;c(true,1)}))},t)}var yi=function(t){Vt(e,t);function e(e,r){this.source=e;this.controller=new Si;this.paused=true;if(r&&r.subscribe){this.pauser=this.controller.merge(r)}else{this.pauser=this.controller}t.call(this)}e.prototype._subscribe=function(t){var e=[],n;function i(){while(e.length>0){t.onNext(e.shift())}}var o=mi(this.source,this.pauser.startWith(!this.paused).distinctUntilChanged(),function(t,e){return{data:t,shouldFire:e}}).subscribe(function(o){if(n!==r&&o.shouldFire!==n){n=o.shouldFire;if(o.shouldFire){i()}}else{n=o.shouldFire;if(o.shouldFire){t.onNext(o.data)}else{e.push(o.data)}}},function(e){i();t.onError(e)},function(){i();t.onCompleted()});return o};e.prototype.pause=function(){this.paused=true;this.controller.onNext(false)};e.prototype.resume=function(){this.paused=false;this.controller.onNext(true)};return e}(Oe);qe.pausableBuffered=function(t){return new yi(this,t)};var gi=function(t){Vt(e,t);function e(e,r,n){t.call(this);this.subject=new bi(r,n);this.source=e.multicast(this.subject).refCount()}e.prototype._subscribe=function(t){return this.source.subscribe(t)};e.prototype.request=function(t){return this.subject.request(t==null?-1:t)};return e}(Oe);var bi=function(t){Vt(e,t);function e(e,r){e==null&&(e=true);t.call(this);this.subject=new Si;this.enableQueue=e;this.queue=e?[]:null;this.requestedCount=0;this.requestedDisposable=null;this.error=null;this.hasFailed=false;this.hasCompleted=false;this.scheduler=r||de}Xt(e.prototype,De,{_subscribe:function(t){return this.subject.subscribe(t)},onCompleted:function(){this.hasCompleted=true;if(!this.enableQueue||this.queue.length===0){this.subject.onCompleted();this.disposeCurrentRequest()}else{this.queue.push(Se.createOnCompleted())}},onError:function(t){this.hasFailed=true;this.error=t;if(!this.enableQueue||this.queue.length===0){this.subject.onError(t);this.disposeCurrentRequest()}else{this.queue.push(Se.createOnError(t))}},onNext:function(t){if(this.requestedCount<=0){this.enableQueue&&this.queue.push(Se.createOnNext(t))}else{this.requestedCount--===0&&this.disposeCurrentRequest();this.subject.onNext(t)}},_processRequest:function(t){if(this.enableQueue){while(this.queue.length>0&&(t>0||this.queue[0].kind!=="N")){var e=this.queue.shift();e.accept(this.subject);if(e.kind==="N"){t--}else{this.disposeCurrentRequest();this.queue=[]}}}return t},request:function(t){this.disposeCurrentRequest();var e=this;this.requestedDisposable=this.scheduler.schedule(t,function(t,r){var n=e._processRequest(r);var i=e.hasCompleted||e.hasFailed;if(!i&&n>0){e.requestedCount=n;return Qt(function(){e.requestedCount=0})}});return this.requestedDisposable},disposeCurrentRequest:function(){if(this.requestedDisposable){this.requestedDisposable.dispose();this.requestedDisposable=null}}});return e}(Oe);qe.controlled=function(t,e){if(t&&ce(t)){e=t;t=true}if(t==null){t=true}return new gi(this,t,e)};qe.pipe=function(t){var e=this.pausableBuffered();function r(){e.resume()}t.addListener("drain",r);e.subscribe(function(r){!t.write(r)&&e.pause()},function(e){t.emit("error",e)},function(){!t._isStdio&&t.end();t.removeListener("drain",r)});e.resume();return t};var _i=function(t){Vt(e,t);function e(e,r){this._o=e;this._xform=r;t.call(this)}e.prototype.next=function(t){var e=A(this._xform["@@transducer/step"]).call(this._xform,this._o,t);if(e===I){this._o.onError(e.e)}};e.prototype.error=function(t){this._o.onError(t)};e.prototype.completed=function(){this._xform["@@transducer/result"](this._o)};return e}(Ne);function wi(t){return{"@@transducer/init":function(){return t},"@@transducer/step":function(t,e){return t.onNext(e)},"@@transducer/result":function(t){return t.onCompleted()}}}qe.transduce=function(t){var e=this;return new xi(function(r){var n=t(wi(r));return e.subscribe(new _i(r,n))},e)};var xi=d.AnonymousObservable=function(t){Vt(n,t);function e(t){return t&&x(t.dispose)?t:x(t)?Qt(t):Jt}function r(t,r){var n=r[0],i=r[1];var o=A(i.__subscribe).call(i,n);if(o===I&&!n.fail(I.e)){k(I.e)}n.setDisposable(e(o))}function n(e,r){this.source=r;this.__subscribe=e;t.call(this)}n.prototype._subscribe=function(t){var e=new Ci(t),n=[e,this];if(de.scheduleRequired()){de.schedule(n,r)}else{r(null,n)}return e};return n}(Oe);var Ci=function(t){Vt(e,t);function e(e){t.call(this);this.observer=e;this.m=new ee}var r=e.prototype;r.next=function(t){var e=A(this.observer.onNext).call(this.observer,t);if(e===I){this.dispose();k(e.e)}};r.error=function(t){var e=A(this.observer.onError).call(this.observer,t);this.dispose();e===I&&k(e.e)};r.completed=function(){var t=A(this.observer.onCompleted).call(this.observer);this.dispose();t===I&&k(t.e)};r.setDisposable=function(t){this.m.setDisposable(t)};r.getDisposable=function(){return this.m.getDisposable()};r.dispose=function(){t.prototype.dispose.call(this);this.m.dispose()};return e}(Ne);var Ii=function(t,e){this._s=t;this._o=e};Ii.prototype.dispose=function(){if(!this._s.isDisposed&&this._o!==null){var t=this._s.observers.indexOf(this._o);this._s.observers.splice(t,1);this._o=null}};var Si=d.Subject=function(t){Vt(e,t);function e(){t.call(this);this.isDisposed=false;this.isStopped=false;this.observers=[];this.hasError=false}Xt(e.prototype,De.prototype,{_subscribe:function(t){$t(this);if(!this.isStopped){this.observers.push(t);return new Ii(this,t)}if(this.hasError){t.onError(this.error);return Jt}t.onCompleted();return Jt},hasObservers:function(){$t(this);return this.observers.length>0},onCompleted:function(){$t(this);if(!this.isStopped){this.isStopped=true;for(var t=0,e=C(this.observers),r=e.length;t<r;t++){e[t].onCompleted()}this.observers.length=0}},onError:function(t){$t(this);if(!this.isStopped){this.isStopped=true;this.error=t;this.hasError=true;for(var e=0,r=C(this.observers),n=r.length;e<n;e++){r[e].onError(t)}this.observers.length=0}},onNext:function(t){$t(this);if(!this.isStopped){for(var e=0,r=C(this.observers),n=r.length;e<n;e++){r[e].onNext(t)}}},dispose:function(){this.isDisposed=true;this.observers=null}});e.create=function(t,e){return new ki(t,e)};return e}(Oe);var Ai=d.AsyncSubject=function(t){Vt(e,t);function e(){t.call(this);this.isDisposed=false;this.isStopped=false;this.hasValue=false;this.observers=[];this.hasError=false}Xt(e.prototype,De.prototype,{_subscribe:function(t){$t(this);if(!this.isStopped){this.observers.push(t);return new Ii(this,t)}if(this.hasError){t.onError(this.error)}else if(this.hasValue){t.onNext(this.value);t.onCompleted()}else{t.onCompleted()}return Jt},hasObservers:function(){$t(this);return this.observers.length>0},onCompleted:function(){var t,e;$t(this);if(!this.isStopped){this.isStopped=true;var r=C(this.observers),e=r.length;if(this.hasValue){for(t=0;t<e;t++){var n=r[t];n.onNext(this.value);n.onCompleted()}}else{for(t=0;t<e;t++){r[t].onCompleted()}}this.observers.length=0}},onError:function(t){$t(this);if(!this.isStopped){this.isStopped=true;this.hasError=true;this.error=t;for(var e=0,r=C(this.observers),n=r.length;e<n;e++){r[e].onError(t)}this.observers.length=0}},onNext:function(t){$t(this);if(this.isStopped){return}this.value=t;this.hasValue=true},dispose:function(){this.isDisposed=true;this.observers=null;this.error=null;this.value=null}});return e}(Oe);var ki=d.AnonymousSubject=function(t){Vt(e,t);function e(e,r){this.observer=e;this.observable=r;t.call(this)}Xt(e.prototype,De.prototype,{_subscribe:function(t){return this.observable.subscribe(t)},onCompleted:function(){this.observer.onCompleted()},onError:function(t){this.observer.onError(t)},onNext:function(t){this.observer.onNext(t)}});return e}(Oe);var Ei=d.BehaviorSubject=function(t){Vt(e,t);function e(e){t.call(this);this.value=e;this.observers=[];this.isDisposed=false;this.isStopped=false;this.hasError=false}Xt(e.prototype,De.prototype,{_subscribe:function(t){$t(this);if(!this.isStopped){this.observers.push(t);t.onNext(this.value);return new Ii(this,t)}if(this.hasError){t.onError(this.error)}else{t.onCompleted()}return Jt},getValue:function(){$t(this);if(this.hasError){k(this.error)}return this.value},hasObservers:function(){$t(this);return this.observers.length>0},onCompleted:function(){$t(this);if(this.isStopped){return}this.isStopped=true;for(var t=0,e=C(this.observers),r=e.length;t<r;t++){e[t].onCompleted()}this.observers.length=0},onError:function(t){$t(this);if(this.isStopped){return}this.isStopped=true;this.hasError=true;this.error=t;for(var e=0,r=C(this.observers),n=r.length;e<n;e++){r[e].onError(t)}this.observers.length=0},onNext:function(t){$t(this);if(this.isStopped){return}this.value=t;for(var e=0,r=C(this.observers),n=r.length;e<n;e++){r[e].onNext(t)}},dispose:function(){this.isDisposed=true;this.observers=null;this.value=null;this.error=null}});return e}(Oe);var Pi=d.ReplaySubject=function(t){var e=Math.pow(2,53)-1;function r(t,e){return Qt(function(){e.dispose();!t.isDisposed&&t.observers.splice(t.observers.indexOf(e),1)})}Vt(n,t);function n(r,n,i){this.bufferSize=r==null?e:r;this.windowSize=n==null?e:n;this.scheduler=i||de;this.q=[];this.observers=[];this.isStopped=false;this.isDisposed=false;this.hasError=false;this.error=null;t.call(this)}Xt(n.prototype,De.prototype,{_subscribe:function(t){$t(this);var e=new Ue(this.scheduler,t),n=r(this,e);this._trim(this.scheduler.now());this.observers.push(e);for(var i=0,o=this.q.length;i<o;i++){e.onNext(this.q[i].value)}if(this.hasError){e.onError(this.error)}else if(this.isStopped){e.onCompleted()}e.ensureActive();return n},hasObservers:function(){$t(this);return this.observers.length>0},_trim:function(t){while(this.q.length>this.bufferSize){this.q.shift()}while(this.q.length>0&&t-this.q[0].interval>this.windowSize){this.q.shift()}},onNext:function(t){$t(this);if(this.isStopped){return}var e=this.scheduler.now();this.q.push({interval:e,value:t});this._trim(e);for(var r=0,n=C(this.observers),i=n.length;r<i;r++){var o=n[r];o.onNext(t);o.ensureActive()}},onError:function(t){$t(this);if(this.isStopped){return}this.isStopped=true;this.error=t;this.hasError=true;var e=this.scheduler.now();this._trim(e);for(var r=0,n=C(this.observers),i=n.length;r<i;r++){var o=n[r];o.onError(t);o.ensureActive()}this.observers.length=0},onCompleted:function(){$t(this);if(this.isStopped){return}this.isStopped=true;var t=this.scheduler.now();this._trim(t);for(var e=0,r=C(this.observers),n=r.length;e<n;e++){var i=r[e];i.onCompleted();i.ensureActive()}this.observers.length=0},dispose:function(){this.isDisposed=true;this.observers=null}});return n}(Oe);d.Pauser=function(t){Vt(e,t);function e(){t.call(this)}e.prototype.pause=function(){this.onNext(false)};e.prototype.resume=function(){this.onNext(true)};return e}(Si);t.Rx=d;var Ti=O()}).call(this,n,e);var i=n.Rx;/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){t.VERSION={number:"1.1.5",date:"April 20 2017"}})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){var e;(function(t){function e(t){return t.creator&&t.chunkSize}t.is=e;function r(t,e,r,n,i){if(t.currentIndex>=t.chunkSize){t.currentIndex=0;t.current=t.creator(t.chunkSize);t.parts[t.parts.length]=t.current}t.current[t.currentIndex++]=e;t.current[t.currentIndex++]=r;t.current[t.currentIndex++]=n;t.current[t.currentIndex++]=i;return t.elementCount++}t.add4=r;function n(t,e,r,n){if(t.currentIndex>=t.chunkSize){t.currentIndex=0;t.current=t.creator(t.chunkSize);t.parts[t.parts.length]=t.current}t.current[t.currentIndex++]=e;t.current[t.currentIndex++]=r;t.current[t.currentIndex++]=n;return t.elementCount++}t.add3=n;function i(t,e,r){if(t.currentIndex>=t.chunkSize){t.currentIndex=0;t.current=t.creator(t.chunkSize);t.parts[t.parts.length]=t.current}t.current[t.currentIndex++]=e;t.current[t.currentIndex++]=r;return t.elementCount++}t.add2=i;function o(t,e){if(t.currentIndex>=t.chunkSize){t.currentIndex=0;t.current=t.creator(t.chunkSize);t.parts[t.parts.length]=t.current}t.current[t.currentIndex++]=e;return t.elementCount++}t.add=o;function s(t){var e=t.creator(t.elementSize*t.elementCount),r=(t.parts.length-1)*t.chunkSize,n=0,i;if(t.parts.length>1){if(t.parts[0].buffer){for(var o=0;o<t.parts.length-1;o++){e.set(t.parts[o],t.chunkSize*o)}}else{for(var o=0;o<t.parts.length-1;o++){n=t.chunkSize*o;i=t.parts[o];for(var s=0;s<t.chunkSize;s++){e[n+s]=i[s]}}}}if(t.current.buffer&&t.currentIndex>=t.chunkSize){e.set(t.current,t.chunkSize*(t.parts.length-1))}else{for(var o=0;o<t.currentIndex;o++){e[r+o]=t.current[o]}}return e}t.compact=s;function a(t){if(t===void 0){t=262144}return p(function(t){return new Float32Array(t)},t,3)}t.forVertex3D=a;function u(t){if(t===void 0){t=262144}return p(function(t){return new Uint32Array(t)},t,3)}t.forIndexBuffer=u;function c(t){if(t===void 0){t=131072}return p(function(t){return new Int32Array(t)},t,2)}t.forTokenIndices=c;function f(t){if(t===void 0){t=131072}return p(function(t){return new Int32Array(t)},t,1)}t.forIndices=f;function h(t){if(t===void 0){t=131072}return p(function(t){return new Int32Array(t)},t,1)}t.forInt32=h;function l(t){if(t===void 0){t=131072}return p(function(t){return new Float32Array(t)},t,1)}t.forFloat32=l;function d(t){if(t===void 0){t=131072}return p(function(t){return[]},t,1)}t.forArray=d;function p(t,e,r){e=e|0;if(e<=0)e=1;var n=e*r;var i=t(n);return{elementSize:r,chunkSize:n,creator:t,current:i,parts:[i],currentIndex:0,elementCount:0}}t.create=p})(e=t.ChunkedArray||(t.ChunkedArray={}))})(e=t.Utils||(t.Utils={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){var e;(function(t){"use strict";function e(t,e,n){while(e<n&&t.charCodeAt(e)===32)e++;return r(t,e,n)}t.parseIntSkipTrailingWhitespace=e;function r(t,e,r){var n=0,i=1;if(t.charCodeAt(e)===45){i=-1;e++}for(;e<r;e++){var o=t.charCodeAt(e)-48;if(o>9||o<0)return i*n|0;else n=10*n+o|0}return i*n}t.parseInt=r;function n(t,e,n,i){if(e.charCodeAt(n)===43)n++;return t*Math.pow(10,r(e,n,i))}function i(t,e,r){while(e<r&&t.charCodeAt(e)===32)e++;return o(t,e,r)}t.parseFloatSkipTrailingWhitespace=i;function o(t,e,r){var i=1,o=0,s=0,a=1;if(t.charCodeAt(e)===45){i=-1;++e}while(e<r){var u=t.charCodeAt(e)-48;if(u>=0&&u<10){o=o*10+u;++e}else if(u===-2){++e;while(e<r){u=t.charCodeAt(e)-48;if(u>=0&&u<10){s=10*s+u;a=10*a;++e}else if(u===53||u===21){return n(i*(o+s/a),t,e+1,r)}else{return i*(o+s/a)}}return i*(o+s/a)}else if(u===53||u===21){return n(i*o,t,e+1,r)}else break}return i*o}t.parseFloat=o})(e=t.FastNumberParsers||(t.FastNumberParsers={}))})(e=t.Utils||(t.Utils={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){var e=[];(function(){var t="";for(var r=0;r<512;r++){e[r]=t;t=t+" "}})();var r;(function(t){function r(t){if(t===void 0){t=512}return{chunkData:[],chunkOffset:0,chunkCapacity:t,data:[]}}t.create=r;function n(t){if(!t.data.length){if(t.chunkData.length===t.chunkOffset)return t.chunkData.join("");return t.chunkData.splice(0,t.chunkOffset).join("")}if(t.chunkOffset>0){t.data[t.data.length]=t.chunkData.splice(0,t.chunkOffset).join("")}return t.data.join("")}t.asString=n;function i(t,e){o(t);for(var r=0,n=t.data;r<n.length;r++){var i=n[r];e.writeString(i)}}t.writeTo=i;function o(t){if(t.chunkOffset>0){if(t.chunkData.length===t.chunkOffset)t.data[t.data.length]=t.chunkData.join("");else t.data[t.data.length]=t.chunkData.splice(0,t.chunkOffset).join("");t.chunkOffset=0}}function s(t){u(t,"\n")}t.newline=s;function a(t,r){u(t,e[r])}t.whitespace=a;function u(t,e){if(e===undefined||e===null){return}if(t.chunkOffset===t.chunkCapacity){t.data[t.data.length]=t.chunkData.join("");t.chunkOffset=0}t.chunkData[t.chunkOffset++]=e}t.write=u;function c(t,e){if(t.chunkOffset===t.chunkCapacity){t.data[t.data.length]=t.chunkData.join("");t.chunkOffset=0}t.chunkData[t.chunkOffset++]=e}t.writeSafe=c;function f(t,r,n){if(r===undefined||r===null){u(t,e[n])}var i=n-r.length;if(i>0)u(t,e[i]);u(t,r)}t.writePadLeft=f;function h(t,r,n){if(r===undefined||r===null){u(t,e[n])}var i=n-r.length;u(t,r);if(i>0)u(t,e[i])}t.writePadRight=h;function l(t,e){u(t,""+e)}t.writeInteger=l;function d(t,r,n){var i=""+r;var o=n-i.length;if(o>0)u(t,e[o]);u(t,i)}t.writeIntegerPadLeft=d;function p(t,r,n){var i=""+r;var o=n-i.length;u(t,i);if(o>0)u(t,e[o])}t.writeIntegerPadRight=p;function v(t,e,r){u(t,""+Math.round(r*e)/r)}t.writeFloat=v;function m(t,r,n,i){var o=""+Math.round(n*r)/n;var s=i-o.length;if(s>0)u(t,e[s]);u(t,o)}t.writeFloatPadLeft=m;function y(t,r,n,i){var o=""+Math.round(n*r)/n;var s=i-o.length;u(t,o);if(s>0)u(t,e[s])}t.writeFloatPadRight=y})(r=t.StringWriter||(t.StringWriter={}))})(e=t.Utils||(t.Utils={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){"use strict";var e=function(){function t(){this.isDefined=false}t.prototype.getString=function(t){return null};t.prototype.getInteger=function(t){return 0};t.prototype.getFloat=function(t){return 0};t.prototype.getValuePresence=function(t){return 1};t.prototype.areValuesEqual=function(t,e){return true};t.prototype.stringEquals=function(t,e){return e===null};return t}();t.UndefinedColumn=new e;var r;(function(t){function e(t,e,r,n,i){var o=[];for(var s=1;s<=r;s++){var a=[];for(var u=1;u<=n;u++){a[u-1]=t.getColumn(e+"["+s+"]["+u+"]").getFloat(i)}o[s-1]=a}return o}t.getMatrix=e;function r(t,e,r,n,i){var o=[];for(var s=1;s<=r;s++){o[s-1]=t.getColumn(e+"["+s+"]").getFloat(i)}return o}t.getVector=r})(r=t.Category||(t.Category={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){"use strict";var e;(function(t){function e(t,e){if(e===void 0){e=-1}return new r(t,e)}t.error=e;function i(t,e){if(e===void 0){e=[]}return new n(t,e)}t.success=i})(e=t.ParserResult||(t.ParserResult={}));var r=function(){function t(t,e){this.message=t;this.line=e;this.isError=true}t.prototype.toString=function(){if(this.line>=0){return"[Line "+this.line+"] "+this.message}return this.message};return t}();t.ParserError=r;var n=function(){function t(t,e){this.result=t;this.warnings=e;this.isError=false}return t}();t.ParserSuccess=n})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(e){"use strict";var r;(function(t){function e(){return Object.create(null)}t.create=e;function r(t,e){if(e.length>6)return e;var r=t[e];if(r!==void 0)return r;t[e]=e;return e}t.get=r})(r||(r={}));var n=function(){function t(t){this.dataBlocks=[];this.data=t}t.prototype.toJSON=function(){return this.dataBlocks.map(function(t){return t.toJSON()})};return t}();e.File=n;var i=function(){function t(t,e){this.header=e;this.data=t;this.categoryList=[];this.additionalData={};this.categoryMap=new Map}Object.defineProperty(t.prototype,"categories",{get:function(){return this.categoryList},enumerable:true,configurable:true});t.prototype.getCategory=function(t){return this.categoryMap.get(t)};t.prototype.addCategory=function(t){this.categoryList[this.categoryList.length]=t;this.categoryMap.set(t.name,t)};t.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map(function(t){return t.toJSON()}),additionalData:this.additionalData}};return t}();e.DataBlock=i;var o=function(){function e(t,e,r,n,i,o,s){this.name=e;this.tokens=o;this.data=t;this.startIndex=r;this.endIndex=n;this.columnCount=i.length;this.rowCount=s/i.length|0;this.columnIndices=new Map;this.columnNameList=[];for(var a=0;a<i.length;a++){var u=i[a].substr(e.length+1);this.columnIndices.set(u,a);this.columnNameList.push(u)}}Object.defineProperty(e.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:true,configurable:true});e.prototype.getColumn=function(e){var r=this.columnIndices.get(e);if(r!==void 0)return new u(this,this.data,e,r);return t.UndefinedColumn};e.prototype.toJSON=function(){var t=[],e=this.data,n=this.tokens;var i=this.columnNameList;var o=r.create();for(var s=0;s<this.rowCount;s++){var a={};for(var u=0;u<this.columnCount;u++){var c=(s*this.columnCount+u)*2;a[i[u]]=r.get(o,e.substring(n[c],n[c+1]))}t[s]=a}return{name:this.name,columns:i,rows:t}};return e}();e.Category=o;var s=t.Utils.FastNumberParsers.parseInt;var a=t.Utils.FastNumberParsers.parseFloat;var u=function(){function t(t,e,n,i){this.data=e;this.name=n;this.index=i;this.stringPool=r.create();this.isDefined=true;this.tokens=t.tokens;this.columnCount=t.columnCount}t.prototype.getString=function(t){var e=(t*this.columnCount+this.index)*2;var n=r.get(this.stringPool,this.data.substring(this.tokens[e],this.tokens[e+1]));if(n==="."||n==="?")return null;return n};t.prototype.getInteger=function(t){var e=(t*this.columnCount+this.index)*2;return s(this.data,this.tokens[e],this.tokens[e+1])};t.prototype.getFloat=function(t){var e=(t*this.columnCount+this.index)*2;return a(this.data,this.tokens[e],this.tokens[e+1])};t.prototype.stringEquals=function(t,e){var r=(t*this.columnCount+this.index)*2,n=this.tokens[r],i=e.length;if(i!==this.tokens[r+1]-n)return false;for(var o=0;o<i;o++){if(this.data.charCodeAt(o+n)!==e.charCodeAt(o))return false}return true};t.prototype.areValuesEqual=function(t,e){var r=(t*this.columnCount+this.index)*2,n=(e*this.columnCount+this.index)*2;var i=this.tokens[r],o=this.tokens[n],s=this.tokens[r+1]-i;if(s!==this.tokens[n+1]-o)return false;for(var a=0;a<s;a++){if(this.data.charCodeAt(a+i)!==this.data.charCodeAt(a+o)){return false}}return true};t.prototype.getValuePresence=function(t){var e=t*this.columnCount+this.index;var r=this.tokens[2*e];if(this.tokens[2*e+1]-r!==1)return 0;var n=this.data.charCodeAt(r);if(n===46)return 1;if(n===63)return 2;return 0};return t}();e.Column=u})(e=t.Text||(t.Text={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(e){"use strict";var r;(function(t){function e(t){var e=new Int32Array(1.61*t.tokens.length|0);e.set(t.tokens);t.tokens=e;t.tokensLenMinus2=e.length-2|0}function r(t,r,n){if(t.count>=t.tokensLenMinus2){e(t)}t.tokens[t.count++]=r;t.tokens[t.count++]=n}t.addToken=r;function n(t){return{tokensLenMinus2:t-2|0,count:0,tokens:new Int32Array(t)}}t.create=n})(r||(r={}));function n(t){while(t.position<t.length){switch(t.data.charCodeAt(t.position)){case 9:case 10:case 13:case 32:t.currentTokenEnd=t.position;return;default:++t.position;break}}t.currentTokenEnd=t.position}function i(t,e){var r,n;++t.position;while(t.position<t.length){n=t.data.charCodeAt(t.position);if(n===e){r=t.data.charCodeAt(t.position+1);switch(r){case 9:case 10:case 13:case 32:t.currentTokenStart++;t.currentTokenEnd=t.position;t.isEscaped=true;++t.position;return;default:if(r===void 0){t.currentTokenStart++;t.currentTokenEnd=t.position;t.isEscaped=true;++t.position;return}++t.position;break}}else{if(n===10||n===13){t.currentTokenEnd=t.position;return}++t.position}}t.currentTokenEnd=t.position}function o(t){var e=59,r=t.position+1,n;while(r<t.length){n=t.data.charCodeAt(r);if(n===59&&(e===10||e===13)){t.position=r+1;t.currentTokenStart++;r--;n=t.data.charCodeAt(r);while(n===10||n===13){r--;n=t.data.charCodeAt(r)}t.currentTokenEnd=r+1;t.isEscaped=true;return}else{if(n===13){t.currentLineNumber++}else if(n===10&&e!==13){t.currentLineNumber++}e=n;++r}}t.position=r;return e}function s(t){while(t.position<t.length){var e=t.data.charCodeAt(t.position);if(e===10||e===13){return}++t.position}}function a(t){var e=10;while(t.position<t.length){var r=t.data.charCodeAt(t.position);switch(r){case 9:case 32:e=r;++t.position;break;case 10:if(e!==13){++t.currentLineNumber}e=r;++t.position;break;case 13:e=r;++t.position;++t.currentLineNumber;break;default:return e}}return e}function u(t){var e=t.data.charCodeAt(t.currentTokenStart);if(e!==68&&e!==100)return false;e=t.data.charCodeAt(t.currentTokenStart+1);if(e!==65&&e!==97)return false;e=t.data.charCodeAt(t.currentTokenStart+2);if(e!==84&&e!==116)return false;e=t.data.charCodeAt(t.currentTokenStart+3);if(e!==65&&e!==97)return false;return true}function c(t){var e=t.data.charCodeAt(t.currentTokenStart);if(e!==83&&e!==115)return false;e=t.data.charCodeAt(t.currentTokenStart+1);if(e!==65&&e!==97)return false;e=t.data.charCodeAt(t.currentTokenStart+2);if(e!==86&&e!==118)return false;e=t.data.charCodeAt(t.currentTokenStart+3);if(e!==69&&e!==101)return false;return true}function f(t){if(t.currentTokenEnd-t.currentTokenStart!==5)return false;var e=t.data.charCodeAt(t.currentTokenStart);if(e!==76&&e!==108)return false;e=t.data.charCodeAt(t.currentTokenStart+1);if(e!==79&&e!==111)return false;e=t.data.charCodeAt(t.currentTokenStart+2);if(e!==79&&e!==111)return false;e=t.data.charCodeAt(t.currentTokenStart+3);if(e!==80&&e!==112)return false;return true}function h(t,e,r){var n,i=r-e,o=t.currentTokenStart-e,s=t.currentTokenEnd-t.currentTokenStart;if(s<i)return false;for(n=e;n<r;++n){if(t.data.charCodeAt(n)!==t.data.charCodeAt(n+o))return false}if(i===s)return true;if(t.data.charCodeAt(n+o)===46){return true}return false}function l(t){var e;for(e=t.currentTokenStart;e<t.currentTokenEnd;++e){if(t.data.charCodeAt(e)===46)return e}return e}function d(t,e){return t.data.substring(t.currentTokenStart,e)}function p(t){return t.data.substring(t.currentTokenStart,t.currentTokenEnd)}function v(t){var e=a(t);if(t.position>=t.length){t.currentTokenType=6;return}t.currentTokenStart=t.position;t.currentTokenEnd=t.position;t.isEscaped=false;var r=t.data.charCodeAt(t.position);switch(r){case 35:s(t);t.currentTokenType=5;break;case 34:case 39:i(t,r);t.currentTokenType=3;break;case 59:if(e===10||e===13){o(t)}else{n(t)}t.currentTokenType=3;break;default:n(t);if(t.isEscaped){t.currentTokenType=3}else if(t.data.charCodeAt(t.currentTokenStart)===95){t.currentTokenType=4}else if(t.currentTokenEnd-t.currentTokenStart>=5&&t.data.charCodeAt(t.currentTokenStart+4)===95){if(u(t))t.currentTokenType=0;else if(c(t))t.currentTokenType=1;else if(f(t))t.currentTokenType=2;else t.currentTokenType=3}else{t.currentTokenType=3}break}}function m(t){v(t);while(t.currentTokenType===5)v(t)}function y(t){return{data:t,length:t.length,position:0,currentTokenStart:0,currentTokenEnd:0,currentTokenType:6,currentLineNumber:1,isEscaped:false}}function g(t,n){var i=t.currentTokenStart,o=l(t),s=d(t,o),a,u=[],c=r.create(512),f=0,v=true;while(v){if(t.currentTokenType!==4||!h(t,i,o)){v=false;break}a=p(t);m(t);if(t.currentTokenType!==3){return{hasError:true,errorLine:t.currentLineNumber,errorMessage:"Expected value."}}u[u.length]=a;r.addToken(c,t.currentTokenStart,t.currentTokenEnd);f++;m(t)}n.addCategory(new e.Category(n.data,s,i,t.currentTokenStart,u,c.tokens,f));return{hasError:false,errorLine:0,errorMessage:""}}function b(t,n){var i=t.currentTokenStart,o=t.currentLineNumber;m(t);var s=d(t,l(t)),a=[],u=r.create(s==="_atom_site"?n.data.length/1.85|0:1024),c=0;while(t.currentTokenType===4){a[a.length]=p(t);m(t)}while(t.currentTokenType===3){r.addToken(u,t.currentTokenStart,t.currentTokenEnd);c++;m(t)}if(c%a.length!==0){return{hasError:true,errorLine:t.currentLineNumber,errorMessage:"The number of values for loop starting at line "+o+" is not a multiple of the number of columns."}}n.addCategory(new e.Category(n.data,s,i,t.currentTokenStart,a,u.tokens,c));return{hasError:false,errorLine:0,errorMessage:""}}function _(e,r){return t.ParserResult.error(r,e)}function w(e){return t.ParserResult.success(e)}function x(t){var r=y(t),n,i,o=new e.File(t),s=new e.DataBlock(t,"default"),a=new e.DataBlock(t,"empty"),u=false,c;m(r);while(r.currentTokenType!==6){var f=r.currentTokenType;if(f===0){if(u){return _(r.currentLineNumber,"Unexpected data block inside a save frame.")}if(s.categories.length>0){o.dataBlocks.push(s)}s=new e.DataBlock(t,t.substring(r.currentTokenStart+5,r.currentTokenEnd));m(r)}else if(f===1){i=t.substring(r.currentTokenStart+5,r.currentTokenEnd);if(i.length===0){if(a.categories.length>0){c=s.additionalData["saveFrames"];if(!c){c=[];s.additionalData["saveFrames"]=c}c[c.length]=a}u=false}else{if(u){return _(r.currentLineNumber,"Save frames cannot be nested.")}u=true;a=new e.DataBlock(t,i)}m(r)}else if(f===2){n=b(r,u?a:s);if(n.hasError){return _(n.errorLine,n.errorMessage)}}else if(f===4){n=g(r,u?a:s);if(n.hasError){return _(n.errorLine,n.errorMessage)}}else{return _(r.currentLineNumber,"Unexpected token. Expected data_, loop_, or data name.")}}if(u){return _(r.currentLineNumber,"Unfinished save frame (`"+a.header+"`).")}if(s.categories.length>0){o.dataBlocks.push(s)}return w(o)}function C(t){return x(t)}e.parse=C})(e=t.Text||(t.Text={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(e){"use strict";var r=t.Utils.StringWriter;var n=function(){function t(){this.writer=r.create();this.encoded=false;this.dataBlockCreated=false}t.prototype.startDataBlock=function(t){this.dataBlockCreated=true;r.write(this.writer,"data_"+(t||"").replace(/[ \n\t]/g,"").toUpperCase()+"\n#\n")};t.prototype.writeCategory=function(t,e){if(this.encoded){throw new Error("The writer contents have already been encoded, no more writing.")}if(!this.dataBlockCreated){throw new Error("No data block created.")}var r=!e||!e.length?[t(void 0)]:e.map(function(e){return t(e)});var n=r.filter(function(t){return t&&t.count>0});if(!n.length)return;var i=n.reduce(function(t,e){return t+(e.count===void 0?1:e.count)},0);if(!i)return;else if(i===1){o(n[0],this.writer)}else{s(n,this.writer)}};t.prototype.encode=function(){this.encoded=true};t.prototype.flush=function(t){r.writeTo(this.writer,t)};return t}();e.Writer=n;function i(t){return!!t&&t.indexOf("\n")>=0}function o(t,e){var n=t.desc.fields;var o=t.data;var s=n.reduce(function(t,e){return Math.max(t,e.name.length)},0)+t.desc.name.length+5;for(var a=0,u=n;a<u.length;a++){var c=u[a];r.writePadRight(e,t.desc.name+"."+c.name,s);var p=c.presence;var v=p?p(o,0):0;if(v!==0){if(v===1)f(e);else h(e)}else{var m=c.string(o,0);if(i(m)){d(e,m);r.newline(e)}else{l(e,m)}}r.newline(e)}r.write(e,"#\n")}function s(t,e){a(e,"loop_");var n=t[0];var o=n.desc.fields;for(var s=0,u=o;s<u.length;s++){var c=u[s];a(e,n.desc.name+"."+c.name)}for(var p=0,v=t;p<v.length;p++){var m=v[p];var y=m.data;var g=m.count;for(var b=0;b<g;b++){for(var _=0,w=o;_<w.length;_++){var c=w[_];var x=c.presence;var C=x?x(y,b):0;if(C!==0){if(C===1)f(e);else h(e)}else{var I=c.string(y,b);if(i(I)){d(e,I);r.newline(e)}else{l(e,I)}}}r.newline(e)}}r.write(e,"#\n")}function a(t,e){r.write(t,e);r.newline(t)}function u(t,e){r.writeSafe(t,""+e+" ")}function c(t,e,n){r.writeSafe(t,""+Math.round(n*e)/n+" ")}function f(t){r.writeSafe(t,". ")}function h(t){r.writeSafe(t,"? ")}function l(t,e){if(!e){r.writeSafe(t,". ");return}var n=false,i="'",o="' ";var s=false;var a=false;var u=false;for(var c=0,f=e.length-1;c<f;c++){var h=e.charCodeAt(c);switch(h){case 9:s=true;break;case 10:r.writeSafe(t,"\n;"+e);r.writeSafe(t,"\n; ");return;case 32:s=true;break;case 34:if(a){r.writeSafe(t,"\n;"+e);r.writeSafe(t,"\n; ");return}u=true;n=true;i="'";o="' ";break;case 39:if(u){r.writeSafe(t,"\n;"+e);r.writeSafe(t,"\n; ");return}n=true;a=true;i='"';o='" ';break}}var l=e.charCodeAt(0);if(!n&&(l===35||l===59||s)){i="'";o="' ";n=true}if(n){r.writeSafe(t,i+e+o)}else{r.write(t,e);r.writeSafe(t," ")}}function d(t,e){r.writeSafe(t,"\n;"+e);r.writeSafe(t,"\n; ")}function p(t,e,n,i){var o=false,s="'",a="' ";for(var u=n;u<i-1;u++){var c=e.charCodeAt(u);switch(c){case 10:r.writeSafe(t,"\n;"+e.substring(n,i));r.writeSafe(t,"\n; ");return;case 34:o=true;s="'";a="' ";break;case 39:o=true;s='"';a='" ';break}}if(!o&&e.charCodeAt(n)===59){s="'";a="' ";o=true}if(o){r.writeSafe(t,s+e.substring(n,i));r.writeSafe(t,s)}else{r.write(t,e.substring(n,i));r.writeSafe(t," ")}}})(e=t.Text||(t.Text={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){var e;(function(t){/*
             * Adapted from https://github.com/rcsb/mmtf-javascript
             * by Alexander Rose <alexander.rose@weirdbyte.de>, MIT License, Copyright (c) 2016
             */
function e(t,e){var r={};for(var n=0;n<e;n++){var i=o(t);r[i]=o(t)}return r}function r(t,e){var r=new Uint8Array(e);var n=t.offset;for(var i=0;i<e;i++)r[i]=t.buffer[i+n];t.offset+=e;return r}function n(e,r){var n=t.utf8Read(e.buffer,e.offset,r);e.offset+=r;return n}function i(t,e){var r=new Array(e);for(var n=0;n<e;n++){r[n]=o(t)}return r}function o(t){var o=t.buffer[t.offset];var s,a;if((o&128)===0){t.offset++;return o}if((o&240)===128){a=o&15;t.offset++;return e(t,a)}if((o&240)===144){a=o&15;t.offset++;return i(t,a)}if((o&224)===160){a=o&31;t.offset++;return n(t,a)}if((o&224)===224){s=t.dataView.getInt8(t.offset);t.offset++;return s}switch(o){case 192:t.offset++;return null;case 194:t.offset++;return false;case 195:t.offset++;return true;case 196:a=t.dataView.getUint8(t.offset+1);t.offset+=2;return r(t,a);case 197:a=t.dataView.getUint16(t.offset+1);t.offset+=3;return r(t,a);case 198:a=t.dataView.getUint32(t.offset+1);t.offset+=5;return r(t,a);case 202:s=t.dataView.getFloat32(t.offset+1);t.offset+=5;return s;case 203:s=t.dataView.getFloat64(t.offset+1);t.offset+=9;return s;case 204:s=t.buffer[t.offset+1];t.offset+=2;return s;case 205:s=t.dataView.getUint16(t.offset+1);t.offset+=3;return s;case 206:s=t.dataView.getUint32(t.offset+1);t.offset+=5;return s;case 208:s=t.dataView.getInt8(t.offset+1);t.offset+=2;return s;case 209:s=t.dataView.getInt16(t.offset+1);t.offset+=3;return s;case 210:s=t.dataView.getInt32(t.offset+1);t.offset+=5;return s;case 217:a=t.dataView.getUint8(t.offset+1);t.offset+=2;return n(t,a);case 218:a=t.dataView.getUint16(t.offset+1);t.offset+=3;return n(t,a);case 219:a=t.dataView.getUint32(t.offset+1);t.offset+=5;return n(t,a);case 220:a=t.dataView.getUint16(t.offset+1);t.offset+=3;return i(t,a);case 221:a=t.dataView.getUint32(t.offset+1);t.offset+=5;return i(t,a);case 222:a=t.dataView.getUint16(t.offset+1);t.offset+=3;return e(t,a);case 223:a=t.dataView.getUint32(t.offset+1);t.offset+=5;return e(t,a)}throw new Error("Unknown type 0x"+o.toString(16))}function s(t){return o({buffer:t,offset:0,dataView:new DataView(t.buffer)})}t.decode=s})(e=t.MessagePack||(t.MessagePack={}))})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){var e;(function(t){/*
             * Adapted from https://github.com/rcsb/mmtf-javascript
             * by Alexander Rose <alexander.rose@weirdbyte.de>, MIT License, Copyright (c) 2016
             */
function e(t){var e=new ArrayBuffer(r(t));var i=new DataView(e);var o=new Uint8Array(e);n(t,i,o,0);return o}t.encode=e;function r(e){var n=typeof e;if(n==="string"){var i=t.utf8ByteCount(e);if(i<32){return 1+i}if(i<256){return 2+i}if(i<65536){return 3+i}if(i<4294967296){return 5+i}}if(e instanceof Uint8Array){var o=e.byteLength;if(o<256){return 2+o}if(o<65536){return 3+o}if(o<4294967296){return 5+o}}if(n==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(n==="boolean"||e===null||e===void 0)return 1;if(n==="object"){var s,a=0;if(Array.isArray(e)){s=e.length;for(var u=0;u<s;u++){a+=r(e[u])}}else{var c=Object.keys(e);s=c.length;for(var u=0;u<s;u++){var f=c[u];a+=r(f)+r(e[f])}}if(s<16){return 1+a}if(s<65536){return 3+a}if(s<4294967296){return 5+a}throw new Error("Array or object too long 0x"+s.toString(16))}throw new Error("Unknown type "+n)}function n(e,r,i,o){var s=typeof e;if(s==="string"){var a=t.utf8ByteCount(e);if(a<32){r.setUint8(o,a|160);t.utf8Write(i,o+1,e);return 1+a}if(a<256){r.setUint8(o,217);r.setUint8(o+1,a);t.utf8Write(i,o+2,e);return 2+a}if(a<65536){r.setUint8(o,218);r.setUint16(o+1,a);t.utf8Write(i,o+3,e);return 3+a}if(a<4294967296){r.setUint8(o,219);r.setUint32(o+1,a);t.utf8Write(i,o+5,e);return 5+a}}if(e instanceof Uint8Array){var u=e.byteLength;var c=new Uint8Array(r.buffer);if(u<256){r.setUint8(o,196);r.setUint8(o+1,u);c.set(e,o+2);return 2+u}if(u<65536){r.setUint8(o,197);r.setUint16(o+1,u);c.set(e,o+3);return 3+u}if(u<4294967296){r.setUint8(o,198);r.setUint32(o+1,u);c.set(e,o+5);return 5+u}}if(s==="number"){if(!isFinite(e)){throw new Error("Number not finite: "+e)}if(Math.floor(e)!==e){r.setUint8(o,203);r.setFloat64(o+1,e);return 9}if(e>=0){if(e<128){r.setUint8(o,e);return 1}if(e<256){r.setUint8(o,204);r.setUint8(o+1,e);return 2}if(e<65536){r.setUint8(o,205);r.setUint16(o+1,e);return 3}if(e<4294967296){r.setUint8(o,206);r.setUint32(o+1,e);return 5}throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32){r.setInt8(o,e);return 1}if(e>=-128){r.setUint8(o,208);r.setInt8(o+1,e);return 2}if(e>=-32768){r.setUint8(o,209);r.setInt16(o+1,e);return 3}if(e>=-2147483648){r.setUint8(o,210);r.setInt32(o+1,e);return 5}throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e===null||e===undefined){r.setUint8(o,192);return 1}if(s==="boolean"){r.setUint8(o,e?195:194);return 1}if(s==="object"){var f,h=0;var l=Array.isArray(e);var d=void 0;if(l){f=e.length}else{d=Object.keys(e);f=d.length}if(f<16){r.setUint8(o,f|(l?144:128));h=1}else if(f<65536){r.setUint8(o,l?220:222);r.setUint16(o+1,f);h=3}else if(f<4294967296){r.setUint8(o,l?221:223);r.setUint32(o+1,f);h=5}if(l){for(var p=0;p<f;p++){h+=n(e[p],r,i,o+h)}}else{for(var v=0,m=d;v<m.length;v++){var y=m[v];h+=n(y,r,i,o+h);h+=n(e[y],r,i,o+h)}}return h}throw new Error("Unknown type "+s)}})(e=t.MessagePack||(t.MessagePack={}))})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){var e;(function(t){/*
             * Adapted from https://github.com/rcsb/mmtf-javascript
             * by Alexander Rose <alexander.rose@weirdbyte.de>, MIT License, Copyright (c) 2016
             */
function e(t,e,r){var n=t.byteLength;for(var i=0,o=r.length;i<o;i++){var s=r.charCodeAt(i);if(s<128){t[e++]=s>>>0&127|0;continue}if(s<2048){t[e++]=s>>>6&31|192;t[e++]=s>>>0&63|128;continue}if(s<65536){t[e++]=s>>>12&15|224;t[e++]=s>>>6&63|128;t[e++]=s>>>0&63|128;continue}if(s<1114112){t[e++]=s>>>18&7|240;t[e++]=s>>>12&63|128;t[e++]=s>>>6&63|128;t[e++]=s>>>0&63|128;continue}throw new Error("bad codepoint "+s)}}t.utf8Write=e;var r=function(){var t=[];for(var e=0;e<1024;e++)t[e]=String.fromCharCode(e);return t}();function n(t){throw new Error(t)}function i(t,e,i){var o=r;var s=void 0,a=[],u=512,c=0;for(var f=e,h=e+i;f<h;f++){var l=t[f];if((l&128)===0){a[c++]=o[l]}else if((l&224)===192){a[c++]=o[(l&15)<<6|t[++f]&63]}else if((l&240)===224){a[c++]=String.fromCharCode((l&15)<<12|(t[++f]&63)<<6|(t[++f]&63)<<0)}else if((l&248)===240){a[c++]=String.fromCharCode((l&7)<<18|(t[++f]&63)<<12|(t[++f]&63)<<6|(t[++f]&63)<<0)}else n("Invalid byte "+l.toString(16));if(c===u){s=s||[];s[s.length]=a.join("");c=0}}if(!s)return a.slice(0,c).join("");if(c>0){s[s.length]=a.slice(0,c).join("")}return s.join("")}t.utf8Read=i;function o(t){var e=0;for(var r=0,i=t.length;r<i;r++){var o=t.charCodeAt(r);if(o<128){e+=1;continue}if(o<2048){e+=2;continue}if(o<65536){e+=3;continue}if(o<1114112){e+=4;continue}n("bad codepoint "+o)}return e}t.utf8ByteCount=o})(e=t.MessagePack||(t.MessagePack={}))})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){"use strict";/**
         * Fixed point, delta, RLE, integer packing adopted from https://github.com/rcsb/mmtf-javascript/
         * by Alexander Rose <alexander.rose@weirdbyte.de>, MIT License, Copyright (c) 2016
         */
function e(t){var e=t.data;for(var n=t.encoding.length-1;n>=0;n--){e=r.decodeStep(e,t.encoding[n])}return e}t.decode=e;var r;(function(t){function r(t,e){switch(e.kind){case"ByteArray":{switch(e.type){case 4:return t;case 1:return s(t);case 2:return c(t);case 5:return f(t);case 3:return h(t);case 6:return l(t);case 32:return d(t);case 33:return p(t);default:throw new Error("Unsupported ByteArray type.")}}case"FixedPoint":return v(t,e);case"IntervalQuantization":return m(t,e);case"RunLength":return y(t,e);case"Delta":return g(t,e);case"IntegerPacking":return w(t,e);case"StringArray":return x(t,e)}}t.decodeStep=r;function n(t,e){switch(t){case 1:return new Int8Array(e);case 2:return new Int16Array(e);case 3:return new Int32Array(e);case 4:return new Uint8Array(e);case 5:return new Uint16Array(e);case 6:return new Uint32Array(e);default:throw new Error("Unsupported integer data type.")}}function i(t,e){switch(t){case 32:return new Float32Array(e);case 33:return new Float64Array(e);default:throw new Error("Unsupported floating data type.")}}var o=function(){var t=new ArrayBuffer(2);var e=new Uint8Array(t);var r=new Uint16Array(t);e[0]=170;e[1]=187;if(r[0]===48042)return true;return false}();function s(t){return new Int8Array(t.buffer,t.byteOffset)}function a(t,e){var r=new ArrayBuffer(t.length);var n=new Uint8Array(r);for(var i=0,o=t.length;i<o;i+=e){for(var s=0;s<e;s++){n[i+e-s-1]=t[i+s]}}return r}function u(t,e,r){if(o)return new r(t.buffer);return new r(a(t,e))}function c(t){return u(t,2,Int16Array)}function f(t){return u(t,2,Uint16Array)}function h(t){return u(t,4,Int32Array)}function l(t){return u(t,4,Uint32Array)}function d(t){return u(t,4,Float32Array)}function p(t){return u(t,8,Float64Array)}function v(t,e){var r=t.length;var n=i(e.srcType,r);var o=1/e.factor;for(var s=0;s<r;s++){n[s]=o*t[s]}return n}function m(t,e){var r=t.length;var n=i(e.srcType,r);var o=(e.max-e.min)/(e.numSteps-1);var s=e.min;for(var a=0;a<r;a++){n[a]=s+o*t[a]}return n}function y(t,e){var r=n(e.srcType,e.srcSize);var i=0;for(var o=0,s=t.length;o<s;o+=2){var a=t[o];var u=t[o+1];for(var c=0;c<u;++c){r[i++]=a}}return r}function g(t,e){var r=t.length;var i=n(e.srcType,r);if(!r)return i;i[0]=t[0]+(e.origin|0);for(var o=1;o<r;++o){i[o]=t[o]+i[o-1]}return i}function b(t,e){var r=e.byteCount===1?127:32767;var n=-r-1;var i=t.length;var o=new Int32Array(e.srcSize);var s=0;var a=0;while(s<i){var u=0,c=t[s];while(c===r||c===n){u+=c;s++;c=t[s]}u+=c;o[a]=u;s++;a++}return o}function _(t,e){var r=e.byteCount===1?255:65535;var n=t.length;var i=new Int32Array(e.srcSize);var o=0;var s=0;while(o<n){var a=0,u=t[o];while(u===r){a+=u;o++;u=t[o]}a+=u;i[s]=a;o++;s++}return i}function w(t,e){return e.isUnsigned?_(t,e):b(t,e)}function x(t,r){var n=r.stringData;var i=e({encoding:r.offsetEncoding,data:r.offsets});var o=e({encoding:r.dataEncoding,data:t});var s=Object.create(null);var a=new Array(o.length);var u=0;for(var c=0,f=o;c<f.length;c++){var h=f[c];if(h<0){a[u++]=null;continue}var l=s[h];if(l===void 0){l=n.substring(i[h],i[h+1]);s[h]=l}a[u++]=l}return a}})(r||(r={}))})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(e){"use strict";var r=function(){function t(t){this.dataBlocks=t.dataBlocks.map(function(t){return new n(t)})}t.prototype.toJSON=function(){return this.dataBlocks.map(function(t){return t.toJSON()})};return t}();e.File=r;var n=function(){function t(t){this.additionalData={};this.header=t.header;this.categoryList=t.categories.map(function(t){return new i(t)});this.categoryMap=new Map;for(var e=0,r=this.categoryList;e<r.length;e++){var n=r[e];this.categoryMap.set(n.name,n)}}Object.defineProperty(t.prototype,"categories",{get:function(){return this.categoryList},enumerable:true,configurable:true});t.prototype.getCategory=function(t){return this.categoryMap.get(t)};t.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map(function(t){return t.toJSON()}),additionalData:this.additionalData}};return t}();e.DataBlock=n;var i=function(){function e(t){this.name=t.name;this.columnCount=t.columns.length;this.rowCount=t.rowCount;this.columnNameList=[];this.encodedColumns=new Map;for(var e=0,r=t.columns;e<r.length;e++){var n=r[e];this.encodedColumns.set(n.name,n);this.columnNameList.push(n.name)}}Object.defineProperty(e.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:true,configurable:true});e.prototype.getColumn=function(e){var r=this.encodedColumns.get(e);if(r)return o(r);return t.UndefinedColumn};e.prototype.toJSON=function(){var t=this;var e=[];var r=this.columnNameList.map(function(e){return{name:e,column:t.getColumn(e)}});for(var n=0;n<this.rowCount;n++){var i={};for(var o=0,s=r;o<s.length;o++){var a=s[o];var u=a.column.getValuePresence(n);if(u===0)i[a.name]=a.column.getString(n);else if(u===1)i[a.name]=".";else i[a.name]="?"}e[n]=i}return{name:this.name,columns:this.columnNames,rows:e}};return e}();e.Category=i;function o(r){if(!r.data.data)return t.UndefinedColumn;var n=e.decode(r.data);var i=void 0;if(r.mask)i=e.decode(r.mask);if(n.buffer&&n.byteLength&&n.BYTES_PER_ELEMENT){return i?new c(n,i):new u(n)}return i?new h(n,i):new f(n)}var s=t.Utils.FastNumberParsers.parseInt;var a=t.Utils.FastNumberParsers.parseFloat;var u=function(){function t(t){this.data=t;this.isDefined=true}t.prototype.getString=function(t){return""+this.data[t]};t.prototype.getInteger=function(t){return this.data[t]|0};t.prototype.getFloat=function(t){return 1*this.data[t]};t.prototype.stringEquals=function(t,e){return this.data[t]===a(e,0,e.length)};t.prototype.areValuesEqual=function(t,e){return this.data[t]===this.data[e]};t.prototype.getValuePresence=function(t){return 0};return t}();var c=function(){function t(t,e){this.data=t;this.mask=e;this.isDefined=true}t.prototype.getString=function(t){return this.mask[t]===0?""+this.data[t]:null};t.prototype.getInteger=function(t){return this.mask[t]===0?this.data[t]:0};t.prototype.getFloat=function(t){return this.mask[t]===0?this.data[t]:0};t.prototype.stringEquals=function(t,e){return this.mask[t]===0?this.data[t]===a(e,0,e.length):e===null||e===void 0};t.prototype.areValuesEqual=function(t,e){return this.data[t]===this.data[e]};t.prototype.getValuePresence=function(t){return this.mask[t]};return t}();var f=function(){function t(t){this.data=t;this.isDefined=true}t.prototype.getString=function(t){return this.data[t]};t.prototype.getInteger=function(t){var e=this.data[t];return s(e,0,e.length)};t.prototype.getFloat=function(t){var e=this.data[t];return a(e,0,e.length)};t.prototype.stringEquals=function(t,e){return this.data[t]===e};t.prototype.areValuesEqual=function(t,e){return this.data[t]===this.data[e]};t.prototype.getValuePresence=function(t){return 0};return t}();var h=function(){function t(t,e){this.data=t;this.mask=e;this.isDefined=true}t.prototype.getString=function(t){return this.mask[t]===0?this.data[t]:null};t.prototype.getInteger=function(t){if(this.mask[t]!==0)return 0;var e=this.data[t];return s(e||"",0,(e||"").length)};t.prototype.getFloat=function(t){if(this.mask[t]!==0)return 0;var e=this.data[t];return a(e||"",0,(e||"").length)};t.prototype.stringEquals=function(t,e){return this.data[t]===e};t.prototype.areValuesEqual=function(t,e){return this.data[t]===this.data[e]};t.prototype.getValuePresence=function(t){return this.mask[t]};return t}()})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(e){"use strict";/**
         * Fixed point, delta, RLE, integer packing adopted from https://github.com/rcsb/mmtf-javascript/
         * by Alexander Rose <alexander.rose@weirdbyte.de>, MIT License, Copyright (c) 2016
         */
var r=function(){function t(t){this.providers=t}t.prototype.and=function(e){return new t(this.providers.concat([e]))};t.prototype.encode=function(t){var e=[];for(var r=0,n=this.providers;r<n.length;r++){var i=n[r];var o=i(t);if(!o.encodings.length){throw new Error("Encodings must be non-empty.")}t=o.data;for(var s=0,a=o.encodings;s<a.length;s++){var u=a[s];e.push(u)}}if(!(t instanceof Uint8Array)){throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.")}return{encoding:e,data:t}};return t}();e.Encoder=r;(function(r){function n(t){return new r([t])}r.by=n;function i(t){return{encodings:[{kind:"ByteArray",type:4}],data:t}}function o(t){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(t.buffer,t.byteOffset)}}var s=(w={},w[2]=function(t,e,r){t.setInt16(2*e,r,true)},w[5]=function(t,e,r){t.setUint16(2*e,r,true)},w[3]=function(t,e,r){t.setInt32(4*e,r,true)},w[6]=function(t,e,r){t.setUint32(4*e,r,true)},w[32]=function(t,e,r){t.setFloat32(4*e,r,true)},w[33]=function(t,e,r){t.setFloat64(8*e,r,true)},w);var a=(x={},x[2]=2,x[5]=2,x[3]=4,x[6]=4,x[32]=4,x[33]=8,x);function u(t){var r=e.Encoding.getDataType(t);if(r===1)return o(t);else if(r===4)return i(t);var n=new Uint8Array(t.length*a[r]);var u=s[r];var c=new DataView(n.buffer);for(var f=0,h=t.length;f<h;f++){u(c,f,t[f])}return{encodings:[{kind:"ByteArray",type:r}],data:n}}r.byteArray=u;function c(t,r){var n=e.Encoding.getDataType(t);var i=new Int32Array(t.length);for(var o=0,s=t.length;o<s;o++){i[o]=Math.round(t[o]*r)}return{encodings:[{kind:"FixedPoint",factor:r,srcType:n}],data:i}}function f(t){return function(e){return c(e,t)}}r.fixedPoint=f;function h(t,r,n,i,o){var s=e.Encoding.getDataType(t);if(!t.length){return{encodings:[{kind:"IntervalQuantization",min:r,max:n,numSteps:i,srcType:s}],data:new Int32Array(0)}}if(n<r){var a=r;r=n;n=a}var u=(n-r)/(i-1);var c=new o(t.length);for(var f=0,h=t.length;f<h;f++){var l=t[f];if(l<=r)c[f]=0;else if(l>=n)c[f]=i;else c[f]=Math.round((l-r)/u)|0}return{encodings:[{kind:"IntervalQuantization",min:r,max:n,numSteps:i,srcType:s}],data:c}}function l(t,e,r,n){if(n===void 0){n=Int32Array}return function(i){return h(i,t,e,r,n)}}r.intervalQuantizaiton=l;function d(t){var r=e.Encoding.getDataType(t);if(r===void 0){t=new Int32Array(t);r=3}if(!t.length){return{encodings:[{kind:"RunLength",srcType:r,srcSize:0}],data:new Int32Array(0)}}var n=2;for(var i=1,o=t.length;i<o;i++){if(t[i-1]!==t[i]){n+=2}}var s=new Int32Array(n);var a=0;var u=1;for(var i=1,o=t.length;i<o;i++){if(t[i-1]!==t[i]){s[a]=t[i-1];s[a+1]=u;u=1;a+=2}else{++u}}s[a]=t[t.length-1];s[a+1]=u;return{encodings:[{kind:"RunLength",srcType:r,srcSize:t.length}],data:s}}r.runLength=d;function p(t){if(!e.Encoding.isSignedIntegerDataType(t)){throw new Error("Only signed integer types can be encoded using delta encoding.")}var r=e.Encoding.getDataType(t);if(r===void 0){t=new Int32Array(t);r=3}if(!t.length){return{encodings:[{kind:"Delta",origin:0,srcType:r}],data:new t.constructor(0)}}var n=new t.constructor(t.length);var i=t[0];n[0]=t[0];for(var o=1,s=t.length;o<s;o++){n[o]=t[o]-t[o-1]}n[0]=0;return{encodings:[{kind:"Delta",origin:i,srcType:r}],data:n}}r.delta=p;function v(t){for(var e=0,r=t.length;e<r;e++){if(t[e]<0)return true}return false}function m(t,e){var r=-e-1;var n=0;for(var i=0,o=t.length;i<o;i++){var s=t[i];if(s===0){n+=1}else if(s===e||s===r){n+=2}else if(s>0){n+=Math.ceil(s/e)}else{n+=Math.ceil(s/r)}}return n}function y(t){var e=v(t);var r=e?m(t,127):m(t,255);var n=e?m(t,32767):m(t,65535);if(t.length*4<n*2){return{isSigned:e,size:t.length,bytesPerElement:4}}else if(n*2<r){return{isSigned:e,size:n,bytesPerElement:2}}else{return{isSigned:e,size:r,bytesPerElement:1}}}function g(t,e){var r=e.isSigned?e.bytesPerElement===1?127:32767:e.bytesPerElement===1?255:65535;var n=-r-1;var i=t.length;var o=e.isSigned?e.bytesPerElement===1?new Int8Array(e.size):new Int16Array(e.size):e.bytesPerElement===1?new Uint8Array(e.size):new Uint16Array(e.size);var s=0;for(var a=0;a<i;a++){var c=t[a];if(c>=0){while(c>=r){o[s]=r;++s;c-=r}}else{while(c<=n){o[s]=n;++s;c-=n}}o[s]=c;++s}var f=u(o);return{encodings:[{kind:"IntegerPacking",byteCount:e.bytesPerElement,isUnsigned:!e.isSigned,srcSize:i},f.encodings[0]],data:f.data}}function b(t){if(!(t instanceof Int32Array)){throw new Error("Integer packing can only be applied to Int32 data.")}var e=y(t);if(e.bytesPerElement===4){return u(t)}return g(t,e)}r.integerPacking=b;function _(e){var n=Object.create(null);var i=[];var o=0;var s=t.Utils.ChunkedArray.create(function(t){return new Int32Array(t)},1024,1);var a=new Int32Array(e.length);t.Utils.ChunkedArray.add(s,0);var u=0;for(var c=0,f=e;c<f.length;c++){var h=f[c];if(h===null||h===void 0){a[u++]=-1;continue}var l=n[h];if(l===void 0){o+=h.length;l=i.length;i[l]=h;n[h]=l;t.Utils.ChunkedArray.add(s,o)}a[u++]=l}var v=r.by(p).and(b).encode(t.Utils.ChunkedArray.compact(s));var m=r.by(p).and(d).and(b).encode(a);return{encodings:[{kind:"StringArray",dataEncoding:m.encoding,stringData:i.join(""),offsetEncoding:v.encoding,offsets:v.data}],data:m.data}}r.stringArray=_;var w,x})(r=e.Encoder||(e.Encoder={}))})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){"use strict";t.VERSION="0.3.0";var e;(function(t){function e(t){var e;if(t instanceof Int8Array)e=1;else if(t instanceof Int16Array)e=2;else if(t instanceof Int32Array)e=3;else if(t instanceof Uint8Array)e=4;else if(t instanceof Uint16Array)e=5;else if(t instanceof Uint32Array)e=6;else if(t instanceof Float32Array)e=32;else if(t instanceof Float64Array)e=33;else throw new Error("Unsupported integer data type.");return e}t.getDataType=e;function r(t){return t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array}t.isSignedIntegerDataType=r})(e=t.Encoding||(t.Encoding={}))})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(e){"use strict";function r(t,e){for(var r=0;r<2;r++){if(t[r]>e[r])return false}return true}function n(n){var i=[0,3];try{var o=new Uint8Array(n);var s=e.MessagePack.decode(o);if(!r(i,s.version.match(/(\d)\.(\d)\.\d/).slice(1))){return t.ParserResult.error("Unsupported format version. Current "+s.version+", required "+i.join(".")+".")}var a=new e.File(s);return t.ParserResult.success(a)}catch(e){return t.ParserResult.error(""+e)}}e.parse=n})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under MIT License, See LICENSE file for more info.
 */
var o;(function(t){var e;(function(t){"use strict";function e(e,r,n){var i,o=false;if(e.typedArray){i=new e.typedArray(n)}else{o=true;i=new Array(n)}var s=new Uint8Array(n);var a=e.presence;var u=e.number?e.number:e.string;var c=true;var f=0;for(var h=0,l=r;h<l.length;h++){var d=l[h];var p=d.data;for(var v=0,m=d.count;v<m;v++){var y=a?a(p,v):0;if(y!==0){s[f]=y;if(o)i[f]=null;c=false}else{s[f]=0;i[f]=u(p,v)}f++}}var g=e.encoder?e.encoder:t.Encoder.by(t.Encoder.stringArray);var b=g.encode(i);var _=void 0;if(!c){var w=t.Encoder.by(t.Encoder.runLength).and(t.Encoder.byteArray).encode(s);if(w.data.length<s.length){_=w}else{_=t.Encoder.by(t.Encoder.byteArray).encode(s)}}return{name:e.name,data:b,mask:_}}var r=function(){function r(e){this.dataBlocks=[];this.data={encoder:e,version:t.VERSION,dataBlocks:this.dataBlocks}}r.prototype.startDataBlock=function(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})};r.prototype.writeCategory=function(t,r){if(!this.data){throw new Error("The writer contents have already been encoded, no more writing.")}if(!this.dataBlocks.length){throw new Error("No data block created.")}var n=!r||!r.length?[t(void 0)]:r.map(function(e){return t(e)});var i=n.filter(function(t){return t&&t.count>0});if(!i.length)return;var o=i.reduce(function(t,e){return t+e.count},0);if(!o)return;var s=i[0];var a={name:s.desc.name,columns:[],rowCount:o};var u=i.map(function(t){return{data:t.data,count:t.count}});for(var c=0,f=s.desc.fields;c<f.length;c++){var h=f[c];a.columns.push(e(h,u,o))}this.dataBlocks[this.dataBlocks.length-1].categories.push(a)};r.prototype.encode=function(){this.encodedData=t.MessagePack.encode(this.data);this.data=null;this.dataBlocks=null};r.prototype.flush=function(t){t.writeBinary(this.encodedData)};return r}();t.Writer=r})(e=t.Binary||(t.Binary={}))})(o||(o={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){t.Promise=e})(s||(s={}));(function(t){var e;(function(e){"use strict";e.Rx=i;e.Promise=t.Promise;var r;(function(t){t.CIF=o})(r=e.Formats||(e.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){t.VERSION={number:"3.1.4",date:"June 18 2017"}})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var a=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n["throw"](t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})};var u=this&&this.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return u([t,e])}}function u(s){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(o=i[s[0]&2?"return":s[0]?"throw":"next"])&&!(o=o.call(i,s[1])).done)return o;if(i=0,o)s=[0,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:r.label++;return{value:s[1],done:false};case 5:r.label++;i=s[1];s=[0];continue;case 7:s=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){r=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(s[0]===6&&r.label<o[1]){r.label=o[1];o=s;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(s);break}if(o[2])r.ops.pop();r.trys.pop();continue}s=e.call(t,r)}catch(t){s=[6,t];i=0}finally{n=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};var s;(function(t){var e;(function(t){"use strict";function e(t){return new r(t)}t.computation=e;var r=function(){function e(t){this.computation=t}e.prototype.run=function(t){return this.runWithContext(t).result};e.prototype.runWithContext=function(e){var r=this;var i=e?e:new n;return{progress:i.progressStream,result:new t.Promise(function(t,e){return a(r,void 0,void 0,function(){var r,n;return u(this,function(o){switch(o.label){case 0:o.trys.push([0,2,3,4]);i.started();return[4,this.computation(i)];case 1:r=o.sent();t(r);return[3,4];case 2:n=o.sent();e(n);return[3,4];case 3:i.finished();return[7];case 4:return[2]}})})})}};return e}();t.Computation=r;(function(r){function i(r){return e(function(){return t.Promise.resolve(r)})}r.resolve=i;function o(r){return e(function(){return t.Promise.reject(r)})}r.reject=o;function s(){return new n}r.createContext=s;r.Aborted="Aborted";r.UpdateProgressDelta=100})(r=t.Computation||(t.Computation={}));var n=function(){function e(){var e=this;this._abortRequested=false;this._abortRequester=function(){e._abortRequested=true};this.progressTick=new t.Rx.Subject;this._progress={message:"Working...",current:0,max:0,isIndeterminate:true,requestAbort:void 0};this.progressStream=new t.Rx.BehaviorSubject(this._progress);this.startEndCounter=0;this.progressTick.throttle(1e3/15).subscribe(function(t){e.progressStream.onNext({message:t.message,isIndeterminate:t.isIndeterminate,current:t.current,max:t.max,requestAbort:t.requestAbort})})}Object.defineProperty(e.prototype,"isAbortRequested",{get:function(){return this._abortRequested},enumerable:true,configurable:true});e.prototype.checkAborted=function(){if(this._abortRequested)throw r.Aborted};e.prototype.requestAbort=function(){try{if(this._abortRequester){this._abortRequester.call(null)}}catch(t){}};Object.defineProperty(e.prototype,"progress",{get:function(){return this.progressTick},enumerable:true,configurable:true});e.prototype.updateProgress=function(e,r,n,i){if(n===void 0){n=NaN}if(i===void 0){i=NaN}this.checkAborted();this._progress.message=e;if(typeof r==="boolean"){this._progress.requestAbort=r?this._abortRequester:void 0}else{if(r)this._abortRequester=r;this._progress.requestAbort=r?this._abortRequester:void 0}if(isNaN(n)){this._progress.isIndeterminate=true}else{this._progress.isIndeterminate=false;this._progress.current=n;this._progress.max=i}this.progressTick.onNext(this._progress);return new t.Promise(function(t){return setTimeout(t,0)})};e.prototype.started=function(){this.startEndCounter++};e.prototype.finished=function(){this.startEndCounter--;if(this.startEndCounter<=0){this.progressTick.onCompleted();this.progressStream.onCompleted()}if(this.startEndCounter<0){throw"Bug in code somewhere, Computation.resolve/reject called too many times."}};return e}()})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){"use strict";function e(){var t=Object.create(null);t["__"]=void 0;delete t["__"];return t}var r;(function(t){function r(t,e,r){var n=Object.prototype.hasOwnProperty;for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];if(!n.call(t,s))continue;var a=t[s];if(a===void 0)continue;e(a,s,r)}}var n={set:function(t,e){if(this.data[t]===void 0&&e!==void 0){this.size++}this.data[t]=e},get:function(t){return this.data[t]},delete:function(t){if(this.data[t]===void 0)return false;delete this.data[t];this.size--;return true},has:function(t){return this.data[t]!==void 0},clear:function(){this.data=e();this.size=0},forEach:function(t,e){r(this.data,t,e!==void 0?e:void 0)}};function i(){var t=Object.create(n);t.data=e();t.size=0;return t}t.create=i;function o(t){var e=i();for(var r=0,n=t;r<n.length;r++){var o=n[r];e.set(o[0],o[1])}return e}t.ofArray=o;function s(t){var e=i();var r=Object.prototype.hasOwnProperty;for(var n=0,o=Object.keys(t);n<o.length;n++){var s=o[n];if(!r.call(t,s))continue;var a=t[s];e.set(s,a)}return e}t.ofObject=s})(r=t.FastMap||(t.FastMap={}));var n;(function(t){function r(t,e,r){var n=Object.prototype.hasOwnProperty;for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];if(!n.call(t,s)||t[s]!==null)continue;e(s,r)}}var n={add:function(t){if(this.data[t]===null)return false;this.data[t]=null;this.size++;return true},delete:function(t){if(this.data[t]!==null)return false;delete this.data[t];this.size--;return true},has:function(t){return this.data[t]===null},clear:function(){this.data=e();this.size=0},forEach:function(t,e){r(this.data,t,e!==void 0?e:void 0)}};function i(){var t=Object.create(n);t.data=e();t.size=0;return t}t.create=i;function o(t){var e=i();for(var r=0,n=t.length;r<n;r++){e.add(t[r])}return e}t.ofArray=o})(n=t.FastSet||(t.FastSet={}))})(e=t.Utils||(t.Utils={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){"use strict";e.FastNumberParsers=t.Formats.CIF.Utils.FastNumberParsers;function r(t,e,r){var n;var i=e;var o=t;var s=r;for(var a=0,u=Object.keys(e);a<u.length;a++){var c=u[a];n=i[c];if(n!==void 0)o[c]=n;else if(r)o[c]=s[c]}if(r){for(var f=0,h=Object.keys(r);f<h.length;f++){var c=h[f];n=o[c];if(n===void 0)o[c]=s[c]}}return t}e.extend=r;function n(t,e){var r,n,i,o,s,a,u,c=0,f=0,h=true,l=false;e=Math.max(0,e)||0;var d=function(){var f=e-(performance.now()-o);if(f<=0){if(n){clearTimeout(n)}var h=u;n=a=u=void 0;if(h){c=performance.now();i=t.apply(s,r);if(!a&&!n){r=s=null}}}else{a=setTimeout(d,f)}};var p=function(){if(a){clearTimeout(a)}n=a=u=void 0;if(h||f!==e){c=performance.now();i=t.apply(s,r);if(!a&&!n){r=s=null}}};return function(){r=arguments;o=performance.now();s=this;u=h&&(a||!l);var v=false;var m=false;if(f===0){m=l&&!a}else{if(!n&&!l){c=o}var y=f-(o-c),g=y<=0;if(g){if(n){n=clearTimeout(n)}c=o;i=t.apply(s,r)}else if(!n){n=setTimeout(p,y)}}if(v&&a){a=clearTimeout(a)}else if(!a&&e!==f){a=setTimeout(d,e)}if(m){v=true;i=t.apply(s,r)}if(v&&!a&&!n){r=s=null}return i}}e.debounce=n})(e=t.Utils||(t.Utils={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){"use strict";var e;(function(e){function r(t){return function(e){return new t(e)}}e.typedColumn=r;function n(){return function(t){return new Array(t)}}e.customColumn=n;e.stringColumn=function(t){return new Array(t)};e.stringNullColumn=function(t){return new Array(t)};function i(t){return new u(t)}e.builder=i;function o(t,r){var n=e.builder(r);for(var i=0,o=Object.keys(t);i<o.length;i++){var s=o[i];if(!Object.prototype.hasOwnProperty.call(t,s))continue;var a=t[s];if(a){n.addColumn(s,a)}}return n.seal()}e.ofDefinition=o;function s(t,e){var r=Object.create(null);for(var n=0,i=t.columns;n<i.length;n++){var o=i[n];(function(t,e,r,n){Object.defineProperty(e,t.name,{enumerable:true,configurable:false,get:function(){return n[r.index]}})})(o,r,e,t[o.name])}return r}var a=function(){function e(e,r,n){this.__rowIndexer={index:0};this.count=e;this.indices=new Int32Array(e);this.columns=[];for(var i=0;i<e;i++){this.indices[i]=i}for(var o=0,a=r;o<a.length;o++){var u=a[o];var c=n[u.name];if(t.ChunkedArray.is(c)){c=t.ChunkedArray.compact(c)}Object.defineProperty(this,u.name,{enumerable:true,configurable:false,writable:false,value:c});this.columns[this.columns.length]=u}this.__row=s(this,this.__rowIndexer)}e.prototype.getBuilder=function(t){var e=new u(t);for(var r=0,n=this.columns;r<n.length;r++){var i=n[r];e.addColumn(i.name,i.creator)}return e};e.prototype.getRawData=function(){var t=this;return this.columns.map(function(e){return t[e.name]})};e.prototype.getRow=function(t){this.__rowIndexer.index=t;return this.__row};return e}();var u=function(){function t(t){this.columns=[];this.count=t}t.prototype.addColumn=function(t,e){var r=e(this.count);Object.defineProperty(this,t,{enumerable:true,configurable:false,writable:false,value:r});this.columns[this.columns.length]={name:t,creator:e};return r};t.prototype.getRawData=function(){var t=this;return this.columns.map(function(e){return t[e.name]})};t.prototype.seal=function(){return new a(this.count,this.columns,this)};return t}()})(e=t.DataTable||(t.DataTable={}))})(e=t.Utils||(t.Utils={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){"use strict";function e(t){var e=new Int32Array(t.size);t.forEach(function(t,e){e.array[e.index++]=t},{array:e,index:0});Array.prototype.sort.call(e,function(t,e){return t-e});return e}t.integerSetToSortedTypedArray=e;function r(t){var e=[];for(var r=0;r<t;r++)e[r]=0;return e}t.makeNativeIntArray=r;function n(t){var e=[];if(!t)return e;e[0]=.1;for(var r=0;r<t;r++)e[r]=0;return e}t.makeNativeFloatArray=n;var i;(function(t){function e(t){return t.creator&&t.chunkSize}t.is=e;function r(t,e,r,n,i){if(t.currentIndex>=t.chunkSize){t.currentIndex=0;t.current=t.creator(t.chunkSize);t.parts[t.parts.length]=t.current}t.current[t.currentIndex++]=e;t.current[t.currentIndex++]=r;t.current[t.currentIndex++]=n;t.current[t.currentIndex++]=i;return t.elementCount++}t.add4=r;function n(t,e,r,n){if(t.currentIndex>=t.chunkSize){t.currentIndex=0;t.current=t.creator(t.chunkSize);t.parts[t.parts.length]=t.current}t.current[t.currentIndex++]=e;t.current[t.currentIndex++]=r;t.current[t.currentIndex++]=n;return t.elementCount++}t.add3=n;function i(t,e,r){if(t.currentIndex>=t.chunkSize){t.currentIndex=0;t.current=t.creator(t.chunkSize);t.parts[t.parts.length]=t.current}t.current[t.currentIndex++]=e;t.current[t.currentIndex++]=r;return t.elementCount++}t.add2=i;function o(t,e){if(t.currentIndex>=t.chunkSize){t.currentIndex=0;t.current=t.creator(t.chunkSize);t.parts[t.parts.length]=t.current}t.current[t.currentIndex++]=e;return t.elementCount++}t.add=o;function s(t){var e=t.creator(t.elementSize*t.elementCount),r=(t.parts.length-1)*t.chunkSize,n=0,i;if(t.parts.length>1){if(t.parts[0].buffer){for(var o=0;o<t.parts.length-1;o++){e.set(t.parts[o],t.chunkSize*o)}}else{for(var o=0;o<t.parts.length-1;o++){n=t.chunkSize*o;i=t.parts[o];for(var s=0;s<t.chunkSize;s++){e[n+s]=i[s]}}}}if(t.current.buffer&&t.currentIndex>=t.chunkSize){e.set(t.current,t.chunkSize*(t.parts.length-1))}else{for(var o=0;o<t.currentIndex;o++){e[r+o]=t.current[o]}}return e}t.compact=s;function a(t){if(t===void 0){t=262144}return p(function(t){return new Float32Array(t)},t,3)}t.forVertex3D=a;function u(t){if(t===void 0){t=262144}return p(function(t){return new Uint32Array(t)},t,3)}t.forIndexBuffer=u;function c(t){if(t===void 0){t=131072}return p(function(t){return new Int32Array(t)},t,2)}t.forTokenIndices=c;function f(t){if(t===void 0){t=131072}return p(function(t){return new Int32Array(t)},t,1)}t.forIndices=f;function h(t){if(t===void 0){t=131072}return p(function(t){return new Int32Array(t)},t,1)}t.forInt32=h;function l(t){if(t===void 0){t=131072}return p(function(t){return new Float32Array(t)},t,1)}t.forFloat32=l;function d(t){if(t===void 0){t=131072}return p(function(t){return[]},t,1)}t.forArray=d;function p(t,e,r){e=e|0;if(e<=0)e=1;var n=e*r;var i=t(n);return{elementSize:r,chunkSize:n,creator:t,current:i,parts:[i],currentIndex:0,elementCount:0}}t.create=p})(i=t.ChunkedArray||(t.ChunkedArray={}));var o;(function(t){function e(t,e,r,n){var i=t.array;i[t.currentIndex++]=e;i[t.currentIndex++]=r;i[t.currentIndex++]=n;t.elementCount++}t.add3=e;function r(t,e,r){var n=t.array;n[t.currentIndex++]=e;n[t.currentIndex++]=r;t.elementCount++}t.add2=r;function n(t,e){t.array[t.currentIndex++]=e;t.elementCount++}t.add=n;function i(t){return h(function(t){return new Float32Array(t)},t,3)}t.forVertex3D=i;function o(t){return h(function(t){return new Int32Array(t)},t,3)}t.forIndexBuffer=o;function s(t){return h(function(t){return new Int32Array(t)},t,2)}t.forTokenIndices=s;function a(t){return h(function(t){return new Int32Array(t)},t,1)}t.forIndices=a;function u(t){return h(function(t){return new Int32Array(t)},t,1)}t.forInt32=u;function c(t){return h(function(t){return new Float32Array(t)},t,1)}t.forFloat32=c;function f(t){return h(function(t){return[]},t,1)}t.forArray=f;function h(t,e,r){e=e|0;return{array:t(e*r),currentIndex:0,elementCount:0}}t.create=h})(o=t.ArrayBuilder||(t.ArrayBuilder={}))})(e=t.Utils||(t.Utils={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){"use strict";var e;(function(t){t.perfGetTime=function(){if(typeof window!=="undefined"&&window.performance){return function(){return window.performance.now()}}else if(typeof process!=="undefined"&&process.hrtime!=="undefined"){return function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}}else{return function(){return+new Date}}}()})(e||(e={}));var r=function(){function r(){this.starts=t.FastMap.create();this.ends=t.FastMap.create()}r.currentTime=function(){return e.perfGetTime()};r.prototype.start=function(t){this.starts.set(t,e.perfGetTime())};r.prototype.end=function(t){this.ends.set(t,e.perfGetTime())};r.format=function(t){if(isNaN(t))return"n/a";var e=Math.floor(t/(60*60*1e3)),r=Math.floor(t/(60*1e3)%60),n=Math.floor(t/1e3%60),i=Math.floor(t%1e3).toString();while(i.length<3)i="0"+i;if(e>0)return e+"h"+r+"m"+n+"."+i+"s";if(r>0)return r+"m"+n+"."+i+"s";if(n>0)return n+"."+i+"s";return t.toFixed(0)+"ms"};r.prototype.formatTime=function(t){return r.format(this.time(t))};r.prototype.formatTimeSum=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.format(this.timeSum.apply(this,t))};r.prototype.time=function(t){var e=this.starts.get(t),r=this.ends.get(t);this.starts.delete(t);this.ends.delete(t);return r-e};r.prototype.timeSum=function(){var t=this;var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}var n=0;for(var i=0,o=e.map(function(e){return t.ends.get(e)-t.starts.get(e)});i<o.length;i++){var s=o[i];n+=s}return n};return r}();t.PerformanceMonitor=r})(e=t.Utils||(t.Utils={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){"use strict";var e;(function(t){function e(t){return t.name&&t.parse}t.is=e;function r(t,e){e=e.toLowerCase().trim();for(var r=0,n=t;r<n.length;r++){var i=n[r];for(var o=0,s=i.shortcuts;o<s.length;o++){var a=s[o];if(a.toLowerCase()===e)return i}}return void 0}t.fromShortcut=r;function n(t){return new RegExp(t.extensions.map(function(t){return"(\\"+t+")"}).join("|")+"(\\.gz){0,1}$","i")}t.formatRegExp=n;function i(t){return t.map(function(t){return t.extensions.map(function(t){return t+","+t+".gz"}).join(",")}).join(",")}t.formatFileFilters=i;function o(t,e){for(var r=0,i=e;r<i.length;r++){var o=i[r];if(n(o).test(t))return o}return void 0}t.getFormat=o})(e=t.FormatInfo||(t.FormatInfo={}));var r;(function(t){function e(t,e){if(e===void 0){e=-1}return new n(t,e)}t.error=e;function r(t,e){if(e===void 0){e=[]}return new i(t,e)}t.success=r})(r=t.ParserResult||(t.ParserResult={}));var n=function(){function t(t,e){this.message=t;this.line=e;this.isError=true}t.prototype.toString=function(){if(this.line>=0){return"[Line "+this.line+"] "+this.message}return this.message};return t}();t.ParserError=n;var i=function(){function t(t,e){this.result=t;this.warnings=e;this.isError=false}return t}();t.ParserSuccess=i;var o;(function(t){function e(t){var e=new Int32Array(Math.round(1.61*t.tokens.length));e.set(t.tokens);t.tokens=e;t.tokensLenMinus2=e.length-2}function r(t,r,n){if(t.count>=t.tokensLenMinus2){e(t)}t.tokens[t.count++]=r;t.tokens[t.count++]=n}t.addToken=r;function n(t){return{tokensLenMinus2:Math.round(t)-2,count:0,tokens:new Int32Array(t)}}t.create=n})(o=t.TokenIndexBuilder||(t.TokenIndexBuilder={}));var s;(function(t){function e(){return Object.create(null)}t.create=e;function r(t,e){if(e.length>6)return e;var r=t[e];if(r!==void 0)return r;t[e]=e;return e}t.get=r})(s=t.ShortStringPool||(t.ShortStringPool={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(e){var r;(function(e){"use strict";var r;(function(t){t.ElementSymbol="X";t.ResidueName="UNK";t.AsymId="";t.EntityId="1";t.ModelId="1"})(r||(r={}));function n(e,r,n,i){var o=t.Geometry.LinearAlgebra.Matrix4.identity(),s,a,u;for(s=1;s<=3;s++){for(a=1;a<=3;a++){u=r+"["+s+"]["+a+"]";t.Geometry.LinearAlgebra.Matrix4.setValue(o,s-1,a-1,e.getColumn(r+"["+s+"]["+a+"]").getFloat(i))}t.Geometry.LinearAlgebra.Matrix4.setValue(o,s-1,3,e.getColumn(n+"["+s+"]").getFloat(i))}return o}function i(t,e,r){var n=0;if(!r||!r.isDefined)return e;for(n=t+1;n<e;n++){if(!r.areValuesEqual(n-1,n))break}return n}var o=["id","Cartn_x","Cartn_y","Cartn_z","label_atom_id","type_symbol","occupancy","B_iso_or_equiv","auth_atom_id","label_alt_id","label_comp_id","label_seq_id","label_asym_id","auth_comp_id","auth_seq_id","auth_asym_id","group_PDB","label_entity_id","pdbx_PDB_ins_code","pdbx_PDB_model_num"];function s(e){var r=t.Utils.FastMap.create();for(var n=0,i=o;n<i.length;n++){var s=i[n];r.set(s,e.getColumn(s))}return r}function a(e,n,o){var s=i(e,n,o.get("pdbx_PDB_model_num"));var a=t.Utils.DataTable.ofDefinition(t.Structure.Tables.Atoms,s-e),u=t.Utils.DataTable.ofDefinition(t.Structure.Tables.Positions,s-e),c=u.x,f=o.get("Cartn_x"),h=u.y,l=o.get("Cartn_y"),d=u.z,p=o.get("Cartn_z"),v=a.id,m=o.get("id"),y=a.altLoc,g=o.get("label_alt_id"),b=a.rowIndex,_=a.residueIndex,w=a.chainIndex,x=a.entityIndex,C=a.name,I=o.get("label_atom_id"),S=a.elementSymbol,A=o.get("type_symbol"),k=a.occupancy,E=o.get("occupancy"),P=a.tempFactor,T=o.get("B_iso_or_equiv"),F=a.authName,D=o.get("auth_atom_id");var M=o.get("label_asym_id"),N=o.get("label_entity_id"),R=o.get("pdbx_PDB_ins_code"),q=o.get("auth_seq_id"),O=o.get("pdbx_PDB_model_num"),U=0,B=0,z=0;var L=e;for(var j=e;j<s;j++){var V=j-e;v[V]=m.getInteger(j);c[V]=f.getFloat(j);h[V]=l.getFloat(j);d[V]=p.getFloat(j);S[V]=A.getString(j)||r.ElementSymbol;C[V]=I.getString(j)||S[V];F[V]=D.getString(j)||C[V];y[V]=g.getString(j);k[V]=E.getFloat(j);P[V]=T.getFloat(j);var X=false;var Y=!q.areValuesEqual(L,j)||!R.areValuesEqual(L,j);if(!M.areValuesEqual(L,j)){X=true;Y=true}if(!N.areValuesEqual(L,j)){z++;X=true;Y=true}if(Y)B++;if(X)U++;b[V]=j;_[V]=B;w[V]=U;x[V]=z;L=j}var Z=!O.isDefined?r.ModelId:O.getString(e)||r.ModelId;return{atoms:a,positions:u,modelId:Z,endRow:s}}function u(e,n){var i=n.count,o=n.residueIndex,s=n.chainIndex,a=n.entityIndex;var u=t.Utils.DataTable.ofDefinition(t.Structure.Tables.Residues,n.residueIndex[n.count-1]+1),c=t.Utils.DataTable.ofDefinition(t.Structure.Tables.Chains,n.chainIndex[n.count-1]+1),f=t.Utils.DataTable.ofDefinition(t.Structure.Tables.Entities,n.entityIndex[n.count-1]+1);var h=u.name,l=u.seqNumber,d=u.asymId,p=u.authName,v=u.authSeqNumber,m=u.authAsymId,y=u.insCode,g=u.entityId,b=u.isHet,_=u.atomStartIndex,w=u.atomEndIndex,x=u.chainIndex,C=u.entityIndex;var I=c.asymId,S=c.entityId,A=c.authAsymId,k=c.atomStartIndex,E=c.atomEndIndex,P=c.residueStartIndex,T=c.residueEndIndex,F=c.entityIndex;var D=f.entityId,M=f.type,N=f.atomStartIndex,R=f.atomEndIndex,q=f.residueStartIndex,O=f.residueEndIndex,U=f.chainStartIndex,B=f.chainEndIndex;var z=e.get("label_comp_id"),L=e.get("label_seq_id"),j=e.get("label_asym_id"),V=e.get("auth_comp_id"),X=e.get("auth_seq_id"),Y=e.get("auth_asym_id"),Z=e.get("group_PDB"),H=e.get("label_entity_id"),G=e.get("pdbx_PDB_ins_code");var W=0,Q=0,J=0,K=0,$=0,tt=0,et=0,rt=0,nt=0;var it=0;for(it=0;it<i;it++){if(o[it]!==o[W]){h[et]=z.getString(W)||r.ResidueName;l[et]=L.getInteger(W);d[et]=j.getString(W)||r.AsymId;p[et]=V.getString(W)||h[et];v[et]=X.getInteger(W);m[et]=Y.getString(W)||d[et];y[et]=G.getString(W);g[et]=H.getString(W)||r.EntityId;b[et]=Z.stringEquals(W,"HETATM")?1:0;_[et]=W;w[et]=it;x[et]=rt;C[et]=nt;et++;W=it}if(s[it]!==s[Q]){I[rt]=j.getString(Q)||r.AsymId;A[rt]=Y.getString(Q)||I[rt];S[rt]=H.getString(Q)||r.EntityId;P[rt]=tt;T[rt]=et;k[rt]=Q;E[rt]=it;F[rt]=nt;rt++;Q=it;tt=et}if(a[it]!==a[J]){D[nt]=H.getString(J)||r.EntityId;M[nt]="unknown";N[nt]=J;R[nt]=it;q[nt]=$;O[nt]=et;U[nt]=K;B[nt]=rt;nt++;J=it;K=rt;$=et}}D[nt]=H.getString(J)||r.EntityId;M[nt]="unknown";N[nt]=J;R[nt]=it;q[nt]=$;O[nt]=et+1;U[nt]=K;B[nt]=rt+1;I[rt]=j.getString(Q)||r.AsymId;A[rt]=Y.getString(Q)||I[rt];S[rt]=H.getString(Q)||r.EntityId;P[rt]=tt;T[rt]=et+1;k[rt]=Q;E[rt]=it;F[rt]=nt;h[et]=z.getString(W)||r.ResidueName;l[et]=L.getInteger(W);d[et]=j.getString(W)||r.AsymId;p[et]=V.getString(W)||h[et];v[et]=X.getInteger(W);m[et]=Y.getString(W)||d[et];y[et]=G.getString(W);_[et]=W;w[et]=it;x[et]=rt;C[et]=nt;b[et]=Z.stringEquals(W,"HETATM")?1:0;return{residues:u,chains:c,entities:f}}function c(t,e){var n;if(!t){return}var i={},o=t.getColumn("type"),s=t.getColumn("id");for(n=0;n<t.rowCount;n++){var a=(o.getString(n)||"").toLowerCase();var u=s.getString(n)||r.EntityId;switch(a){case"polymer":case"non-polymer":case"water":i[u]=a;break;default:i[u]="unknown";break}}for(n=0;n<e.count;n++){var c=i[e.entityId[n]];if(c!==void 0){e.type[n]=c}}}function f(e,n,i,o){return new t.Structure.PolyResidueIdentifier(n.getString(e)||r.AsymId,i.getInteger(e),o.getString(e))}var h={ALA:true,ARG:true,ASP:true,CYS:true,GLN:true,GLU:true,GLY:true,HIS:true,ILE:true,LEU:true,LYS:true,MET:true,PHE:true,PRO:true,SER:true,THR:true,TRP:true,TYR:true,VAL:true,ASN:true,PYL:true,SEC:true};function l(t,e,r,n){if(r.type[e.entityIndex[n]]!=="polymer")return false;var i=false,o=false,s=t.name,a=0;for(var u=e.atomStartIndex[n],c=e.atomEndIndex[n];u<c;u++){var f=s[u];if(!i&&f==="CA"){i=true;a++}else if(!o&&f==="O"){o=true;a++}if(a===2)break}return i&&o||i&&!e.isHet[n]}function d(t,e,r,n){if(h[e.name[n]]||r.type[e.entityIndex[n]]!=="polymer")return false;var i=t.name,o=0;var s=e.atomStartIndex[n],a=e.atomEndIndex[n];if(a-s===1&&!e.isHet[s]&&i[s]==="P"){return true}for(var u=s;u<a;u++){var c=i[u];if(c==="O5'"||c==="C3'"||c==="N3"||c==="P"){o++}if(o>=3){return true}}return false}function p(e,r,n,i,o,s){var a=r.asymId,u=r.entityIndex,c=0,f=i,h=i,p=o;while(f<p){if(d(e,r,n,f)){h=f+1;while(h<p&&a[f]===a[h]&&u[f]===u[h]&&d(e,r,n,h)){h++}c=5}else if(l(e,r,n,f)){h=f+1;while(h<p&&a[f]===a[h]&&u[f]===u[h]&&l(e,r,n,h)){h++}c=4}else{h=f+1;while(h<p&&a[f]===a[h]&&u[f]===u[h]&&!d(e,r,n,h)&&!l(e,r,n,h)){h++}c=0}var v=new t.Structure.SecondaryStructureElement(c,new t.Structure.PolyResidueIdentifier(r.asymId[f],r.seqNumber[f],r.insCode[f]),new t.Structure.PolyResidueIdentifier(r.asymId[h-1],r.seqNumber[h-1],r.insCode[h-1]));v.startResidueIndex=f;v.endResidueIndex=h;s[s.length]=v;f=h}}function v(e,r){var n=[];var i=e.authSeqNumber;for(var o=0,s=r;o<s.length;o++){var a=s[o];var u=a.startResidueIndex;var c=a.endResidueIndex-1;for(var f=a.startResidueIndex;f<c;f++){if(i[f+1]-i[f]===1)continue;var h=new t.Structure.SecondaryStructureElement(a.type,a.startResidueId,a.endResidueId,a.info);h.startResidueIndex=u;h.endResidueIndex=f+1;n[n.length]=h;u=f+1}if(u===a.startResidueIndex){n[n.length]=a}else{var h=new t.Structure.SecondaryStructureElement(a.type,a.startResidueId,a.endResidueId,a.info);h.startResidueIndex=u;h.endResidueIndex=a.endResidueIndex;n[n.length]=h}}return n}function m(e,r){var n=r.residues,i=n.count,o=n.asymId,s=n.seqNumber,a=n.insCode,u=void 0,c="",f=t.Utils.FastMap.create(),h=t.Utils.FastMap.create();for(var l=0,d=e;l<d.length;l++){var p=d[l];c=p.startResidueId.asymId+" "+p.startResidueId.seqNumber;if(p.startResidueId.insCode)c+=" "+p.startResidueId.insCode;f.set(c,p);c=p.endResidueId.asymId+" "+p.endResidueId.seqNumber;if(p.endResidueId.insCode)c+=" "+p.endResidueId.insCode;h.set(c,p)}for(var v=0;v<i;v++){c=o[v]+" "+s[v];if(a[v])c+=" "+a[v];u=f.get(c);if(u){u.startResidueIndex=v;u.endResidueIndex=v+1}u=h.get(c);if(u){if(u.startResidueIndex<0)u.startResidueIndex=v;u.endResidueIndex=v+1}}if(u){u.endResidueIndex=i}var m=[];for(var g=0,b=e;g<b.length;g++){var p=b[g];if(p.startResidueIndex<0||p.endResidueIndex<0)continue;if(p.type===3&&p.length<3)continue;if(p.endResidueIndex>=0&&p.startResidueIndex>=0)m[m.length]=p}m.sort(function(t,e){return t.startResidueIndex-e.startResidueIndex});for(var v=0;v<m.length-1;v++){if(m[v+1].startResidueIndex-m[v].endResidueIndex===-1){m[v+1].startResidueIndex++}}if(!m.length)return m;var _=[m[0]];for(var v=1;v<m.length;v++){var w=_[_.length-1],x=m[v];if(x.startResidueIndex<w.endResidueIndex){y(w,x)}else{_[_.length]=x}}return _}function y(t,e){if(e.endResidueIndex>t.endResidueIndex){t.endResidueIndex=e.endResidueIndex}}function g(e,r,n){var i=[],o=[];var s=e.getCategory("_struct_conf"),a=e.getCategory("_struct_sheet_range"),u;if(s){var c=s.getColumn("conf_type_id");if(c){var h=s.getColumn("beg_label_asym_id");var l=s.getColumn("beg_label_seq_id");var d=s.getColumn("pdbx_beg_PDB_ins_code");var y=s.getColumn("end_label_asym_id");var g=s.getColumn("end_label_seq_id");var b=s.getColumn("pdbx_end_PDB_ins_code");var _=s.getColumn("pdbx_PDB_helix_class");for(u=0;u<s.rowCount;u++){var w=void 0;switch((c.getString(u)||"").toUpperCase()){case"HELX_P":w=1;break;case"TURN_P":w=2;break}if(!w)continue;i[i.length]=new t.Structure.SecondaryStructureElement(w,f(u,h,l,d),f(u,y,g,b),{helixClass:_.getString(u)})}}}if(a){var h=a.getColumn("beg_label_asym_id");var l=a.getColumn("beg_label_seq_id");var d=a.getColumn("pdbx_beg_PDB_ins_code");var y=a.getColumn("end_label_asym_id");var g=a.getColumn("end_label_seq_id");var b=a.getColumn("pdbx_end_PDB_ins_code");var x=a.getColumn("symmetry");var C=a.getColumn("sheet_id");for(u=0;u<a.rowCount;u++){i[i.length]=new t.Structure.SecondaryStructureElement(3,f(u,h,l,d),f(u,y,g,b),{symmetry:x.getString(u),sheetId:C.getString(u),id:C.getString(u)})}}var I=i.length>0?m(i,n):[];var S=n.residues,A=S.count;if(I.length===0){p(r,S,n.entities,0,A,o);return v(S,o)}var k=I.length-1;if(I[0].startResidueIndex>0){p(r,S,n.entities,0,I[0].startResidueIndex,o)}for(u=0;u<k;u++){o[o.length]=I[u];if(I[u+1].startResidueIndex-I[u].endResidueIndex>0){p(r,S,n.entities,I[u].endResidueIndex,I[u+1].startResidueIndex,o)}}o[o.length]=I[k];if(I[k].endResidueIndex<A){p(r,S,n.entities,I[k].endResidueIndex,A,o)}return v(S,o)}function b(t,e){var r=t.secondaryStructureIndex;var n=0;for(var i=0,o=e;i<o.length;i++){var s=o[i];for(var a=s.startResidueIndex;a<s.endResidueIndex;a++){r[a]=n}n++}return r}function _(t){var e=/\(?([^\(\)]+)\)?]*/g,r,n=[],i=[];while(r=e.exec(t))n[n.length]=r[1];n.forEach(function(t){var e=[];t.split(",").forEach(function(t){var r=t.indexOf("-");if(r>0){var n=parseInt(t.substring(0,r)),i=parseInt(t.substr(r+1));for(var o=n;o<=i;o++)e[e.length]=o.toString()}else{e[e.length]=t.trim()}});i[i.length]=e});return i}function w(e){var r=e.getCategory("_pdbx_struct_assembly"),i=e.getCategory("_pdbx_struct_assembly_gen"),o=e.getCategory("_pdbx_struct_oper_list");if(!r||!i||!o){return void 0}var s,a={},u=[],c=t.Utils.FastMap.create();var f=i.getColumn("assembly_id");var h=i.getColumn("oper_expression");var l=i.getColumn("asym_id_list");for(s=0;s<i.rowCount;s++){var d=f.getString(s);if(!d){return void 0}var p=c.get(d);if(!p){p=new t.Structure.AssemblyGen(d);c.set(d,p);u.push(p)}p.gens.push(new t.Structure.AssemblyGenEntry(_(h.getString(s)),l.getString(s).split(",")))}var v=o.getColumn("id");var m=o.getColumn("name");for(s=0;s<o.rowCount;s++){var y=n(o,"matrix","vector",s);if(!y){return void 0}var g=new t.Structure.AssemblyOperator(v.getString(s),m.getString(s),y);a[g.id]=g}return new t.Structure.AssemblyInfo(a,u)}function x(e){var r=e.getCategory("_cell"),i=e.getCategory("_symmetry"),o=e.getCategory("_atom_sites");var s="",a=[1,1,1],u=[90,90,90],c=t.Geometry.LinearAlgebra.Matrix4.identity(),f=false;if(!r||!i){return void 0}s=i.getColumn("space_group_name_H-M").getString(0);a=[r.getColumn("length_a").getFloat(0),r.getColumn("length_b").getFloat(0),r.getColumn("length_c").getFloat(0)];u=[r.getColumn("angle_alpha").getFloat(0),r.getColumn("angle_beta").getFloat(0),r.getColumn("angle_gamma").getFloat(0)];if(!s||a.every(function(t){return isNaN(t)||t===0})||a.every(function(t){return isNaN(t)||t===0})){return void 0}var h=function(t){return t*t};var l=function(t){return t*Math.PI/180};var d=a[0],p=a[1],v=a[2],m=l(u[0]),y=l(u[1]),g=l(u[2]),b=d*p*v*Math.sqrt(1-h(Math.cos(m))-h(Math.cos(y))-h(Math.cos(g))+2*Math.cos(m)*Math.cos(y)*Math.cos(g));var _=t.Geometry.LinearAlgebra.Matrix4.ofRows([[d,p*Math.cos(g),v*Math.cos(y),0],[0,p*Math.sin(g),v*(Math.cos(m)-Math.cos(y)*Math.cos(g))/Math.sin(g),0],[0,0,b/(d*p*Math.sin(g)),0],[0,0,0,1]]);var w=t.Geometry.LinearAlgebra.Matrix4.identity();t.Geometry.LinearAlgebra.Matrix4.invert(w,_);if(o){var x=n(o,"fract_transf_matrix","fract_transf_vector",0);if(x){c=x;if(!t.Geometry.LinearAlgebra.Matrix4.areEqual(w,x,1e-4)){f=true}}}else{c=w}return new t.Structure.SymmetryInfo(s,a,u,c,f)}function C(e){if(!e||!e.rowCount)return void 0;var r=new t.Structure.ComponentBondInfo;var n=e.getColumn("comp_id"),i=e.getColumn("atom_id_1"),o=e.getColumn("atom_id_2"),s=e.getColumn("value_order"),a=e.rowCount;var u=r.newEntry(n.getString(0));for(var c=0;c<a;c++){var f=n.getString(c),h=i.getString(c),l=o.getString(c),d=s.getString(c);if(u.id!==f){u=r.newEntry(f)}var p=void 0;switch(d.toLowerCase()){case"sing":p=1;break;case"doub":case"delo":p=2;break;case"trip":p=3;break;case"quad":p=4;break;default:p=0;break}u.add(h,l,p)}return r}function I(e,r,n){var i=a(e,r.getCategory("_atom_site").rowCount,n),o=i.atoms,s=i.positions,f=i.modelId,h=i.endRow,l=u(n,o),d=r.getCategory("_entry"),p;if(d&&d.getColumn("id").isDefined)p=d.getColumn("id").getString(0);else p=r.header;c(r.getCategory("_entity"),l.entities);var v=g(r,o,l);b(l.residues,v);return{model:t.Structure.Molecule.Model.create({id:p,modelId:f,data:{atoms:o,residues:l.residues,chains:l.chains,entities:l.entities,bonds:{component:C(r.getCategory("_chem_comp_bond"))},secondaryStructure:v,symmetryInfo:x(r),assemblyInfo:w(r)},positions:s,source:t.Structure.Molecule.Model.Source.File}),endRow:h}}function S(e){var r=[],n=e.getCategory("_atom_site"),i=0;if(!n){throw"'_atom_site' category is missing in the input."}var o=e.getCategory("_entry"),a=s(n),u;if(o&&o.getColumn("id").isDefined)u=o.getColumn("id").getString(0);else u=e.header;while(i<n.rowCount){var c=I(i,e,a),f=c.model,h=c.endRow;r.push(f);i=h}var l=void 0;var d=e.getCategory("_exptl");if(d){l=d.getColumn("method").getString(0)||void 0}return t.Structure.Molecule.create(u,r,{experimentMethod:l})}e.ofDataBlock=S})(r=e.mmCIF||(e.mmCIF={}))})(r=e.Molecule||(e.Molecule={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(r){var n;(function(r){"use strict";var n=function(){function t(t,e,r,n){this.header=t;this.crystInfo=e;this.models=r;this.data=n}t.prototype.makeEntities=function(){var t=["data_ent","loop_","_entity.id","_entity.type","_entity.src_method","_entity.pdbx_description","_entity.formula_weight","_entity.pdbx_number_of_molecules","_entity.details","_entity.pdbx_mutation","_entity.pdbx_fragment","_entity.pdbx_ec","1 polymer man polymer 0.0 0 ? ? ? ?","2 non-polymer syn non-polymer 0.0 0 ? ? ? ?","3 water nat water 0.0 0 ? ? ? ?"].join("\n");var r=e.CIF.Text.parse(t);if(r.isError){throw r.toString()}return r.result.dataBlocks[0].getCategory("_entity")};t.prototype.toCifFile=function(){var t={dot:r.Parser.getDotRange(this.data.length),question:r.Parser.getQuestionmarkRange(this.data.length),numberTokens:r.Parser.getNumberRanges(this.data.length),data:this.data};var n=new e.CIF.Text.File(this.data);var i=new e.CIF.Text.DataBlock(this.data,this.header.id);n.dataBlocks.push(i);i.addCategory(this.makeEntities());if(this.crystInfo){var o=this.crystInfo.toCifCategory(this.header.id),s=o.cell,a=o.symm;i.addCategory(s);i.addCategory(a)}i.addCategory(this.models.toCifCategory(i,t));return n};return t}();r.MoleculeData=n;var i=function(){function t(t){this.id=t}return t}();r.Header=i;var o=function(){function t(t){this.record=t}t.prototype.getValue=function(t,e){var r=this.record.substr(6,9).trim();if(!r.length)return".";return r};t.prototype.toCifCategory=function(t){var r=["_cell.entry_id           '"+t+"'","_cell.length_a           "+this.getValue(6,9),"_cell.length_b           "+this.getValue(15,9),"_cell.length_c           "+this.getValue(24,9),"_cell.angle_alpha        "+this.getValue(33,7),"_cell.angle_beta         "+this.getValue(40,7),"_cell.angle_gamma        "+this.getValue(48,7),"_cell.Z_PDB              "+this.getValue(66,4),"_cell.pdbx_unique_axis   ?","_symmetry.entry_id                         '"+t+"'","_symmetry.space_group_name_H-M             '"+this.getValue(55,11)+"'","_symmetry.pdbx_full_space_group_name_H-M   ?","_symmetry.cell_setting                     ?","_symmetry.Int_Tables_number                ?","_symmetry.space_group_name_Hall            ?"].join("\n");var n=e.CIF.Text.parse(r);if(n.isError){throw new Error(n.toString())}return{cell:n.result.dataBlocks[0].getCategory("_cell"),symm:n.result.dataBlocks[0].getCategory("_symmetry")}};return t}();r.CrystStructureInfo=o;var s=function(){function t(t,e){this.helixTokens=t;this.sheetTokens=e}t.prototype.toCifCategory=function(t){return void 0};return t}();r.SecondaryStructure=s;var a=function(){function e(t,e,r){this.idToken=t;this.atomTokens=e;this.atomCount=r}e.prototype.writeToken=function(e,r){t.Utils.ArrayBuilder.add2(r,this.atomTokens[2*e],this.atomTokens[2*e+1])};e.prototype.writeTokenCond=function(e,r,n){var i=this.atomTokens[2*e];var o=this.atomTokens[2*e+1];if(i===o)t.Utils.ArrayBuilder.add2(r,n.start,n.end);else t.Utils.ArrayBuilder.add2(r,i,o)};e.prototype.writeRange=function(e,r){t.Utils.ArrayBuilder.add2(r,e.start,e.end)};e.prototype.tokenEquals=function(t,e,r,n){var i=r.length;if(i!==e-t)return false;for(var o=r.length-1;o>=0;o--){if(n.charCodeAt(o+t)!==r.charCodeAt(o)){return false}}return true};e.prototype.getEntityType=function(t,e){var r=t*14;if(this.tokenEquals(this.atomTokens[2*r],this.atomTokens[2*r+1],"HETATM",e)){var n=this.atomTokens[2*(r+4)],i=this.atomTokens[2*(r+4)+1];if(this.tokenEquals(n,i,"HOH",e)||this.tokenEquals(n,i,"WTR",e)||this.tokenEquals(n,i,"SOL",e)){return 3}return 2}else{return 1}};e.prototype.writeCifTokens=function(t,e,r){var n={RECORD:0,SERIAL:1,ATOM_NAME:2,ALT_LOC:3,RES_NAME:4,CHAIN_ID:5,RES_SEQN:6,INS_CODE:7,X:8,Y:9,Z:10,OCCUPANCY:11,TEMP_FACTOR:12,ELEMENT:13};var i=14;for(var o=0;o<this.atomCount;o++){var s=o*i;this.writeToken(s+n.RECORD,e);this.writeToken(s+n.SERIAL,e);this.writeToken(s+n.ELEMENT,e);this.writeToken(s+n.ATOM_NAME,e);this.writeTokenCond(s+n.ALT_LOC,e,r.dot);this.writeToken(s+n.RES_NAME,e);this.writeToken(s+n.CHAIN_ID,e);this.writeRange(r.numberTokens.get(this.getEntityType(o,r.data)),e);this.writeToken(s+n.RES_SEQN,e);this.writeTokenCond(s+n.INS_CODE,e,r.dot);this.writeToken(s+n.X,e);this.writeToken(s+n.Y,e);this.writeToken(s+n.Z,e);this.writeToken(s+n.OCCUPANCY,e);this.writeToken(s+n.TEMP_FACTOR,e);this.writeRange(r.question,e);this.writeRange(r.question,e);this.writeRange(r.question,e);this.writeRange(r.question,e);this.writeRange(r.question,e);this.writeRange(r.question,e);this.writeToken(s+n.RES_SEQN,e);this.writeToken(s+n.RES_NAME,e);this.writeToken(s+n.CHAIN_ID,e);this.writeToken(s+n.ATOM_NAME,e);this.writeRange(t,e)}};e.COLUMNS=["_atom_site.group_PDB","_atom_site.id","_atom_site.type_symbol","_atom_site.label_atom_id","_atom_site.label_alt_id","_atom_site.label_comp_id","_atom_site.label_asym_id","_atom_site.label_entity_id","_atom_site.label_seq_id","_atom_site.pdbx_PDB_ins_code","_atom_site.Cartn_x","_atom_site.Cartn_y","_atom_site.Cartn_z","_atom_site.occupancy","_atom_site.B_iso_or_equiv","_atom_site.Cartn_x_esd","_atom_site.Cartn_y_esd","_atom_site.Cartn_z_esd","_atom_site.occupancy_esd","_atom_site.B_iso_or_equiv_esd","_atom_site.pdbx_formal_charge","_atom_site.auth_seq_id","_atom_site.auth_comp_id","_atom_site.auth_asym_id","_atom_site.auth_atom_id","_atom_site.pdbx_PDB_model_num"];return e}();r.ModelData=a;var u=function(){function r(t){this.models=t}r.prototype.toCifCategory=function(r,n){var i=0;for(var o=0,s=this.models;o<s.length;o++){var u=s[o];i+=u.atomCount}var c=26;var f=t.Utils.ArrayBuilder.forTokenIndices(i*c);for(var h=0,l=this.models;h<l.length;h++){var u=l[h];u.writeCifTokens(u.idToken,f,n)}return new e.CIF.Text.Category(r.data,"_atom_site",0,0,a.COLUMNS,f.array,i*c)};return r}();r.ModelsData=u})(n=r.PDB||(r.PDB={}))})(r=e.Molecule||(e.Molecule={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(r){var n;(function(r){"use strict";var n=function(){function t(t){this.data=t;this.trimmedToken={start:0,end:0};this.line=0;this.position=0;this.length=t.length}t.prototype.moveToNextLine=function(){while(this.position<this.length&&this.data.charCodeAt(this.position)!==10){this.position++}this.position++;this.line++;return this.position};t.prototype.moveToEndOfLine=function(){while(this.position<this.length){var t=this.data.charCodeAt(this.position);if(t===10||t===13){return this.position}this.position++}return this.position};t.prototype.startsWith=function(t,e){for(var r=e.length-1;r>=0;r--){if(this.data.charCodeAt(r+t)!==e.charCodeAt(r)){return false}}return true};t.prototype.trim=function(t,e){while(t<e&&this.data.charCodeAt(t)===32)t++;while(e>t&&this.data.charCodeAt(e-1)===32)e--;this.trimmedToken.start=t;this.trimmedToken.end=e};t.prototype.tokenizeAtomRecord=function(t){var r=this.position;var n=this.position;var i=this.moveToEndOfLine();var o=i-n;if(o<60)return false;this.trim(n,n+6);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);n=r+6;this.trim(n,n+5);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);n=r+12;this.trim(n,n+4);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);if(this.data.charCodeAt(r+16)===32){e.TokenIndexBuilder.addToken(t,0,0)}else{e.TokenIndexBuilder.addToken(t,r+16,r+17)}n=r+17;this.trim(n,n+3);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);e.TokenIndexBuilder.addToken(t,r+21,r+22);n=r+22;this.trim(n,n+4);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);if(this.data.charCodeAt(r+26)===32){e.TokenIndexBuilder.addToken(t,0,0)}else{e.TokenIndexBuilder.addToken(t,r+26,r+27)}n=r+30;this.trim(n,n+8);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);n=r+38;this.trim(n,n+8);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);n=r+46;this.trim(n,n+8);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);n=r+54;this.trim(n,n+6);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end);if(o>=66){n=r+60;this.trim(n,n+6);e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end)}else{e.TokenIndexBuilder.addToken(t,0,0)}if(o>=78){n=r+76;this.trim(n,n+2);if(this.trimmedToken.start<this.trimmedToken.end){e.TokenIndexBuilder.addToken(t,this.trimmedToken.start,this.trimmedToken.end)}else{e.TokenIndexBuilder.addToken(t,r+12,r+13)}}else{e.TokenIndexBuilder.addToken(t,r+12,r+13)}return true};return t}();var i=function(){function i(){}i.tokenizeAtom=function(t,r){if(r.tokenizeAtomRecord(t)){return void 0}return new e.ParserError("Invalid ATOM/HETATM record.",r.line)};i.tokenize=function(t,o){var s=new n(o);var a=o.length;var u=e.TokenIndexBuilder.create(4096);var c=0;var f=[];var h=void 0;var l={start:0,end:0};while(s.position<a){var d=true;switch(o.charCodeAt(s.position)){case 65:if(s.startsWith(s.position,"ATOM")){if(!u){u=e.TokenIndexBuilder.create(4096)}var p=i.tokenizeAtom(u,s);c++;if(p)return p}break;case 67:if(s.startsWith(s.position,"CRYST1")){var v=s.position;var m=s.moveToEndOfLine();h=new r.CrystStructureInfo(o.substring(v,m))}break;case 69:if(s.startsWith(s.position,"ENDMDL")&&c>0){if(f.length===0){l={start:o.length+3,end:o.length+4}}if(u){f.push(new r.ModelData(l,u.tokens,c))}c=0;u=null}else if(s.startsWith(s.position,"END")){var v=s.position;var m=s.moveToEndOfLine();s.trim(v,m);if(s.trimmedToken.end-s.trimmedToken.start===3){d=false}}break;case 72:if(s.startsWith(s.position,"HETATM")){if(!u){u=e.TokenIndexBuilder.create(4096)}var p=i.tokenizeAtom(u,s);c++;if(p)return p}break;case 77:if(s.startsWith(s.position,"MODEL")){if(c>0){if(f.length===0){l={start:o.length+3,end:o.length+4}}if(u){f.push(new r.ModelData(l,u.tokens,c))}}var v=s.position+6;var m=s.moveToEndOfLine();s.trim(v,m);l={start:s.trimmedToken.start,end:s.trimmedToken.end};if(c>0||!u){u=e.TokenIndexBuilder.create(4096)}c=0}break}s.moveToNextLine();if(!d)break}var y=o+".?0123";if(c>0){if(f.length===0){l={start:o.length+3,end:o.length+4}}if(u){f.push(new r.ModelData(l,u.tokens,c))}}return new r.MoleculeData(new r.Header(t),h,new r.ModelsData(f),y)};i.getDotRange=function(t){return{start:t-6,end:t-5}};i.getNumberRanges=function(e){var r=t.Utils.FastMap.create();for(var n=0;n<4;n++){r.set(n,{start:e-4+n,end:e-3+n})}return r};i.getQuestionmarkRange=function(t){return{start:t-5,end:t-4}};i.parse=function(t,r){var n=i.tokenize(t,r);if(n instanceof e.ParserError){return e.ParserResult.error(n.message,n.line)}else{return e.ParserResult.success(n.toCifFile())}};return i}();r.Parser=i;function o(t,e){return i.parse(t,e)}r.toCifFile=o})(n=r.PDB||(r.PDB={}))})(r=e.Molecule||(e.Molecule={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(r){var n;(function(r){function n(r,n){var i=r.split(/\r?\n/g);var o=i[0].trim();if(!o.length)o="SDF";var s=i[3];var a=+s.substr(0,3);var u=+s.substr(3,3);return{id:n?n:o,atomCount:a,bondCount:u,atoms:t.Utils.DataTable.ofDefinition(t.Structure.Tables.Atoms,a),positions:t.Utils.DataTable.ofDefinition(t.Structure.Tables.Positions,a),bonds:t.Utils.DataTable.ofDefinition(t.Structure.Tables.Bonds,u),lines:i,currentLine:4,error:void 0,stringPool:e.ShortStringPool.create()}}function i(r,n){var i=n.lines[n.currentLine];var o=n.atoms,s=n.positions;var a=e.ShortStringPool.get(n.stringPool,i.substr(31,3).trim());o.id[r]=r;o.elementSymbol[r]=a;o.name[r]=a;o.authName[r]=a;o.occupancy[r]=1;o.rowIndex[r]=n.currentLine;s.x[r]=t.Utils.FastNumberParsers.parseFloatSkipTrailingWhitespace(i,0,10);s.y[r]=t.Utils.FastNumberParsers.parseFloatSkipTrailingWhitespace(i,10,20);s.z[r]=t.Utils.FastNumberParsers.parseFloatSkipTrailingWhitespace(i,20,30)}function o(t){for(var e=0;e<t.atomCount;e++){i(e,t);t.currentLine++}}function s(e,r){var n=r.lines[r.currentLine];var i=r.bonds;i.atomAIndex[e]=t.Utils.FastNumberParsers.parseIntSkipTrailingWhitespace(n,0,3)-1;i.atomBIndex[e]=t.Utils.FastNumberParsers.parseIntSkipTrailingWhitespace(n,3,6)-1;switch(t.Utils.FastNumberParsers.parseIntSkipTrailingWhitespace(n,6,9)){case 1:i.type[e]=1;break;case 2:i.type[e]=2;break;case 3:i.type[e]=3;break;case 4:i.type[e]=4;break;default:i.type[e]=0;break}}function a(t){for(var e=0;e<t.bondCount;e++){s(e,t);t.currentLine++}}function u(e){var r=t.Utils.DataTable.ofDefinition(t.Structure.Tables.Residues,1),n=t.Utils.DataTable.ofDefinition(t.Structure.Tables.Chains,1),i=t.Utils.DataTable.ofDefinition(t.Structure.Tables.Entities,1);r.isHet[0]=1;r.insCode[0]=null;r.name[0]=r.authName[0]="UNK";r.atomEndIndex[0]=n.atomEndIndex[0]=i.atomEndIndex[0]=e.atomCount;r.asymId[0]=r.authAsymId[0]=n.asymId[0]=n.authAsymId[0]="X";r.entityId[0]=n.entityId[0]=i.entityId[0]="1";n.residueEndIndex[0]=i.residueEndIndex[0]=0;i.chainEndIndex[0]=1;i.type[0]="non-polymer";var o=new t.Structure.PolyResidueIdentifier("X",0,null);var s=[new t.Structure.SecondaryStructureElement(0,o,o)];s[0].startResidueIndex=0;s[0].endResidueIndex=1;return t.Structure.Molecule.Model.create({id:e.id,modelId:"1",data:{atoms:e.atoms,residues:r,chains:n,entities:i,bonds:{covalent:e.bonds},secondaryStructure:s,symmetryInfo:void 0,assemblyInfo:void 0},positions:e.positions,source:t.Structure.Molecule.Model.Source.File})}function c(r,i){try{var s=n(r,i);o(s);a(s);var c=u(s);if(s.error){return e.ParserResult.error(s.error,s.currentLine+1)}var f=t.Structure.Molecule.create(i?i:s.id,[c]);return e.ParserResult.success(f)}catch(t){return e.ParserResult.error(""+t)}}r.parse=c})(n=r.SDF||(r.SDF={}))})(r=e.Molecule||(e.Molecule={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(r){function n(n,i){var o=this;return function(s,c){return t.computation(function(t){return a(o,void 0,void 0,function(){var o,a,f;return u(this,function(u){switch(u.label){case 0:return[4,t.updateProgress("Parsing...")];case 1:u.sent();o=i(s,c);if(o.isError){throw o.toString()}a=o.result;if(!a.dataBlocks.length){throw"The "+n+" data does not contain a data block."}return[4,t.updateProgress("Creating representation...")];case 2:u.sent();f=r.mmCIF.ofDataBlock(a.dataBlocks[0]);return[2,e.ParserResult.success(f,a.dataBlocks.length>1?["The input data contains multiple data blocks, only the first one was parsed. To parse all data blocks, use the function 'mmCIF.ofDataBlock' separately for each block."]:void 0)]}})})})}}var i;(function(i){var o=this;i.mmCIF={name:"mmCIF",shortcuts:["mmcif","cif"],extensions:[".cif"],parse:n("CIF",e.CIF.Text.parse)};i.mmBCIF={name:"mmCIF (Binary)",shortcuts:["mmbcif","bcif","binarycif"],extensions:[".bcif"],isBinary:true,parse:n("BinaryCIF",e.CIF.Binary.parse)};i.PDB={name:"PDB",shortcuts:["pdb","ent"],extensions:[".pdb",".ent"],parse:n("PDB",function(t,e){return r.PDB.toCifFile(e&&e.id||"PDB",t)})};i.SDF={name:"SDF",shortcuts:["sdf","mol"],extensions:[".sdf",".mol"],parse:function(n,i){return t.computation(function(t){return a(o,void 0,void 0,function(){var o;return u(this,function(s){switch(s.label){case 0:return[4,t.updateProgress("Parsing...")];case 1:s.sent();o=r.SDF.parse(n,i&&i.id||undefined);if(o.isError)throw o.toString();return[2,e.ParserResult.success(o.result)]}})})})}};i.All=[i.mmCIF,i.mmBCIF,i.PDB,i.SDF]})(i=r.SupportedFormats||(r.SupportedFormats={}))})(r=e.Molecule||(e.Molecule={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){var e;(function(t){"use strict";function e(t,e){var r=t.length;for(var n=0;n<r;n++){t[n]=e}}var r=function(){function t(t,e){this.data=t;this.dimensions=e;this.len=this.dimensions[0]*this.dimensions[1]*this.dimensions[2];this.nX=this.dimensions[0];this.nY=this.dimensions[1]}Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:true,configurable:true});t.prototype.getAt=function(t){return this.data[t]};t.prototype.setAt=function(t,e){this.data[t]=e};t.prototype.get=function(t,e,r){return this.data[this.nX*(r*this.nY+e)+t|0]};t.prototype.set=function(t,e,r,n){this.data[this.nX*(r*this.nY+e)+t|0]=n};t.prototype.fill=function(t){e(this.data,t)};return t}();t.Field3DZYX=r;function n(t,e,r){var n=Math.PI/180*r[0],i=Math.PI/180*r[1],o=Math.PI/180*r[2];var s=e[0],a=e[1],u=e[2];var c=Math.cos(i),f=(Math.cos(n)-Math.cos(i)*Math.cos(o))/Math.sin(o),h=Math.sqrt(1-c*c-f*f);var l=[s,0,0];var d=[Math.cos(o)*a,Math.sin(o)*a,0];var p=[c*u,f*u,h*u];return{number:t,size:e,angles:r,basis:{x:l,y:d,z:p}}}t.createSpacegroup=n})(e=t.Density||(t.Density={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){var e;(function(e){var r;(function(r){function n(t){return i.parse(t)}r.parse=n;var i;(function(r){function n(t,e,r){var n=[];for(var i=0;i<r;i++){n[i]=t(e+i)}return n}function i(r){var i=1024,a=new DataView(r,0,i),u=[];var c=false;var f=a.getInt32(3*4,false);if(f!==2){c=true;f=a.getInt32(3*4,true);if(f!==2){return t.ParserResult.error("Only CCP4 mode 2 is supported.")}}var h=function(t){return a.getInt32(t*4,c)},l=function(t){return a.getFloat32(t*4,c)};var d={extent:n(h,0,3),mode:f,nxyzStart:n(h,4,3),grid:n(h,7,3),cellSize:n(l,10,3),cellAngles:n(l,13,3),crs2xyz:n(h,16,3),min:l(19),max:l(20),mean:l(21),spacegroupNumber:h(22),symBytes:h(23),skewFlag:h(24),skewMatrix:n(l,25,9),skewTranslation:n(l,34,3),origin2k:n(l,49,3)};var p=r.byteLength-4*d.extent[0]*d.extent[1]*d.extent[2];if(p!==i+d.symBytes){if(p===i){u.push("File contains bogus symmetry record.")}else if(p<i){return t.ParserResult.error("File appears truncated and doesn't match header.")}else if(p>i&&p<1024*1024){p=i+d.symBytes;u.push("File is larger than expected and doesn't match header. Continuing file load, good luck!")}else{return t.ParserResult.error("File is MUCH larger than expected and doesn't match header.")}}if(d.grid[0]===0&&d.extent[0]>0){d.grid[0]=d.extent[0]-1;u.push("Fixed X interval count.")}if(d.grid[1]===0&&d.extent[1]>0){d.grid[1]=d.extent[1]-1;u.push("Fixed Y interval count.")}if(d.grid[2]===0&&d.extent[2]>0){d.grid[2]=d.extent[2]-1;u.push("Fixed Z interval count.")}if(d.crs2xyz[0]===0&&d.crs2xyz[1]===0&&d.crs2xyz[2]===0){u.push("All crs2xyz records are zero. Setting crs2xyz to 1, 2, 3.");d.crs2xyz=[1,2,3]}if(d.cellSize[0]===0&&d.cellSize[1]===0&&d.cellSize[2]===0){u.push("Cell dimensions are all zero. Setting to 1.0, 1.0, 1.0. Map file will not align with other structures.");d.cellSize[0]=1;d.cellSize[1]=1;d.cellSize[2]=1}var v=[0,0,0];v[d.crs2xyz[0]-1]=0;v[d.crs2xyz[1]-1]=1;v[d.crs2xyz[2]-1]=2;var m;if(d.origin2k[0]===0&&d.origin2k[1]===0&&d.origin2k[2]===0){m=[d.nxyzStart[v[0]],d.nxyzStart[v[1]],d.nxyzStart[v[2]]]}else{m=[d.origin2k[v[0]],d.origin2k[v[1]],d.origin2k[v[2]]]}var y=[d.extent[v[0]],d.extent[v[1]],d.extent[v[2]]];var g=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;var b=c===g?o(new Float32Array(r,i+d.symBytes,y[0]*y[1]*y[2]),c,y,d.extent,v,d.mean):s(new DataView(r,i+d.symBytes),c,y,d.extent,v,d.mean);var _=new e.Field3DZYX(b.data,y);var w={spacegroup:e.createSpacegroup(d.spacegroupNumber,d.cellSize,d.cellAngles),box:{origin:[m[0]/d.grid[0],m[1]/d.grid[1],m[2]/d.grid[2]],dimensions:[y[0]/d.grid[0],y[1]/d.grid[1],y[2]/d.grid[2]],sampleCount:y},data:_,valuesInfo:{min:d.min,max:d.max,mean:d.mean,sigma:b.sigma}};return t.ParserResult.success(w,u)}r.parse=i;function o(t,e,r,n,i,o){var s=new Float32Array(r[0]*r[1]*r[2]),a=[0,0,0],u,c,f,h,l,d,p,v,m=0,y=.1,g=0,b=.1,_=i[0],w=i[1],x=i[2];u=n[0];c=n[1];f=n[2];p=r[0];v=r[0]*r[1];for(d=0;d<f;d++){a[2]=d;for(l=0;l<c;l++){a[1]=l;for(h=0;h<u;h++){a[0]=h;y=t[m];b=y-o;g+=b*b,s[a[_]+a[w]*p+a[x]*v]=y;m+=1}}}g/=u*c*f;g=Math.sqrt(g);return{data:s,sigma:g}}function s(t,e,r,n,i,o){var s=new Float32Array(r[0]*r[1]*r[2]),a=[0,0,0],u,c,f,h,l,d,p,v,m=0,y=.1,g=0,b=.1,_=i[0],w=i[1],x=i[2];u=n[0];c=n[1];f=n[2];p=r[0];v=r[0]*r[1];for(d=0;d<f;d++){a[2]=d;for(l=0;l<c;l++){a[1]=l;for(h=0;h<u;h++){a[0]=h;y=t.getFloat32(m,e);b=y-o;g+=b*b,s[a[_]+a[w]*p+a[x]*v]=y;m+=4}}}g/=u*c*f;g=Math.sqrt(g);return{data:s,sigma:g}}})(i||(i={}))})(r=e.CCP4||(e.CCP4={}))})(e=t.Density||(t.Density={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){var e;(function(e){var r;(function(r){function n(e){if(e.getCategory("_density_info"))return i.parseLegacy(e);else if(e.getCategory("_volume_data_3d_info"))return i.parse(e);return t.ParserResult.error("Invalid data format.")}r.parse=n;var i;(function(r){function n(r){var n=r.getCategory("_volume_data_3d_info");if(!n)return t.ParserResult.error("_volume_data_3d_info category is missing.");if(!r.getCategory("_volume_data_3d"))return t.ParserResult.error("_volume_data_3d category is missing.");function i(t){var e=[0,0,0];for(var r=0;r<3;r++){e[r]=n.getColumn(t+"["+r+"]").getFloat(0)}return e}function s(t){return n.getColumn(t).getFloat(0)}var a={name:n.getColumn("name").getString(0),axisOrder:i("axis_order"),origin:i("origin"),dimensions:i("dimensions"),sampleCount:i("sample_count"),spacegroupNumber:s("spacegroup_number")|0,cellSize:i("spacegroup_cell_size"),cellAngles:i("spacegroup_cell_angles"),mean:s("mean_sampled"),sigma:s("sigma_sampled")};var u=[0,0,0];u[a.axisOrder[0]]=0;u[a.axisOrder[1]]=1;u[a.axisOrder[2]]=2;function c(t){return[t[u[0]],t[u[1]],t[u[2]]]}var f=c(a.sampleCount);var h=o(r.getCategory("_volume_data_3d").getColumn("values"),f,a.sampleCount,u);var l=new e.Field3DZYX(h.data,f);var d={name:a.name,spacegroup:e.createSpacegroup(a.spacegroupNumber,a.cellSize,a.cellAngles),box:{origin:c(a.origin),dimensions:c(a.dimensions),sampleCount:f},data:l,valuesInfo:{min:h.min,max:h.max,mean:a.mean,sigma:a.sigma}};return t.ParserResult.success(d)}r.parse=n;function i(r){var n=r.getCategory("_density_info");if(!n)return t.ParserResult.error("_density_info category is missing.");if(!r.getCategory("_density_data"))return t.ParserResult.error("_density_data category is missing.");function i(t){var e=[];for(var r=0;r<3;r++){e[r]=n.getColumn(t+"["+r+"]").getFloat(0)}return e}function s(t){return n.getColumn(t).getFloat(0)}var a={name:n.getColumn("name").getString(0),grid:i("grid"),axisOrder:i("axis_order"),extent:i("extent"),origin:i("origin"),cellSize:i("cell_size"),cellAngles:i("cell_angles"),mean:s("mean"),sigma:s("sigma"),spacegroupNumber:s("spacegroup_number")|0};var u=[0,0,0];u[a.axisOrder[0]]=0;u[a.axisOrder[1]]=1;u[a.axisOrder[2]]=2;var c=[a.origin[u[0]],a.origin[u[1]],a.origin[u[2]]];var f=[a.extent[u[0]],a.extent[u[1]],a.extent[u[2]]];var h=o(r.getCategory("_density_data").getColumn("values"),f,a.extent,u);var l=new e.Field3DZYX(h.data,f);var d={name:a.name,spacegroup:e.createSpacegroup(a.spacegroupNumber,a.cellSize,a.cellAngles),box:{origin:[c[0]/a.grid[0],c[1]/a.grid[1],c[2]/a.grid[2]],dimensions:[f[0]/a.grid[0],f[1]/a.grid[1],f[2]/a.grid[2]],sampleCount:f},data:l,valuesInfo:{min:h.min,max:h.max,mean:a.mean,sigma:a.sigma}};return t.ParserResult.success(d)}r.parseLegacy=i;function o(t,e,r,n){var i=new Float32Array(e[0]*e[1]*e[2]);var o=[0,0,0];var s=n[0],a=n[1],u=n[2];var c=r[0],f=r[1],h=r[2];var l=e[0];var d=e[0]*e[1];var p=0;var v=t.getFloat(0),m=v;for(var y=0;y<h;y++){o[2]=y;for(var g=0;g<f;g++){o[1]=g;for(var b=0;b<c;b++){o[0]=b;var _=t.getFloat(p);p+=1;i[o[s]+o[a]*l+o[u]*d]=_;if(_<v)v=_;else if(_>m)m=_}}}return{data:i,min:v,max:m}}})(i||(i={}))})(r=e.CIF||(e.CIF={}))})(e=t.Density||(t.Density={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(e){function r(e,r,n){var i=this;return t.computation(function(t){return a(i,void 0,void 0,function(){return u(this,function(i){switch(i.label){case 0:return[4,t.updateProgress("Parsing "+r+"...")];case 1:i.sent();return[2,n(e)]}})})})}var n;(function(t){t.CCP4={name:"CCP4",shortcuts:["ccp4","map"],extensions:[".ccp4",".map"],isBinary:true,parse:function(t){return r(t,"CCP4",function(t){return e.CCP4.parse(t)})}};t.All=[t.CCP4]})(n=e.SupportedFormats||(e.SupportedFormats={}))})(r=e.Density||(e.Density={}))})(e=t.Formats||(t.Formats={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){var e;(function(t){/*
                 * This code has been modified from https://github.com/toji/gl-matrix/,
                 * copyright (c) 2015, Brandon Jones, Colin MacKenzie IV.
                 *
                 * Permission is hereby granted, free of charge, to any person obtaining a copy
                 * of this software and associated documentation files (the "Software"), to deal
                 * in the Software without restriction, including without limitation the rights
                 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
                 * copies of the Software, and to permit persons to whom the Software is
                 * furnished to do so, subject to the following conditions:
                 */
var e=typeof Float64Array!=="undefined"?function(t){return new Float64Array(t)}:function(t){return[]};var r;(function(t){function r(){return e(16)}t.empty=r;function n(){var t=e(16);t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=1;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=1;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return t}t.identity=n;function i(t){var r=e(16),n,i,o;for(n=0;n<4;n++){o=t[n];for(i=0;i<4;i++){r[4*i+n]=o[i]}}return r}t.ofRows=i;function o(t,e,r){for(var n=0;n<16;n++){if(Math.abs(t[n]-e[n])>r){return false}}return true}t.areEqual=o;function s(t,e,r,n){t[4*r+e]=n}t.setValue=s;function a(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}t.copy=a;function u(e){return t.copy(t.empty(),e)}t.clone=u;function c(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],f=e[8],h=e[9],l=e[10],d=e[11],p=e[12],v=e[13],m=e[14],y=e[15],g=r*a-n*s,b=r*u-i*s,_=r*c-o*s,w=n*u-i*a,x=n*c-o*a,C=i*c-o*u,I=f*v-h*p,S=f*m-l*p,A=f*y-d*p,k=h*m-l*v,E=h*y-d*v,P=l*y-d*m,T=g*P-b*E+_*k+w*A-x*S+C*I;if(!T){return null}T=1/T;t[0]=(a*P-u*E+c*k)*T;t[1]=(i*E-n*P-o*k)*T;t[2]=(v*C-m*x+y*w)*T;t[3]=(l*x-h*C-d*w)*T;t[4]=(u*A-s*P-c*S)*T;t[5]=(r*P-i*A+o*S)*T;t[6]=(m*_-p*C-y*b)*T;t[7]=(f*C-l*_+d*b)*T;t[8]=(s*E-a*A+c*I)*T;t[9]=(n*A-r*E-o*I)*T;t[10]=(p*x-v*_+y*g)*T;t[11]=(h*_-f*x-d*g)*T;t[12]=(a*S-s*k-u*I)*T;t[13]=(r*k-n*S+i*I)*T;t[14]=(v*b-p*w-m*g)*T;t[15]=(f*w-h*b+l*g)*T;return t}t.invert=c;function f(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=e[6],f=e[7],h=e[8],l=e[9],d=e[10],p=e[11],v=e[12],m=e[13],y=e[14],g=e[15];var b=r[0],_=r[1],w=r[2],x=r[3];t[0]=b*n+_*a+w*h+x*v;t[1]=b*i+_*u+w*l+x*m;t[2]=b*o+_*c+w*d+x*y;t[3]=b*s+_*f+w*p+x*g;b=r[4];_=r[5];w=r[6];x=r[7];t[4]=b*n+_*a+w*h+x*v;t[5]=b*i+_*u+w*l+x*m;t[6]=b*o+_*c+w*d+x*y;t[7]=b*s+_*f+w*p+x*g;b=r[8];_=r[9];w=r[10];x=r[11];t[8]=b*n+_*a+w*h+x*v;t[9]=b*i+_*u+w*l+x*m;t[10]=b*o+_*c+w*d+x*y;t[11]=b*s+_*f+w*p+x*g;b=r[12];_=r[13];w=r[14];x=r[15];t[12]=b*n+_*a+w*h+x*v;t[13]=b*i+_*u+w*l+x*m;t[14]=b*o+_*c+w*d+x*y;t[15]=b*s+_*f+w*p+x*g;return t}t.mul=f;function h(t,e,r){var n=r[0],i=r[1],o=r[2],s,a,u,c,f,h,l,d,p,v,m,y;if(e===t){t[12]=e[0]*n+e[4]*i+e[8]*o+e[12];t[13]=e[1]*n+e[5]*i+e[9]*o+e[13];t[14]=e[2]*n+e[6]*i+e[10]*o+e[14];t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]}else{s=e[0];a=e[1];u=e[2];c=e[3];f=e[4];h=e[5];l=e[6];d=e[7];p=e[8];v=e[9];m=e[10];y=e[11];t[0]=s;t[1]=a;t[2]=u;t[3]=c;t[4]=f;t[5]=h;t[6]=l;t[7]=d;t[8]=p;t[9]=v;t[10]=m;t[11]=y;t[12]=s*n+f*i+p*o+e[12];t[13]=a*n+h*i+v*o+e[13];t[14]=u*n+l*i+m*o+e[14];t[15]=c*n+d*i+y*o+e[15]}return t}t.translate=h;function l(t,e){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=1;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=1;t[11]=0;t[12]=e[0];t[13]=e[1];t[14]=e[2];t[15]=1;return t}t.fromTranslation=l;function d(t,e,r){var n=e.x,i=e.y,o=e.z;t.x=r[0]*n+r[4]*i+r[8]*o+r[12];t.y=r[1]*n+r[5]*i+r[9]*o+r[13];t.z=r[2]*n+r[6]*i+r[10]*o+r[14];return t}t.transformVector3=d;function p(t){var e="";for(var r=0;r<4;r++){for(var n=0;n<4;n++){e+=t[4*n+r].toString();if(n<3)e+=" "}if(r<3)e+="\n"}return e}t.makeTable=p;function v(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],c=t[8],f=t[9],h=t[10],l=t[11],d=t[12],p=t[13],v=t[14],m=t[15],y=e*s-r*o,g=e*a-n*o,b=e*u-i*o,_=r*a-n*s,w=r*u-i*s,x=n*u-i*a,C=c*p-f*d,I=c*v-h*d,S=c*m-l*d,A=f*v-h*p,k=f*m-l*p,E=h*m-l*v;return y*E-g*k+b*A+_*S-w*I+x*C}t.determinant=v})(r=t.Matrix4||(t.Matrix4={}));var n;(function(t){function r(){var t=e(4);t[0]=0;t[1]=0;t[2]=0;t[3]=0;return t}t.create=r;function n(t){var r=e(4);r[0]=t[0];r[1]=t[1];r[2]=t[2];r[3]=t[3];return r}t.clone=n;function i(t,r,n,i){var o=e(4);o[0]=t;o[1]=r;o[2]=n;o[3]=i;return o}t.fromValues=i;function o(t,e,r,n,i){t[0]=e;t[1]=r;t[2]=n;t[3]=i;return t}t.set=o;function s(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+o*o)}t.distance=s;function a(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o}t.squaredDistance=a;function u(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)}t.norm=u;function c(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}t.squaredNorm=c;function f(t,e,r){var n=e[0],i=e[1],o=e[2],s=e[3];t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s;t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s;t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s;t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s;return t}t.transform=f})(n=t.Vector4||(t.Vector4={}))})(e=t.LinearAlgebra||(t.LinearAlgebra={}))})(e=t.Geometry||(t.Geometry={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){var e;(function(t){function e(t){var e=t.capacity*2+1,r=new Int32Array(e),n;if(t.count<32){for(n=0;n<t.count;n++){r[n]=t.indices[n]}}else{r.set(t.indices)}t.indices=r;t.capacity=e}function r(t,r){if(this.count+1>=this.capacity){e(this)}this.indices[this.count++]=r}function n(){this.count=0}function i(t){if(t<1)t=1;return{indices:new Int32Array(t),count:0,capacity:t,hasPriorities:false,priorities:void 0,add:r,reset:n}}t.create=i})(e=t.SubdivisionTree3DResultIndexBuffer||(t.SubdivisionTree3DResultIndexBuffer={}));var r;(function(t){function e(t){var e=t.capacity*2+1,r=new Int32Array(e),n=new Float32Array(e),i;if(t.count<32){for(i=0;i<t.count;i++){r[i]=t.indices[i];n[i]=t.priorities[i]}}else{r.set(t.indices);n.set(t.priorities)}t.indices=r;t.priorities=n;t.capacity=e}function r(t,r){if(this.count+1>=this.capacity)e(this);this.priorities[this.count]=t;this.indices[this.count++]=r}function n(){this.count=0}function i(t){if(t<1)t=1;return{indices:new Int32Array(t),count:0,capacity:t,hasPriorities:true,priorities:new Float32Array(t),add:r,reset:n}}t.create=i})(r=t.SubdivisionTree3DResultPriorityBuffer||(t.SubdivisionTree3DResultPriorityBuffer={}));var n;(function(t){function e(t,e,r,n){this.pivot[0]=t;this.pivot[1]=e;this.pivot[2]=r;this.radius=n;this.radiusSq=n*n;this.buffer.reset();s.nearest(this.tree.root,this,0)}function r(t,r){return{tree:t,indices:t.indices,positions:t.positions,buffer:r,pivot:[.1,.1,.1],radius:1.1,radiusSq:1.1*1.1,nearest:e}}t.create=r})(n=t.SubdivisionTree3DQueryContext||(t.SubdivisionTree3DQueryContext={}));var i;(function(t){function i(t,i,o){if(o===void 0){o=false}return n.create(t,o?r.create(Math.max(i*i|0,8)):e.create(Math.max(i*i|0,8)))}t.createContextRadius=i;function o(t,e,r){if(r===void 0){r=32}var n=u.build(t,e,r),i=n.root,o=n.indices,s=n.positions;return{data:t,root:i,indices:o,positions:s}}t.create=o})(i=t.SubdivisionTree3D||(t.SubdivisionTree3D={}));var o;(function(t){function e(t,e,r,n){t.data[t._count++]=e;t.data[t._count++]=r;t.data[t._count++]=n;t.boundsMin[0]=Math.min(e,t.boundsMin[0]);t.boundsMin[1]=Math.min(r,t.boundsMin[1]);t.boundsMin[2]=Math.min(n,t.boundsMin[2]);t.boundsMax[0]=Math.max(e,t.boundsMax[0]);t.boundsMax[1]=Math.max(r,t.boundsMax[1]);t.boundsMax[2]=Math.max(n,t.boundsMax[2])}t.add=e;function r(t){var e=new Float32Array(t*3|0);var r=a.createInfinite();var n=r.min;var i=r.max;return{_count:0,data:e,bounds:r,boundsMin:n,boundsMax:i}}t.create=r})(o||(o={}));var s;(function(t){function e(t,e){var r=e.pivot,n=e.indices,i=e.positions,o=e.radiusSq,s,a,u,c,f,h;for(h=t.startIndex;h<t.endIndex;h++){c=3*n[h];s=r[0]-i[c];a=r[1]-i[c+1];u=r[2]-i[c+2];f=s*s+a*a+u*u;if(f<=o)e.buffer.add(f,n[h])}}function r(t,e,r){var i=e.pivot[r],o=i<t.splitValue;if(o?i+e.radius>t.splitValue:i-e.radius<t.splitValue){n(t.left,e,(r+1)%3);n(t.right,e,(r+1)%3)}else if(o){n(t.left,e,(r+1)%3)}else{n(t.right,e,(r+1)%3)}}function n(t,n,i){if(t.startIndex===t.endIndex)return;if(isNaN(t.splitValue))e(t,n);else r(t,n,i)}t.nearest=n;function i(t,e,r,n,i){return{splitValue:t,startIndex:e,endIndex:r,left:n,right:i}}t.create=i})(s=t.SubdivisionTree3DNode||(t.SubdivisionTree3DNode={}));var a;(function(t){function e(){return{min:[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],max:[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]}}t.createInfinite=e})(a=t.Box3D||(t.Box3D={}));var u;(function(t){function e(t,r,n,i){var o=n-r+1;if(o<=0){return t.emptyNode}else if(o<=t.leafSize){return s.create(NaN,r,n+1,t.emptyNode,t.emptyNode)}var a=t.bounds.min[i],u=t.bounds.max[i],c=.5*(a+u),f=0,h=r,l=n,d,p,v;while(h<l){d=t.indices[l];t.indices[l]=t.indices[h];t.indices[h]=d;while(h<=n&&t.positions[3*t.indices[h]+i]<=c)h++;while(l>=r&&t.positions[3*t.indices[l]+i]>c)l--}f=h-1;t.bounds.max[i]=c;p=e(t,r,f,(i+1)%3);t.bounds.max[i]=u;t.bounds.min[i]=c;v=e(t,f+1,n,(i+1)%3);t.bounds.min[i]=a;return s.create(c,r,n+1,p,v)}function r(t){var e=o.add;return function(r,n,i){e(t,r,n,i)}}function n(t,n,i){var a=o.create(t.length),u=new Int32Array(t.length);var c=r(a);for(var f=0;f<t.length;f++){u[f]=f;n(t[f],c)}c=void 0;var h={bounds:a.bounds,positions:a.data,leafSize:i,indices:u,emptyNode:s.create(NaN,-1,-1,void 0,void 0)};var l=e(h,0,u.length-1,0);h=void 0;return{root:l,indices:u,positions:a.data}}t.build=n})(u||(u={}))})(e=t.Geometry||(t.Geometry={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){"use strict";var r;(function(r){function n(t){if(t.normals)return;var e=new Float32Array(t.vertices.length),r=t.vertices,n=t.triangleIndices;for(var i=0;i<n.length;i+=3){var o=3*n[i],s=3*n[i+1],a=3*n[i+2];var u=r[o+2]*(r[s+1]-r[a+1])+r[s+2]*r[a+1]-r[s+1]*r[a+2]+r[o+1]*(-r[s+2]+r[a+2]),c=-(r[s+2]*r[a])+r[o+2]*(-r[s]+r[a])+r[o]*(r[s+2]-r[a+2])+r[s]*r[a+2],f=r[o+1]*(r[s]-r[a])+r[s+1]*r[a]-r[s]*r[a+1]+r[o]*(-r[s+1]+r[s+1]);e[o]+=u;e[o+1]+=c;e[o+2]+=f;e[s]+=u;e[s+1]+=c;e[s+2]+=f;e[a]+=u;e[a+1]+=c;e[a+2]+=f}for(var i=0;i<e.length;i+=3){var u=e[i];var c=e[i+1];var f=e[i+2];var h=1/Math.sqrt(u*u+c*c+f*f);e[i]*=h;e[i+1]*=h;e[i+2]*=h}t.normals=e}r.computeNormalsImmediate=n;function i(e){var r=this;return t.computation(function(t){return a(r,void 0,void 0,function(){return u(this,function(r){switch(r.label){case 0:if(e.normals){return[2,e]};return[4,t.updateProgress("Computing normals...")];case 1:r.sent();n(e);return[2,e]}})})})}r.computeNormals=i;function o(t,e,r,n){r[3*n]+=t[3*e];r[3*n+1]+=t[3*e+1];r[3*n+2]+=t[3*e+2]}function s(t,e,r,n){var i=t.triangleIndices.length,s=t.vertices;var a=t.triangleIndices;for(var u=0;u<i;u+=3){var c=a[u],f=a[u+1],h=a[u+2];o(s,f,r,c);o(s,h,r,c);o(s,c,r,f);o(s,h,r,f);o(s,c,r,h);o(s,f,r,h)}var l=2*n;for(var u=0,d=t.vertexCount;u<d;u++){var p=e[u]+l;r[3*u]=(r[3*u]+l*s[3*u])/p;r[3*u+1]=(r[3*u+1]+l*s[3*u+1])/p;r[3*u+2]=(r[3*u+2]+l*s[3*u+2])/p}}function c(e,r,n,i){return a(this,void 0,void 0,function(){var o,a,c,f,h,l,f,d,p,v,m;return u(this,function(u){switch(u.label){case 0:return[4,e.updateProgress("Smoothing surface...",true)];case 1:u.sent();o=new Int32Array(r.vertexCount),a=r.triangleIndices.length;c=r.triangleIndices;for(f=0;f<a;f++){o[c[f]]+=2}h=new Float32Array(r.vertices.length);l=t.Utils.PerformanceMonitor.currentTime();return[4,e.updateProgress("Smoothing surface...",true)];case 2:u.sent();f=0;u.label=3;case 3:if(!(f<n))return[3,6];if(f>0){for(d=0,p=h.length;d<p;d++)h[d]=0}r.normals=void 0;s(r,o,h,i);v=r.vertices;r.vertices=h;h=v;m=t.Utils.PerformanceMonitor.currentTime();if(!(m-l>t.Computation.UpdateProgressDelta))return[3,5];l=m;return[4,e.updateProgress("Smoothing surface...",true,f+1,n)];case 4:u.sent();u.label=5;case 5:f++;return[3,3];case 6:return[2,r]}})})}function f(e,r,n){var i=this;if(r===void 0){r=1}if(n===void 0){n=1}if(r<1)r=0;if(r===0)return t.Computation.resolve(e);return t.computation(function(t){return a(i,void 0,void 0,function(){return u(this,function(i){switch(i.label){case 0:return[4,c(t,e,r,1.1*n/1.1)];case 1:return[2,i.sent()]}})})})}r.laplacianSmooth=f;function h(e){var r=this;return t.computation(function(t){return a(r,void 0,void 0,function(){var r,n,i,o,s,a,c,s,a,f,h,l;return u(this,function(u){switch(u.label){case 0:if(e.boundingSphere){return[2,e]}return[4,t.updateProgress("Computing bounding sphere...")];case 1:u.sent();r=e.vertices;n=0,i=0,o=0;for(s=0,a=e.vertices.length;s<a;s+=3){n+=r[s];i+=r[s+1];o+=r[s+2]}n/=e.vertexCount;i/=e.vertexCount;o/=e.vertexCount;c=0;for(s=0,a=r.length;s<a;s+=3){f=n-r[s];h=i-r[s+1];l=o-r[s+2];c=Math.max(c,f*f+h*h+l*l)}e.boundingSphere={center:{x:n,y:i,z:o},radius:Math.sqrt(c)};return[2,e]}})})})}r.computeBoundingSphere=h;function l(t,r){var n={x:.1,y:.1,z:.1};var i=e.LinearAlgebra.Matrix4.transformVector3;var o=t.vertices;for(var s=0,a=t.vertices.length;s<a;s+=3){n.x=o[s];n.y=o[s+1];n.z=o[s+2];i(n,n,r);o[s]=n.x;o[s+1]=n.y;o[s+2]=n.z}t.normals=void 0;t.boundingSphere=void 0}r.transformImmediate=l;function d(e,r){var n=this;return t.computation(function(t){return a(n,void 0,void 0,function(){return u(this,function(n){t.updateProgress("Updating surface...");l(e,r);return[2,e]})})})}r.transform=d})(r=e.Surface||(e.Surface={}))})(e=t.Geometry||(t.Geometry={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(e){"use strict";function r(e){var r=this;return t.computation(function(t){return a(r,void 0,void 0,function(){var r;return u(this,function(i){switch(i.label){case 0:r=new n(e,t);return[4,r.run()];case 1:return[2,i.sent()]}})})})}e.compute=r;var n=function(){function e(e,r){this.ctx=r;this.minX=0;this.minY=0;this.minZ=0;this.maxX=0;this.maxY=0;this.maxZ=0;var n=t.Utils.extend({},e);if(!n.bottomLeft)n.bottomLeft=[0,0,0];if(!n.topRight)n.topRight=n.scalarField.dimensions;this.state=new i(n),this.minX=n.bottomLeft[0];this.minY=n.bottomLeft[1];this.minZ=n.bottomLeft[2];this.maxX=n.topRight[0]-1;this.maxY=n.topRight[1]-1;this.maxZ=n.topRight[2]-1;this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ);this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}e.prototype.doSlices=function(){return a(this,void 0,void 0,function(){var e,r,n,i;return u(this,function(o){switch(o.label){case 0:e=0;r=t.Utils.PerformanceMonitor.currentTime();n=this.minZ;o.label=1;case 1:if(!(n<this.maxZ))return[3,4];this.slice(n);e+=this.sliceSize;i=t.Utils.PerformanceMonitor.currentTime();if(!(i-r>t.Computation.UpdateProgressDelta))return[3,3];return[4,this.ctx.updateProgress("Computing surface...",true,e,this.size)];case 2:o.sent();r=i;o.label=3;case 3:n++;return[3,1];case 4:return[2]}})})};e.prototype.slice=function(t){for(var e=this.minY;e<this.maxY;e++){for(var r=this.minX;r<this.maxX;r++){this.state.processCell(r,e,t)}}this.state.clearEdgeVertexIndexSlice(t)};e.prototype.finish=function(){var e=t.Utils.ChunkedArray.compact(this.state.vertexBuffer);var r=t.Utils.ChunkedArray.compact(this.state.triangleBuffer);this.state.vertexBuffer=void 0;this.state.verticesOnEdges=void 0;var n={vertexCount:e.length/3|0,triangleCount:r.length/3|0,vertices:e,triangleIndices:r,annotation:this.state.annotate?t.Utils.ChunkedArray.compact(this.state.annotationBuffer):void 0};return n};e.prototype.run=function(){return a(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this.ctx.updateProgress("Computing surface...",true,0,this.size)];case 1:t.sent();return[4,this.doSlices()];case 2:t.sent();return[4,this.ctx.updateProgress("Finalizing...")];case 3:t.sent();return[2,this.finish()]}})})};return e}();var i=function(){function r(e){this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0];this.i=0;this.j=0;this.k=0;this.nX=e.scalarField.dimensions[0];this.nY=e.scalarField.dimensions[1];this.nZ=e.scalarField.dimensions[2];this.isoLevel=e.isoLevel;this.scalarField=e.scalarField;this.annotationField=e.annotationField;var r=e.topRight[0]-e.bottomLeft[0],n=e.topRight[1]-e.bottomLeft[1],i=e.topRight[2]-e.bottomLeft[2],o=Math.min(262144,Math.max(r*n*i/16,1024)|0),s=Math.min(1<<16,o*4);this.vertexBuffer=t.Utils.ChunkedArray.forVertex3D(o);this.triangleBuffer=t.Utils.ChunkedArray.create(function(t){return new Uint32Array(t)},s,3);this.annotate=!!e.annotationField;if(this.annotate)this.annotationBuffer=t.Utils.ChunkedArray.forInt32(o);this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}r.prototype.get3dOffsetFromEdgeInfo=function(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i};r.prototype.clearEdgeVertexIndexSlice=function(t){var e=t%2===0?0:3*this.nX*this.nY;var r=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;for(var n=e;n<r;n++)this.verticesOnEdges[n]=0};r.prototype.interpolate=function(r){var n=e.EdgeIdInfo[r],i=3*this.get3dOffsetFromEdgeInfo(n)+n.e;var o=this.verticesOnEdges[i];if(o>0)return o-1|0;var s=e.CubeEdges[r];var a=s.a,u=s.b;var c=a.i+this.i,f=a.j+this.j,h=a.k+this.k;var l=u.i+this.i,d=u.j+this.j,p=u.k+this.k;var v=this.scalarField.get(c,f,h),m=this.scalarField.get(l,d,p);var y=(this.isoLevel-v)/(v-m);var g=t.Utils.ChunkedArray.add3(this.vertexBuffer,c+y*(c-l),f+y*(f-d),h+y*(h-p))|0;this.verticesOnEdges[i]=g+1;if(this.annotate){var b=y<.5?this.annotationField.get(c,f,h):this.annotationField.get(l,d,p);if(b<0)b=y<.5?this.annotationField.get(l,d,p):this.annotationField.get(c,f,h);t.Utils.ChunkedArray.add(this.annotationBuffer,b)}return g};r.prototype.processCell=function(r,n,i){var o=0;if(this.scalarField.get(r,n,i)<this.isoLevel)o|=1;if(this.scalarField.get(r+1,n,i)<this.isoLevel)o|=2;if(this.scalarField.get(r+1,n+1,i)<this.isoLevel)o|=4;if(this.scalarField.get(r,n+1,i)<this.isoLevel)o|=8;if(this.scalarField.get(r,n,i+1)<this.isoLevel)o|=16;if(this.scalarField.get(r+1,n,i+1)<this.isoLevel)o|=32;if(this.scalarField.get(r+1,n+1,i+1)<this.isoLevel)o|=64;if(this.scalarField.get(r,n+1,i+1)<this.isoLevel)o|=128;if(o===0||o===255)return;this.i=r;this.j=n;this.k=i;var s=e.EdgeTable[o];if((s&1)>0)this.vertList[0]=this.interpolate(0);if((s&2)>0)this.vertList[1]=this.interpolate(1);if((s&4)>0)this.vertList[2]=this.interpolate(2);if((s&8)>0)this.vertList[3]=this.interpolate(3);if((s&16)>0)this.vertList[4]=this.interpolate(4);if((s&32)>0)this.vertList[5]=this.interpolate(5);if((s&64)>0)this.vertList[6]=this.interpolate(6);if((s&128)>0)this.vertList[7]=this.interpolate(7);if((s&256)>0)this.vertList[8]=this.interpolate(8);if((s&512)>0)this.vertList[9]=this.interpolate(9);if((s&1024)>0)this.vertList[10]=this.interpolate(10);if((s&2048)>0)this.vertList[11]=this.interpolate(11);var a=e.TriTable[o];for(var u=0;u<a.length;u+=3){t.Utils.ChunkedArray.add3(this.triangleBuffer,this.vertList[a[u]],this.vertList[a[u+1]],this.vertList[a[u+2]])}};return r}()})(r=e.MarchingCubes||(e.MarchingCubes={}))})(e=t.Geometry||(t.Geometry={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(t){var e;(function(t){var e=function(){function t(t,e,r){this.i=t|0;this.j=e|0;this.k=r|0}return t}();t.Index=e;var r=function(){function t(t,e){this.a=t;this.b=e}return t}();t.IndexPair=r;t.EdgesXY=[[],[0,3],[0,1],[1,3],[1,2],[0,1,1,2,2,3,0,3],[0,2],[2,3],[2,3],[0,2],[0,1,1,2,2,3,0,3],[1,2],[1,3],[0,1],[0,3],[]];t.EdgesXZ=[[],[0,8],[0,9],[9,8],[9,4],[0,9,9,4,4,8,0,8],[0,4],[4,8],[4,8],[0,4],[0,9,9,4,4,8,0,8],[9,4],[9,8],[0,9],[0,8],[]];t.EdgesYZ=[[],[3,8],[3,11],[11,8],[11,7],[3,11,11,7,7,8,3,8],[3,7],[7,8],[7,8],[3,7],[3,11,11,7,7,8,3,8],[11,7],[11,8],[3,11],[3,8],[]];t.CubeVertices=[new e(0,0,0),new e(1,0,0),new e(1,1,0),new e(0,1,0),new e(0,0,1),new e(1,0,1),new e(1,1,1),new e(0,1,1)];t.CubeEdges=[new r(t.CubeVertices[0],t.CubeVertices[1]),new r(t.CubeVertices[1],t.CubeVertices[2]),new r(t.CubeVertices[2],t.CubeVertices[3]),new r(t.CubeVertices[3],t.CubeVertices[0]),new r(t.CubeVertices[4],t.CubeVertices[5]),new r(t.CubeVertices[5],t.CubeVertices[6]),new r(t.CubeVertices[6],t.CubeVertices[7]),new r(t.CubeVertices[7],t.CubeVertices[4]),new r(t.CubeVertices[0],t.CubeVertices[4]),new r(t.CubeVertices[1],t.CubeVertices[5]),new r(t.CubeVertices[2],t.CubeVertices[6]),new r(t.CubeVertices[3],t.CubeVertices[7])];t.EdgeIdInfo=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}];t.EdgeTable=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0];t.TriTable=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]]})(e=t.MarchingCubes||(t.MarchingCubes={}))})(e=t.Geometry||(t.Geometry={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(r){"use strict";var n=function(){function e(e){t.Utils.extend(this,e,{exactBoundary:false,boundaryDelta:{dx:1.5,dy:1.5,dz:1.5},probeRadius:1.4,atomRadii:function(){return 1},density:1.1,interactive:false,smoothingIterations:1});if(this.exactBoundary)this.boundaryDelta={dx:0,dy:0,dz:0};if(this.density<.05)this.density=.05}return e}();var i=function(){function r(t,e){this.inputParameters=t;this.ctx=e;this.minX=Number.MAX_VALUE;this.minY=Number.MAX_VALUE;this.minZ=Number.MAX_VALUE;this.maxX=-Number.MAX_VALUE;this.maxY=-Number.MAX_VALUE;this.maxZ=-Number.MAX_VALUE;this.nX=0;this.nY=0;this.nZ=0;this.dX=.1;this.dY=.1;this.dZ=.1;this.field=new Float32Array(0);this.distanceField=new Float32Array(0);this.proximityMap=new Int32Array(0);this.minIndex={i:0,j:0,k:0};this.maxIndex={i:0,j:0,k:0};this.parameters=new n(t.parameters);var r=t.positions;this.x=r.x;this.y=r.y;this.z=r.z;this.atomIndices=t.atomIndices;if(this.parameters.density>=.99){this.vdwScaleFactor=1.000000001}else{this.vdwScaleFactor=1+(1-this.parameters.density*this.parameters.density)}}r.prototype.findBounds=function(){for(var t=0,e=this.atomIndices;t<e.length;t++){var r=e[t];var n=this.parameters.exactBoundary?0:this.vdwScaleFactor*this.parameters.atomRadius(r)+this.parameters.probeRadius,i=this.x[r],o=this.y[r],s=this.z[r];if(n<0)continue;this.minX=Math.min(this.minX,i-n);this.minY=Math.min(this.minY,o-n);this.minZ=Math.min(this.minZ,s-n);this.maxX=Math.max(this.maxX,i+n);this.maxY=Math.max(this.maxY,o+n);this.maxZ=Math.max(this.maxZ,s+n)}if(this.minX===Number.MAX_VALUE){this.minX=this.minY=this.minZ=-1;this.maxX=this.maxY=this.maxZ=1}this.minX-=this.parameters.boundaryDelta.dx;this.minY-=this.parameters.boundaryDelta.dy;this.minZ-=this.parameters.boundaryDelta.dz;this.maxX+=this.parameters.boundaryDelta.dx;this.maxY+=this.parameters.boundaryDelta.dy;this.maxZ+=this.parameters.boundaryDelta.dz;this.nX=Math.floor((this.maxX-this.minX)*this.parameters.density);this.nY=Math.floor((this.maxY-this.minY)*this.parameters.density);this.nZ=Math.floor((this.maxZ-this.minZ)*this.parameters.density);this.nX=Math.min(this.nX,333);this.nY=Math.min(this.nY,333);this.nZ=Math.min(this.nZ,333);this.dX=(this.maxX-this.minX)/(this.nX-1);this.dY=(this.maxY-this.minY)/(this.nY-1);this.dZ=(this.maxZ-this.minZ)/(this.nZ-1)};r.prototype.initData=function(){var t=this.nX*this.nY*this.nZ;this.field=new Float32Array(t);this.distanceField=new Float32Array(t);this.proximityMap=new Int32Array(t);var e=Number.POSITIVE_INFINITY;for(var r=0,n=this.proximityMap.length;r<n;r++){this.distanceField[r]=e;this.proximityMap[r]=-1}};r.prototype.updateMinIndex=function(t,e,r){this.minIndex.i=Math.max(Math.floor((t-this.minX)/this.dX)|0,0);this.minIndex.j=Math.max(Math.floor((e-this.minY)/this.dY)|0,0);this.minIndex.k=Math.max(Math.floor((r-this.minZ)/this.dZ)|0,0)};r.prototype.updateMaxIndex=function(t,e,r){this.maxIndex.i=Math.min(Math.ceil((t-this.minX)/this.dX)|0,this.nX);this.maxIndex.j=Math.min(Math.ceil((e-this.minY)/this.dY)|0,this.nY);this.maxIndex.k=Math.min(Math.ceil((r-this.minZ)/this.dZ)|0,this.nZ)};r.prototype.addBall=function(t,e){var r=e*e;var n=this.x[t],i=this.y[t],o=this.z[t];this.updateMinIndex(n-e,i-e,o-e);this.updateMaxIndex(n+e,i+e,o+e);var s=this.minIndex.i,a=this.minIndex.j,u=this.minIndex.k;var c=this.maxIndex.i,f=this.maxIndex.j,h=this.maxIndex.k;n=this.minX-n;i=this.minY-i;o=this.minZ-o;for(var l=u;l<h;l++){var d=o+l*this.dZ,p=d*d,v=l*this.nY;for(var m=a;m<f;m++){var y=i+m*this.dY,g=p+y*y,b=this.nX*(v+m);for(var _=s;_<c;_++){var w=n+_*this.dX,x=g+w*w,C=b+_;var I=r/(1e-6+x)-1;if(x<this.distanceField[C]){this.proximityMap[C]=t;this.distanceField[C]=x}if(I>0){this.field[C]+=I}}}}};r.prototype.processChunks=function(){return a(this,void 0,void 0,function(){var e,r,n,i,o,s,a;return u(this,function(u){switch(u.label){case 0:e=1e4;r=t.Utils.PerformanceMonitor.currentTime();return[4,this.ctx.updateProgress("Creating field...",true)];case 1:u.sent();n=0,i=this.atomIndices.length;u.label=2;case 2:if(!(n<i))return[3,5];o=this.atomIndices[n];s=this.vdwScaleFactor*this.parameters.atomRadius(o)+this.parameters.probeRadius;if(s>=0){this.addBall(o,s)}if(!((n+1)%e===0))return[3,4];a=t.Utils.PerformanceMonitor.currentTime();if(!(a-r>t.Computation.UpdateProgressDelta))return[3,4];r=a;return[4,this.ctx.updateProgress("Creating field...",true,n,i)];case 3:u.sent();u.label=4;case 4:n++;return[3,2];case 5:return[2]}})})};r.prototype.finish=function(){var r=e.LinearAlgebra.Matrix4.empty();e.LinearAlgebra.Matrix4.fromTranslation(r,[this.minX,this.minY,this.minZ]);r[0]=this.dX;r[5]=this.dY;r[10]=this.dZ;var n={data:{scalarField:new t.Formats.Density.Field3DZYX(this.field,[this.nX,this.nY,this.nZ]),annotationField:this.parameters.interactive?new t.Formats.Density.Field3DZYX(this.proximityMap,[this.nX,this.nY,this.nZ]):void 0,isoLevel:.05},bottomLeft:{x:this.minX,y:this.minY,z:this.minZ},topRight:{x:this.maxX,y:this.maxY,z:this.maxZ},transform:r,inputParameters:this.inputParameters,parameters:this.parameters};this.distanceField=null;this.proximityMap=null;return n};r.prototype.run=function(){return a(this,void 0,void 0,function(){return u(this,function(t){switch(t.label){case 0:return[4,this.ctx.updateProgress("Initializing...")];case 1:t.sent();this.findBounds();this.initData();return[4,this.processChunks()];case 2:t.sent();return[4,this.ctx.updateProgress("Finalizing...",void 0,this.atomIndices.length,this.atomIndices.length)];case 3:t.sent();return[2,this.finish()]}})})};return r}();function o(e){var r=this;return t.computation(function(t){return a(r,void 0,void 0,function(){var r;return u(this,function(n){switch(n.label){case 0:r=new i(e,t);return[4,r.run()];case 1:return[2,n.sent()]}})})})}r.createMolecularIsoFieldAsync=o;function s(r){var n=this;return t.computation(function(t){return a(n,void 0,void 0,function(){var n,i,s,a;return u(this,function(u){switch(u.label){case 0:return[4,o(r).run(t)];case 1:n=u.sent();return[4,e.MarchingCubes.compute(n.data).run(t)];case 2:i=u.sent();return[4,e.Surface.transform(i,n.transform).run(t)];case 3:i=u.sent();s=r.parameters&&r.parameters.smoothingIterations||1;a=1;if(r.parameters&&r.parameters.density<1){a=2/r.parameters.density}return[4,e.Surface.laplacianSmooth(i,s,a).run(t)];case 4:i=u.sent();return[2,{surface:i,usedParameters:n.parameters}]}})})})}r.computeMolecularSurfaceAsync=s})(r=e.MolecularSurface||(e.MolecularSurface={}))})(e=t.Geometry||(t.Geometry={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){"use strict";var r=t.Utils.DataTable;var n=function(){function e(e){this.id=e;this.map=t.Utils.FastMap.create()}e.prototype.add=function(e,r,n,i){if(i===void 0){i=true}var o=this.map.get(e);if(o!==void 0){var s=o.get(r);if(s===void 0){o.set(r,n)}}else{var a=t.Utils.FastMap.create();a.set(r,n);this.map.set(e,a)}if(i)this.add(r,e,n,false)};return e}();e.ComponentBondInfoEntry=n;var i=function(){function e(){this.entries=t.Utils.FastMap.create()}e.prototype.newEntry=function(t){var e=new n(t);this.entries.set(t,e);return e};return e}();e.ComponentBondInfo=i;var o=function(){function t(t,e,r){this.asymId=t;this.seqNumber=e;this.insCode=r}t.areEqual=function(t,e,r,n,i){return t.asymId===r[e]&&t.seqNumber===n[e]&&t.insCode===i[e]};t.compare=function(t,e){if(t.asymId===e.asymId){if(t.seqNumber===e.seqNumber){if(t.insCode===e.insCode)return 0;if(t.insCode===void 0)return-1;if(e.insCode===void 0)return 1;return t.insCode<e.insCode?-1:1}return t.seqNumber<e.seqNumber?-1:1}return t.asymId<e.asymId?-1:1};t.compareResidue=function(t,e,r,n,i){if(t.asymId===r[e]){if(t.seqNumber===n[e]){if(t.insCode===i[e])return 0;if(t.insCode===void 0)return-1;if(i[e]===void 0)return 1;return t.insCode<i[e]?-1:1}return t.seqNumber<n[e]?-1:1}return t.asymId<r[e]?-1:1};return t}();e.PolyResidueIdentifier=o;var s=function(){function t(t,e,r,n){if(n===void 0){n={}}this.type=t;this.startResidueId=e;this.endResidueId=r;this.info=n;this.startResidueIndex=-1;this.endResidueIndex=-1}Object.defineProperty(t.prototype,"length",{get:function(){return this.endResidueIndex-this.startResidueIndex},enumerable:true,configurable:true});return t}();e.SecondaryStructureElement=s;var a=function(){function t(t,e,r,n,i){this.spacegroupName=t;this.cellSize=e;this.cellAngles=r;this.toFracTransform=n;this.isNonStandardCrytalFrame=i}return t}();e.SymmetryInfo=a;var u=function(){function t(t,e,r){this.id=t;this.name=e;this.operator=r}return t}();e.AssemblyOperator=u;var c=function(){function t(t,e){this.operators=t;this.asymIds=e}return t}();e.AssemblyGenEntry=c;var f=function(){function t(t){this.name=t;this.gens=[]}return t}();e.AssemblyGen=f;var h=function(){function t(t,e){this.operators=t;this.assemblies=e}return t}();e.AssemblyInfo=h;var l;(function(t){var e=r.typedColumn(Int32Array);var n=r.typedColumn(Float32Array);var i=r.stringColumn;var o=r.stringNullColumn;t.Positions={x:n,y:n,z:n};t.Atoms={id:e,altLoc:i,residueIndex:e,chainIndex:e,entityIndex:e,name:i,elementSymbol:i,occupancy:n,tempFactor:n,authName:i,rowIndex:e};t.Residues={name:i,seqNumber:e,asymId:i,authName:i,authSeqNumber:e,authAsymId:i,insCode:o,entityId:i,isHet:r.typedColumn(Int8Array),atomStartIndex:e,atomEndIndex:e,chainIndex:e,entityIndex:e,secondaryStructureIndex:e};t.Chains={asymId:i,entityId:i,authAsymId:i,atomStartIndex:e,atomEndIndex:e,residueStartIndex:e,residueEndIndex:e,entityIndex:e,sourceChainIndex:void 0,operatorIndex:void 0};t.Entities={entityId:i,type:r.customColumn(),atomStartIndex:e,atomEndIndex:e,residueStartIndex:e,residueEndIndex:e,chainStartIndex:e,chainEndIndex:e};t.Bonds={atomAIndex:e,atomBIndex:e,type:r.typedColumn(Int8Array)}})(l=e.Tables||(e.Tables={}));var d=function(){function e(t,e,r){this.matrix=t;this.id=e;this.isIdentity=r}e.prototype.apply=function(e){t.Geometry.LinearAlgebra.Matrix4.transformVector3(e,e,this.matrix)};e.applyToModelUnsafe=function(e,r){var n={x:.1,y:.1,z:.1};var i=r.positions,o=i.x,s=i.y,a=i.z;for(var u=0,c=r.positions.count;u<c;u++){n.x=o[u];n.y=s[u];n.z=a[u];t.Geometry.LinearAlgebra.Matrix4.transformVector3(n,n,e);o[u]=n.x;s[u]=n.y;a[u]=n.z}};return e}();e.Operator=d;var p;(function(r){function n(t,e,r){if(r===void 0){r={}}return{id:t,models:e,properties:r}}r.create=n;var i;(function(r){function n(r){var n=t.Utils.extend({},r);var i=void 0;Object.defineProperty(n,"queryContext",{enumerable:true,configurable:false,get:function(){if(i)return i;i=e.Query.Context.ofStructure(n);return i}});return n}r.create=n;var i;(function(t){t[t["File"]=0]="File";t[t["Computed"]=1]="Computed"})(i=r.Source||(r.Source={}));function o(t,e,r){var i=t.positions,o=i.x,s=i.y,a=i.z;var u=t.positions.getBuilder(t.positions.count).seal();var c=u.x,f=u.y,h=u.z;var l={x:0,y:0,z:0};for(var d=0,p=t.positions.count;d<p;d++){r(e,o[d],s[d],a[d],l);c[d]=l.x;f[d]=l.y;h[d]=l.z}return n({id:t.id,modelId:t.modelId,data:t.data,positions:u,parent:t.parent,source:t.source,operators:t.operators})}r.withTransformedXYZ=o})(i=r.Model||(r.Model={}))})(p=e.Molecule||(e.Molecule={}))})(e=t.Structure||(t.Structure={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){"use strict";var r=t.Geometry.LinearAlgebra.Matrix4;var n=t.Geometry.LinearAlgebra.Vector4;var i=function(){function t(t){this.info=t;this.temp=r.empty();this.tempV=new Float64Array(4);if(o.Spacegroup[t.spacegroupName]===void 0){throw"'"+t.spacegroupName+"' is not a spacegroup recognized by the library."}this.space=this.getSpace();this.operators=this.getOperators()}Object.defineProperty(t.prototype,"operatorCount",{get:function(){return this.operators.length},enumerable:true,configurable:true});t.prototype.getOperatorMatrix=function(t,e,n,i,o){this.tempV[0]=e;this.tempV[1]=n;this.tempV[2]=i;r.fromTranslation(this.temp,this.tempV);r.mul(o,r.mul(o,r.mul(o,this.space.fromFrac,this.temp),this.operators[t]),this.space.toFrac);return o};t.prototype.getSpace=function(){var t=this.info.toFracTransform,e=r.empty();r.invert(e,t);return{toFrac:t,fromFrac:e,baseX:n.transform(n.create(),n.fromValues(1,0,0,1),t),baseY:n.transform(n.create(),n.fromValues(0,1,0,1),t),baseZ:n.transform(n.create(),n.fromValues(0,0,1,1),t)}};t.getOperator=function(t){var e=o.Transform[t[0]],n=o.Transform[t[1]],i=o.Transform[t[2]];return r.ofRows([e,n,i,[0,0,0,1]])};t.prototype.getOperators=function(){var e=o.Group[o.Spacegroup[this.info.spacegroupName]];return e.map(function(e){return t.getOperator(o.Operator[e])})};return t}();e.Spacegroup=i;var o;(function(t){t.Transform=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,.333333333333333],[0,0,1,.666666666666667],[1,0,0,.666666666666667],[0,1,0,.333333333333333],[0,-1,0,.666666666666667],[1,-1,0,.333333333333333],[-1,1,0,.666666666666667],[-1,0,0,.333333333333333],[1,0,0,.333333333333333],[0,1,0,.666666666666667],[0,-1,0,.333333333333333],[1,-1,0,.666666666666667],[-1,1,0,.333333333333333],[-1,0,0,.666666666666667],[0,0,-1,.333333333333333],[0,0,-1,.666666666666667],[0,0,1,.833333333333333],[0,0,1,.166666666666667],[0,0,-1,.833333333333333],[0,0,-1,.166666666666667]];t.Operator=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]];t.Group=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]];t.Spacegroup={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"B 1 1 2/b":253,"P 21 2 2":254,"P 2 21 2":255,"P 21 21 2 (a)":256,"P 21 2 21":257,"P 2 21 21":258,"C 2 2 21a)":259,"C 2 2 2a":260,"F 2 2 2a":261,"I 2 2 2a":262,"P 21/m 21/m 2/n a":263,"P 42 21 2a":264,"I 2 3a":265}})(o=e.SpacegroupTables||(e.SpacegroupTables={}))})(e=t.Structure||(t.Structure={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){"use strict";var r=t.Utils.DataTable;var n;(function(n){var i=t.Geometry.LinearAlgebra.Matrix4;function o(t,e){var r=t.x,n=t.y,i=t.z;var o={x:0,y:0,z:0};for(var s=0,a=e;s<a.length;s++){var u=a[s];o.x+=r[u];o.y+=n[u];o.z+=i[u]}var c=e.length>0?e.length:1;o.x/=c;o.y/=c;o.z/=c;var h=0;for(var l=0,d=e;l<d.length;l++){var u=d[l];h=Math.max(f(u,o,t),h)}return{center:o,radius:Math.sqrt(h)}}function s(){return{x:0,y:0,z:0}}function a(t,e,r){var n=t.x-r.center.x,i=t.y-r.center.y,o=t.z-r.center.z;return Math.sqrt(n*n+i*i+o*o)-(e+r.radius)}function u(t,e,r,n,o,s){s.x=r.x[e];s.y=r.y[e];s.z=r.z[e];i.transformVector3(s,s,n);return a(s,r.r[e],t)<=o}function c(t,e,r){var n=r.x[t]-r.cX[e],i=r.y[t]-r.cY[e],o=r.z[t]-r.cZ[e];return n*n+i*i+o*o}function f(t,e,r){var n=r.x[t]-e.x,i=r.y[t]-e.y,o=r.z[t]-e.z;return n*n+i*i+o*o}function h(t,e,r,n){return{model:t,boundingInfo:e,spacegroup:r,radius:n,transform:i.empty(),transformed:{x:0,y:0,z:0},i:0,j:0,k:0,op:0}}function l(t,e){return i.transformVector3(t.transformed,e,t.transform)}function d(t){return p(t.i,t.j,t.k,t.op,i.clone(t.transform))}function p(t,e,r,n,i){return{isIdentity:!t&&!e&&!r&&!n,id:n+1+"_"+(5+t)+(5+e)+(5+r),transform:i}}function v(t,e){var r=true;for(var n=0;n<4;n++){for(var i=0;i<4;i++){var o=e[4*i+n];if(n===i){if(Math.abs(o-1)>1e-7){r=false;break}}else if(Math.abs(o)>1e-7){r=false;break}}if(!r)break}return{isIdentity:r,id:t.toString(),transform:e}}function m(t,e){var n=t.data.atoms,i=t.data.residues,o=t.data.chains,a=t.data.entities,u=t.positions,h=u.x,l=u.y,d=u.z;var p=r.builder(a.count),v=p.addColumn("x",function(t){return new Float64Array(t)}),m=p.addColumn("y",function(t){return new Float64Array(t)}),y=p.addColumn("z",function(t){return new Float64Array(t)}),g=p.addColumn("r",function(t){return new Float64Array(t)}),b=r.builder(o.count),_=b.addColumn("x",function(t){return new Float64Array(t)}),w=b.addColumn("y",function(t){return new Float64Array(t)}),x=b.addColumn("z",function(t){return new Float64Array(t)}),C=b.addColumn("r",function(t){return new Float64Array(t)}),I=r.builder(i.count),S=I.addColumn("x",function(t){return new Float64Array(t)}),A=I.addColumn("y",function(t){return new Float64Array(t)}),k=I.addColumn("z",function(t){return new Float64Array(t)}),E=I.addColumn("r",function(t){return new Float64Array(t)});var P=s(),T=0,F=s(),D=0,M=0,N=s(),R=0,q=s(),O=0,U=s(),B=0;for(var z=0,L=a.count;z<L;z++){N.x=0;N.y=0;N.z=0;for(var j=a.chainStartIndex[z],V=a.chainEndIndex[z];j<V;j++){q.x=0;q.y=0;q.z=0;for(var X=o.residueStartIndex[j],Y=o.residueEndIndex[j];X<Y;X++){U.x=0;U.y=0;U.z=0;for(var Z=i.atomStartIndex[X],H=i.atomEndIndex[X];Z<H;Z++){U.x+=h[Z];U.y+=l[Z];U.z+=d[Z]}P.x+=U.x;P.y+=U.y;P.z+=U.z;M=i.atomEndIndex[X]-i.atomStartIndex[X];q.x+=U.x;q.y+=U.y;q.z+=U.z;S[X]=U.x/M;A[X]=U.y/M;k[X]=U.z/M}N.x+=q.x;N.y+=q.y;N.z+=q.z;M=o.atomEndIndex[j]-o.atomStartIndex[j];_[j]=q.x/M;w[j]=q.y/M;x[j]=q.z/M}M=a.atomEndIndex[z]-a.atomStartIndex[z];v[z]=N.x/M;m[z]=N.y/M;y[z]=N.z/M}P.x/=n.count;P.y/=n.count;P.z/=n.count;for(var G=0,W=e;G<W.length;G++){var Z=W[G];F.x+=h[Z];F.y+=l[Z];F.z+=d[Z]}var Q=e.length>0?e.length:1;F.x/=Q;F.y/=Q;F.z/=Q;var J={x:h,y:l,z:d,cX:v,cY:m,cZ:y},K={x:h,y:l,z:d,cX:_,cY:w,cZ:x},$={x:h,y:l,z:d,cX:S,cY:A,cZ:k};for(var z=0,L=a.count;z<L;z++){R=0;for(var j=a.chainStartIndex[z],V=a.chainEndIndex[z];j<V;j++){O=0;for(var X=o.residueStartIndex[j],Y=o.residueEndIndex[j];X<Y;X++){B=0;for(var Z=i.atomStartIndex[X],H=i.atomEndIndex[X];Z<H;Z++){B=Math.max(B,c(Z,X,$));O=Math.max(O,c(Z,j,K));R=Math.max(R,c(Z,z,J));T=Math.max(T,f(Z,P,$))}B=Math.sqrt(B);E[X]=B}O=Math.sqrt(O);C[j]=O}R=Math.sqrt(R);g[z]=R}T=Math.sqrt(T);for(var tt=0,et=e;tt<et.length;tt++){var Z=et[tt];D=Math.max(D,f(Z,F,$))}D=Math.sqrt(D);return{entities:p.seal(),chains:b.seal(),residues:I.seal(),allAtoms:{center:P,radius:T},target:{center:F,radius:D}}}function y(t){var e=t.boundingInfo,r=t.spacegroup;var n=[];t.transform=i.identity();n[0]=d(t);for(var o=-3;o<=3;o++){for(var s=-3;s<=3;s++){for(var u=-3;u<=3;u++){for(var c=o===0&&s===0&&u===0?1:0,f=r.operatorCount;c<f;c++){r.getOperatorMatrix(c,o,s,u,t.transform);t.i=o;t.k=u;t.j=s;t.op=c;var h=l(t,e.allAtoms.center),p=a(h,e.allAtoms.radius,e.target);if(p<t.radius){n[n.length]=d(t)}}}}}return n}function g(e,r){var n=e.boundingInfo,i=e.radius,o=n.target;var s=e.model,a=s.data.residues,c=s.data.chains,f=s.data.entities;var h=t.Utils.ChunkedArray.create(function(t){return new Int32Array(t)},a.count,1),l=t.Utils.ChunkedArray.create(function(t){return new Int32Array(t)},a.count,1);var d={x:0,y:0,z:0},p=0;var v=0,m=0,y=0;for(var g=0,b=f.count;g<b;g++){p=0;var _=false;for(var w=0,x=r;w<x.length;w++){var C=x[w];for(var I=f.chainStartIndex[g],S=f.chainEndIndex[g];I<S;I++){if(!u(o,I,n.chains,C.transform,i,d))continue;var A=false;for(var k=c.residueStartIndex[I],E=c.residueEndIndex[I];k<E;k++){if(!u(o,k,n.residues,C.transform,i,d))continue;t.Utils.ChunkedArray.add(h,k);t.Utils.ChunkedArray.add(l,p);v+=a.atomEndIndex[k]-a.atomStartIndex[k];A=true}if(A){m+=1;_=true}}p++}if(_){y++}}return{residues:t.Utils.ChunkedArray.compact(h),operators:t.Utils.ChunkedArray.compact(l),atomCount:v,chainCount:m,entityCount:y}}function b(t,e,r,n,i){for(var o=0;o<i;o++){r[o][n]=t[o][e]}}function _(t,n,o){var s=t.data.residues,a=s.chainIndex,u=s.entityIndex,c=s.atomStartIndex,f=s.atomEndIndex,h=t.data.atoms,l=t.positions,d=l.x,p=l.y,v=l.z;var m=r.builder(n.atomCount),y,g,_,x,C=[];var I=r.ofDefinition(e.Tables.Positions,n.atomCount),S=I.x,A=I.y,k=I.z;var E=t.data.entities.getBuilder(n.entityCount),P=E,T=t.data.entities.getRawData(),F=P.getRawData(),D=P.chainStartIndex,M=P.chainEndIndex,N=P.residueStartIndex,R=P.residueEndIndex,q=P.atomStartIndex,O=P.atomEndIndex,U=0;var B=t.data.chains.getBuilder(n.chainCount),z=B,L=t.data.chains.getRawData(),j=z.getRawData(),V=z.residueStartIndex,X=z.residueEndIndex,Y=z.atomStartIndex,Z=z.atomEndIndex,H=z.asymId,G=z.authAsymId,W=z.entityIndex,Q=B.addColumn("sourceChainIndex",function(t){return new Int32Array(t)}),J=B.addColumn("operatorIndex",function(t){return new Int32Array(t)}),K=0;var $=t.data.residues.getBuilder(n.residues.length),tt=$,et=t.data.residues.getRawData(),rt=tt.getRawData(),nt=tt.atomStartIndex,it=tt.atomEndIndex,ot=tt.asymId,st=tt.authAsymId,at=tt.chainIndex,ut=tt.entityIndex;for(var ct=0,ft=t.data.atoms.columns;ct<ft.length;ct++){var ht=ft[ct];var lt=m.addColumn(ht.name,ht.creator);if(ht.name==="residueIndex")g=lt;else if(ht.name==="chainIndex")_=lt;else if(ht.name==="entityIndex")x=lt;else if(ht.name==="id")y=lt;else{C[C.length]={src:h[ht.name],target:lt}}}var dt=n.residues,pt=n.operators,vt={x:0,y:0,z:0},mt=0;var yt=dt[0],gt=a[yt],bt=u[yt],_t=pt[0],wt,xt;b(T,u[yt],F,0,T.length);D[0]=0;N[0]=0;q[0]=0;b(L,a[yt],j,0,L.length);W[0]=0;V[0]=0;Y[0]=0;wt=t.data.chains.asymId[a[yt]];xt=t.data.chains.authAsymId[a[yt]];var Ct=o[pt[0]];if(Ct&&!Ct.isIdentity){H[K]=t.data.chains.asymId[a[yt]]+"-"+Ct.id;G[K]=t.data.chains.authAsymId[a[yt]]+"-"+Ct.id;Q[K]=a[yt];J[K]=_t;wt=H[K];xt=G[K]}for(var It=0,St=dt.length;It<St;It++){yt=dt[It];var At=pt[It];Ct=o[At];b(et,yt,rt,It,rt.length);var kt=u[yt],Et=a[yt];var Pt=false;if(kt!==bt){X[K]=It;Z[K]=mt;K+=1;M[U]=K;R[U]=It;O[U]=mt;U+=1;b(T,kt,F,U,T.length);D[U]=K;N[U]=It;q[U]=mt;Pt=true}else if(Et!==gt){X[K]=It;Z[K]=mt;K+=1;Pt=true}else if(At!==_t){X[K]=It;Z[K]=mt;K+=1;Pt=true}if(Pt){b(L,Et,j,K,L.length);W[K]=U;V[K]=It;Y[K]=mt;if(!Ct.isIdentity){H[K]=t.data.chains.asymId[Et]+"-"+Ct.id;G[K]=t.data.chains.authAsymId[Et]+"-"+Ct.id}Q[K]=Et;J[K]=At;wt=H[K];xt=G[K]}gt=Et;bt=kt;_t=At;at[It]=K;ut[It]=U;nt[It]=mt;ot[It]=wt;st[It]=xt;for(var Tt=c[yt],Ft=f[yt];Tt<Ft;Tt++){vt.x=d[Tt];vt.y=p[Tt];vt.z=v[Tt];i.transformVector3(vt,vt,Ct.transform);S[mt]=vt.x;A[mt]=vt.y;k[mt]=vt.z;y[mt]=mt+1;g[mt]=It;_[mt]=K;x[mt]=U;for(var Dt=0,Mt=C;Dt<Mt.length;Dt++){var lt=Mt[Dt];lt.target[mt]=lt.src[Tt]}mt++}it[It]=mt}M[U]=K+1;R[U]=dt.length;O[U]=mt;X[K]=dt.length;Z[K]=mt;var Nt=m.seal(),Rt=$.seal(),qt=B.seal(),Ot=E.seal();var Ut=w(t,n,Rt);return e.Molecule.Model.create({id:t.id,modelId:t.modelId,data:{atoms:Nt,residues:Rt,chains:qt,entities:Ot,bonds:{component:t.data.bonds.component},secondaryStructure:Ut},positions:I,parent:t,source:e.Molecule.Model.Source.Computed,operators:o.map(function(t){return new e.Operator(t.transform,t.id,t.isIdentity)})})}function w(t,r,n){var i=t.data.residues.secondaryStructureIndex;var o=t.data.secondaryStructure;var s=n.asymId,a=n.seqNumber,u=n.insCode,c=n.secondaryStructureIndex;var f=r.residues,h=r.operators;var l=f.length;var d=[];var p=0;while(p<l){var v=p;var m=i[f[p]],y=h[p];while(v<l&&h[v]==y&&i[f[v]]==m)v++;var g=o[m];var b=new e.SecondaryStructureElement(g.type,new e.PolyResidueIdentifier(s[p],a[p],u[p]),new e.PolyResidueIdentifier(s[v-1],a[v-1],u[v-1]),g.info);b.startResidueIndex=p;b.endResidueIndex=v;var _=d.length;for(var w=p;w<v;w++){c[w]=_}d[_]=b;p=v}return d}function x(t,r,n){var i=t.data.symmetryInfo;if(!i||i.cellSize[0]<1.1&&i.cellSize[1]<1.1&&i.cellSize[2]<1.1){return t}var o;if(!n)o=t.data.atoms.indices;else o=e.Query.apply(n,t).unionAtomIndices();var s=m(t,o),a=new e.Spacegroup(i),u=h(t,s,a,r);var c=y(u),f=g(u,c);return _(t,f,c)}n.buildPivotGroupSymmetry=x;function C(t,r){var n=o(t.positions,t.positions.indices);var s=new e.Spacegroup(t.data.symmetryInfo);var u=i.empty();var c={x:0,y:0,z:0};var f=[];for(var h=-3;h<=3;h++){for(var l=-3;l<=3;l++){for(var d=-3;d<=3;d++){for(var v=0;v<s.operatorCount;v++){s.getOperatorMatrix(v,h,l,d,u);i.transformVector3(c,n.center,u);if(a(c,n.radius,n)>r)continue;var m=i.empty();i.copy(m,u);f.push(p(h,l,d,v,m))}}}}return f}function I(e,r){var n=e.data,i=n.atoms,o=n.chains,s=n.entities,a=n.residues;var u=t.Utils.ArrayBuilder.create(function(t){return new Int32Array(t)},a.count*r.length,1),c=t.Utils.ArrayBuilder.create(function(t){return new Int32Array(t)},a.count*r.length,1);var f=r.length*i.count;var h=r.length*o.count;var l=s.count;for(var d=0,p=s.count;d<p;d++){for(var v=0;v<r.length;v++){for(var m=s.chainStartIndex[d],y=s.chainEndIndex[d];m<y;m++){for(var g=o.residueStartIndex[m],b=o.residueEndIndex[m];g<b;g++){t.Utils.ArrayBuilder.add(u,g);t.Utils.ArrayBuilder.add(c,v)}}}}return{residues:u.array,operators:c.array,atomCount:f,chainCount:h,entityCount:l}}function S(t,e){var r=t.data.symmetryInfo;if(!r||r.cellSize[0]<1.1&&r.cellSize[1]<1.1&&r.cellSize[2]<1.1){return t}var n=C(t,e);var i=I(t,n);return _(t,i,n)}n.buildMates=S;function A(t,e,r,n){if(r<0){e[e.length]=n.slice(0);return}var i=t[r],o=i.length;for(var s=0;s<o;s++){n[r]=i[s];A(t,e,r-1,n)}}function k(t,e,r){var n=t.data.assemblyInfo;var o=[];var s=r;for(var a=0,u=e;a<u.length;a++){var c=u[a];var f=i.identity();for(var h=0;h<c.length;h++){i.mul(f,f,n.operators[c[h]].operator)}s++;o[o.length]=v(s,f)}return o}function E(e,r,n,i,o){var s=e.data,a=s.chains,u=s.entities,c=s.residues;var f=i.residueIndices,h=i.operatorIndices;var l=0,d=0,p=0;for(var v=0,m=u.count;v<m;v++){var y=o;var g=false;for(var b=0,_=n;b<_.length;b++){var w=_[b];for(var x=u.chainStartIndex[v],C=u.chainEndIndex[v];x<C;x++){var I=false;for(var S=a.residueStartIndex[x],A=a.residueEndIndex[x];S<A;S++){if(!r[S])continue;t.Utils.ChunkedArray.add(f,S);t.Utils.ChunkedArray.add(h,y);l+=c.atomEndIndex[S]-c.atomStartIndex[S];I=true}if(I){d+=1;g=true}}y++}if(g){p++}}i.atomCount+=l;i.chainCount+=d;i.entityCount+=p}function P(e,r,n){var i=[],o=[];for(var s=0;s<r.operators.length;s++)o[s]="";A(r.operators,i,r.operators.length-1,o);var a=n.transforms.length;var u=k(e,i,n.transforms.length);(p=n.transforms).push.apply(p,u);var c=t.Utils.FastSet.create();r.asymIds.forEach(function(t){return c.add(t)});var f=e.data.residues.asymId;var h=e.data.residues.count;var l=n.mask;for(var d=0;d<h;d++){l[d]=c.has(f[d])}E(e,l,u,n,a);var p}n.buildAssemblyEntry=P;function T(e,r){var n={atomCount:0,chainCount:0,entityCount:0,transforms:[],mask:new Int8Array(e.data.residues.count),residueIndices:t.Utils.ChunkedArray.create(function(t){return new Int32Array(t)},e.data.residues.count,1),operatorIndices:t.Utils.ChunkedArray.create(function(t){return new Int32Array(t)},e.data.residues.count,1)};for(var i=0,o=r.gens;i<o.length;i++){var s=o[i];P(e,s,n)}var a={residues:t.Utils.ChunkedArray.compact(n.residueIndices),operators:t.Utils.ChunkedArray.compact(n.operatorIndices),atomCount:n.atomCount,chainCount:n.chainCount,entityCount:n.entityCount};return _(e,a,n.transforms)}n.buildAssembly=T})(n||(n={}));function i(t,e,r){return n.buildPivotGroupSymmetry(t,e,r)}e.buildPivotGroupSymmetry=i;function o(t,e){return n.buildMates(t,e)}e.buildSymmetryMates=o;function s(t,e){return n.buildAssembly(t,e)}e.buildAssembly=s})(e=t.Structure||(t.Structure={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(e){function r(t,r){return e.Builder.toQuery(t)(r.queryContext)}e.apply=r;var n=function(){function e(t,e){this.structure=t;this.mask=e}Object.defineProperty(e.prototype,"atomCount",{get:function(){return this.mask.size},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.mask.size===this.structure.data.atoms.count},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"tree",{get:function(){if(!this.lazyTree)this.makeTree();return this.lazyTree},enumerable:true,configurable:true});e.prototype.hasAtom=function(t){return!!this.mask.has(t)};e.prototype.hasRange=function(t,e){for(var r=t;r<e;r++){if(this.mask.has(r))return true}return false};e.ofStructure=function(t){return new e(t,e.Mask.ofStructure(t))};e.ofFragments=function(t){return new e(t.context.structure,e.Mask.ofFragments(t))};e.ofAtomIndices=function(t,r){return new e(t,e.Mask.ofIndices(t,r))};e.prototype.makeTree=function(){var e=new Int32Array(this.mask.size),r=0,n=this.structure.positions,i=n.x,o=n.y,s=n.z;for(var a=0,u=this.structure.positions.count;a<u;a++){if(this.mask.has(a))e[r++]=a}this.lazyTree=t.Geometry.SubdivisionTree3D.create(e,function(t,e){return e(i[t],o[t],s[t])})};return e}();e.Context=n;(function(e){var r;(function(e){var r=function(){function t(t,e){this.mask=t;this.size=e}t.prototype.has=function(t){return this.mask[t]};return t}();var n=function(){function t(t){this.size=t}t.prototype.has=function(t){return true};return t}();function i(t){return new n(t.data.atoms.count)}e.ofStructure=i;function o(e,n){var i=n.length/e.data.atoms.count;if(i<.25){var o=t.Utils.FastSet.create();for(var s=0,a=n;s<a.length;s++){var u=a[s];o.add(u)}return o}var c=new Int8Array(e.data.atoms.count);for(var f=0,h=n;f<h.length;f++){var u=h[f];c[u]=1}return new r(c,n.length)}e.ofIndices=o;function s(e){var n=0;for(var i=0,o=e.fragments;i<o.length;i++){var s=o[i];n+=s.atomCount}var a=e.context.structure.data.atoms.count;if(n/a<.25){var u=t.Utils.FastSet.create();for(var c=0,f=e.fragments;c<f.length;c++){var s=f[c];for(var h=0,l=s.atomIndices;h<l.length;h++){var d=l[h];u.add(d)}}return u}else{var u=new Int8Array(a);for(var p=0,v=e.fragments;p<v.length;p++){var s=v[p];for(var m=0,y=s.atomIndices;m<y.length;m++){var d=y[m];u[d]=1}}var g=0;for(var d=0;d<a;d++){if(u[d]!==0)g++}return new r(u,g)}}e.ofFragments=s})(r=e.Mask||(e.Mask={}))})(n=e.Context||(e.Context={}));var i=function(){function r(t,e,r){this._hashCode=0;this._hashComputed=false;this.context=t;this.tag=e;this.atomIndices=r}Object.defineProperty(r.prototype,"hashCode",{get:function(){if(this._hashComputed)return this._hashCode;var t=23;for(var e=0,r=this.atomIndices;e<r.length;e++){var n=r[e];t=31*t+n|0}this._hashCode=t;this._hashComputed=true;return t},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"id",{get:function(){return this.context.structure.id+"_"+this.tag},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"atomCount",{get:function(){return this.atomIndices.length},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"isHet",{get:function(){var t=this.context.structure.data.atoms.residueIndex[this.tag];return this.context.structure.data.residues.isHet[t]},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"fingerprint",{get:function(){if(this._fingerprint)return this._fingerprint;var t=this.residueIndices,e=this.context.structure.data.residues,r=e.name,n=e.asymId,i=e.seqNumber,o=e.insCode,s=[];for(var a=0,u=t;a<u.length;a++){var c=u[a];var f=r[c]+" "+n[c]+" "+i[c];if(o[c])f+=" i:"+o[c];s[s.length]=f}return s.join("-")},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"authFingerprint",{get:function(){if(this._authFingerprint)return this._authFingerprint;var t=this.residueIndices,e=this.context.structure.data.residues,r=e.authName,n=e.authAsymId,i=e.authSeqNumber,o=e.insCode,s=[];for(var a=0,u=t;a<u.length;a++){var c=u[a];var f=r[c]+" "+n[c]+" "+i[c];if(o[c])f+=" i:"+o[c];s[s.length]=f}return s.join("-")},enumerable:true,configurable:true});r.prototype.find=function(t){var r=n.ofFragments(new o(this.context,[this]));return e.Builder.toQuery(t)(r)};r.prototype.computeIndices=function(){if(this._residueIndices)return;var e=t.Utils.FastSet.create(),r=t.Utils.FastSet.create(),n=t.Utils.FastSet.create(),i=this.context.structure.data.atoms.residueIndex,o=this.context.structure.data.residues.chainIndex,s=this.context.structure.data.chains.entityIndex;for(var a=0,u=this.atomIndices;a<u.length;a++){var c=u[a];e.add(i[c])}this._residueIndices=t.Utils.integerSetToSortedTypedArray(e);for(var f=0,h=this._residueIndices;f<h.length;f++){var c=h[f];r.add(o[c])}this._chainIndices=t.Utils.integerSetToSortedTypedArray(r);for(var l=0,d=this._chainIndices;l<d.length;l++){var c=d[l];n.add(s[c])}this._entityIndices=t.Utils.integerSetToSortedTypedArray(n)};Object.defineProperty(r.prototype,"residueIndices",{get:function(){this.computeIndices();return this._residueIndices},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"chainIndices",{get:function(){this.computeIndices();return this._chainIndices},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"entityIndices",{get:function(){this.computeIndices();return this._entityIndices},enumerable:true,configurable:true});r.areEqual=function(t,e){if(t.atomCount!==e.atomCount)return false;var r=t.atomIndices,n=e.atomIndices;for(var i=0;i<r.length;i++){if(r[i]!==n[i])return false}return t.tag===e.tag};r.ofSet=function(t,e){var n=new Int32Array(e.size);e.forEach(function(t,e){e.array[e.index++]=t},{array:n,index:0});Array.prototype.sort.call(n,function(t,e){return t-e});return new r(t,n[0],n)};r.ofArray=function(t,e,n){return new r(t,e,n)};r.ofIndex=function(t,e){var n=new Int32Array(1);n[0]=e;return new r(t,e,n)};r.ofIndexRange=function(t,e,n){var i=0;for(var o=e;o<n;o++){if(t.hasAtom(o))i++}var s=new Int32Array(i),a=0;for(var o=e;o<n;o++){if(t.hasAtom(o))s[a++]=o}return new r(t,e,s)};return r}();e.Fragment=i;var o=function(){function t(t,e){this.context=t;this.fragments=e}t.empty=function(e){return new t(e,[])};Object.defineProperty(t.prototype,"length",{get:function(){return this.fragments.length},enumerable:true,configurable:true});t.prototype.unionAtomIndices=function(){if(!this.length)return[];if(this.length===1)return this.fragments[0].atomIndices;var t=new Int8Array(this.context.structure.data.atoms.count),e=0;for(var r=0,n=this.fragments;r<n.length;r++){var i=n[r];for(var o=0,s=i.atomIndices;o<s.length;o++){var a=s[o];t[a]=1}}for(var u=0,c=t;u<c.length;u++){var a=c[u];e+=a}var f=new Int32Array(e),h=0;for(var a=0,l=t.length;a<l;a++){if(t[a])f[h++]=a}return f};t.prototype.unionFragment=function(){if(!this.length)return new i(this.context,0,new Int32Array(0));if(this.length===1)return this.fragments[0];var t=this.unionAtomIndices();return new i(this.context,t[0],t)};return t}();e.FragmentSeq=o;var s=function(){function t(t){this.ctx=t;this.fragments=[]}t.prototype.add=function(t){this.fragments[this.fragments.length]=t};t.prototype.getSeq=function(){return new o(this.ctx,this.fragments)};return t}();e.FragmentSeqBuilder=s;var a=function(){function e(e){this.ctx=e;this.fragments=[];this.byHash=t.Utils.FastMap.create()}e.prototype.add=function(t){var e=t.hashCode;if(this.byHash.has(e)){var r=this.byHash.get(e);for(var n=0,o=r;n<o.length;n++){var s=o[n];if(i.areEqual(t,s))return this}this.fragments[this.fragments.length]=t;r[r.length]=t}else{this.fragments[this.fragments.length]=t;this.byHash.set(e,[t])}return this};e.prototype.getSeq=function(){return new o(this.ctx,this.fragments)};return e}();e.HashFragmentSeqBuilder=a})(r=e.Query||(e.Query={}))})(e=t.Structure||(t.Structure={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(e){var r;(function(t){t.BuilderPrototype={};function e(e,r){t.BuilderPrototype[e]=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.call.apply(r,[void 0,this].concat(t))}}t.registerModifier=e;function r(e){return Object.create(t.BuilderPrototype,{compile:{writable:false,configurable:false,value:e}})}t.build=r;function n(t){return!!t.compile}function i(t){if(typeof window==="undefined")throw"parse can only be called from a browser.";((function(){})(),eval)("with (LiteMol.Core.Structure.Query) { window.__LiteMol_query = "+t+"; }");var e=window.__LiteMol_query;window.__LiteMol_query=void 0;return e.compile()}t.parse=i;function o(t){var e;if(n(t))e=t.compile();else if(typeof t==="string"||t instanceof String)e=i(t);else e=t;return e}t.toQuery=o})(r=e.Builder||(e.Builder={}));function n(){return r.build(function(){return R.compileAllAtoms()})}e.allAtoms=n;function i(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compileAtoms(t,function(t){return t.data.atoms.elementSymbol})})}e.atomsByElement=i;function o(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compileAtoms(t,function(t){return t.data.atoms.name})})}e.atomsByName=o;function s(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compileAtoms(t,function(t){return t.data.atoms.id})})}e.atomsById=s;function a(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compileAtomRanges(false,t,function(t){return t.data.residues})})}e.residues=a;function u(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compileAtomRanges(false,t,function(t){return t.data.chains})})}e.chains=u;function c(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compileAtomRanges(false,t,function(t){return t.data.entities})})}e.entities=c;function f(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compileAtomRanges(true,t,function(t){return t.data.entities})})}e.notEntities=f;function h(){return r.build(function(){return R.compileEverything()})}e.everything=h;function l(t){return r.build(function(){return R.compileFromIndices(false,t,function(t){return t.data.entities})})}e.entitiesFromIndices=l;function d(t){return r.build(function(){return R.compileFromIndices(false,t,function(t){return t.data.chains})})}e.chainsFromIndices=d;function p(t){return r.build(function(){return R.compileFromIndices(false,t,function(t){return t.data.residues})})}e.residuesFromIndices=p;function v(t){return r.build(function(){return R.compileAtomIndices(t)})}e.atomsFromIndices=v;function m(t,e,n,i){return r.build(function(){return R.compileSequence(t,e,n,i)})}e.sequence=m;function y(){return r.build(function(){return R.compileHetGroups()})}e.hetGroups=y;function g(){return r.build(function(){return R.compileNonHetPolymer()})}e.nonHetPolymer=g;function b(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compilePolymerNames(t,false)})}e.polymerTrace=b;function _(){return I(r.build(function(){return R.compilePolymerNames(["CA","O","O5'","C3'","N3"],false)}),y(),c({type:"water"}))}e.cartoons=_;function w(){return r.build(function(){return R.compilePolymerNames(["N","CA","C","O","P","OP1","OP2","O3'","O5'","C3'","C5'","C4"],false)})}e.backbone=w;function x(){return r.build(function(){return R.compilePolymerNames(["N","CA","C","O","P","OP1","OP2","O3'","O5'","C3'","C5'","C4"],true)})}e.sidechain=x;function C(t,e){return r.build(function(){return R.compileAtomsInBox(t,e)})}e.atomsInBox=C;function I(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return r.build(function(){return R.compileOr(t)})}e.or=I;r.registerModifier("complement",S);function S(t){return r.build(function(){return R.compileComplement(t)})}e.complement=S;r.registerModifier("ambientResidues",A);function A(t,e){return r.build(function(){return R.compileAmbientResidues(t,e)})}e.ambientResidues=A;r.registerModifier("wholeResidues",k);function k(t){return r.build(function(){return R.compileWholeResidues(t)})}e.wholeResidues=k;r.registerModifier("union",E);function E(t){return r.build(function(){return R.compileUnion(t)})}e.union=E;r.registerModifier("inside",P);function P(t,e){return r.build(function(){return R.compileInside(t,e)})}e.inside=P;r.registerModifier("intersectWith",T);function T(t,e){return r.build(function(){return R.compileIntersectWith(t,e)})}e.intersectWith=T;r.registerModifier("flatten",F);function F(t,e){return r.build(function(){return R.compileFlatten(t,e)})}e.flatten=F;function D(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return a.apply(void 0,t.map(function(t){return{name:t}}))}e.residuesByName=D;function M(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return a.apply(void 0,t.map(function(t){return{authSeqNumber:t}}))}e.residuesById=M;function N(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return u.apply(void 0,t.map(function(t){return{authAsymId:t}}))}e.chainsById=N;var R;(function(n){var i=function(){function t(t,e){this.columns=[];for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];if(t[i]!==void 0&&!!e[i]){this.columns.push({value:t[i],array:e[i]})}}}t.prototype.isSatisfied=function(t){for(var e=0,r=this.columns;e<r.length;e++){var n=r[e];if(n.value!==n.array[t])return false}return true};return t}();function o(){return function(t){if(t.isComplete){var r=t.structure.data.atoms.indices;return new e.FragmentSeq(t,[new e.Fragment(t,r[0],r)])}var n=new Int32Array(t.atomCount);var i=0;for(var o=0,s=t.structure.data.atoms.indices;o<s.length;o++){var a=s[o];if(t.hasAtom(a))n[i++]=a}return new e.FragmentSeq(t,[e.Fragment.ofArray(t,n[0],n)])}}n.compileEverything=o;function s(){return function(t){var r=new e.FragmentSeqBuilder(t);for(var n=0,i=t.structure.data.atoms.count;n<i;n++){if(t.hasAtom(n))r.add(e.Fragment.ofIndex(t,n))}return r.getSeq()}}n.compileAllAtoms=s;function a(r,n){return function(i){var o=t.Utils.FastSet.ofArray(r),s=n(i.structure),a=new e.FragmentSeqBuilder(i);for(var u=0,c=s.length;u<c;u++){if(i.hasAtom(u)&&o.has(s[u]))a.add(e.Fragment.ofIndex(i,u))}return a.getSeq()}}n.compileAtoms=a;function u(t){return function(r){var n=0;for(var i=0,o=t;i<o.length;i++){var s=o[i];if(r.hasAtom(s))n++}if(!n)return e.FragmentSeq.empty(r);var a=0;var u=new Int32Array(n);for(var c=0,f=t;c<f.length;c++){var s=f[c];if(r.hasAtom(s))u[a++]=s}return new e.FragmentSeq(r,[e.Fragment.ofArray(r,u[0],u)])}}n.compileAtomIndices=u;function c(r,n,i){return function(o){var s=i(o.structure),a=s.atomStartIndex,u=s.atomEndIndex,c=new e.FragmentSeqBuilder(o);if(r){var f=t.Utils.FastSet.ofArray(n);var h=s.count;for(var l=0;l<h;l++){if(f.has(l))continue;if(!o.hasRange(a[l],u[l]))continue;c.add(e.Fragment.ofIndexRange(o,a[l],u[l]))}}else{for(var d=0,p=n;d<p.length;d++){var l=p[d];if(!o.hasRange(a[l],u[l]))continue;c.add(e.Fragment.ofIndexRange(o,a[l],u[l]))}}return c.getSeq()}}n.compileFromIndices=c;function f(t,r,n){return function(o){var s=n(o.structure),a=s.atomStartIndex,u=s.atomEndIndex,c=new e.FragmentSeqBuilder(o),f=s.count,h=false;var l=r.map(function(t){return new i(t,s)});var d=l.length===0;for(var p=0;p<f;p++){if(!o.hasRange(a[p],u[p]))continue;h=d;for(var v=0,m=l;v<m.length;v++){var y=m[v];if(y.isSatisfied(p)){h=true;break}}if(t)h=!h;if(h){c.add(e.Fragment.ofIndexRange(o,a[p],u[p]))}}return c.getSeq()}}n.compileAtomRanges=f;function h(t,r,n,o){return function(s){var a=s.structure.data,u=a.residues,c=a.chains,f=u.seqNumber,h=u.atomStartIndex,l=u.atomEndIndex,d=c.entityId,p=c.count,v=c.residueStartIndex,m=c.residueEndIndex,y=new e.FragmentSeqBuilder(s);var g=s.structure.parent,b=c.sourceChainIndex,_=g&&b;var w=typeof r==="string"?{asymId:r}:r;var x=new i(w,_?g.data.chains:c);for(var C=0;C<p;C++){if(d[C]!==t||!x.isSatisfied(_?b[C]:C)){continue}var I=v[C],S=m[C],A=-1,k=-1;for(;I<S;I++){if(f[I]>=n.seqNumber){A=I;break}}if(I===S)continue;for(I=A;I<S;I++){if(f[I]>=o.seqNumber){break}}k=I;if(s.hasRange(h[A],l[k])){y.add(e.Fragment.ofIndexRange(s,h[A],l[k]))}}return y.getSeq()}}n.compileSequence=h;function l(){return function(t){var r=t.structure.data.residues,n=r.atomStartIndex,i=r.atomEndIndex,o=r.isHet,s=r.entityIndex,a=r.count,u=t.structure.data.entities.type,c="water",f=new e.FragmentSeqBuilder(t);for(var h=0;h<a;h++){if(!t.hasRange(n[h],i[h]))continue;if(u[s[h]]===c)continue;if(o[h]){f.add(e.Fragment.ofIndexRange(t,n[h],i[h]))}}return f.getSeq()}}n.compileHetGroups=l;function d(){return function(t){var r=t.structure.data.residues,n=r.atomStartIndex,i=r.atomEndIndex,o=t.structure.data.entities,s=o.type,a=o.count,u=o.residueStartIndex,c=o.residueEndIndex,f="polymer",h=0;for(var l=0;l<a;l++){if(s[l]!==f)continue;for(var d=u[l],p=c[l];d<p;d++){for(var v=n[d],m=i[d];v<m;v++){if(t.hasAtom(v))h++}}}if(!h)return e.FragmentSeq.empty(t);var y=new Int32Array(h),g=0;for(var l=0;l<a;l++){if(s[l]!==f)continue;for(var d=u[l],p=c[l];d<p;d++){for(var v=n[d],m=i[d];v<m;v++){if(t.hasAtom(v))y[g++]=v}}}return new e.FragmentSeq(t,[e.Fragment.ofArray(t,y[0],y)])}}n.compileNonHetPolymer=d;function p(t,r){return function(n){var i=n.structure.positions,o=i.x,s=i.y,a=i.z,u=i.count,c=[];for(var f=0;f<u;f++){if(!n.hasAtom(f))continue;var h=o[f],l=s[f],d=a[f];if(h>=t.x&&h<=r.x&&l>=t.y&&l<=r.y&&d>=t.z&&d<=r.z){c[c.length]=f}}if(!c.length)return e.FragmentSeq.empty(n);return new e.FragmentSeq(n,[new e.Fragment(n,c[0],c)])}}n.compileAtomsInBox=p;function v(t,n){var i=r.toQuery(t);var o=r.toQuery(n);return function(t){return new e.FragmentSeq(t,i(e.Context.ofFragments(o(t))).fragments)}}n.compileInside=v;function m(t,r,n){var i=0;for(var o=0,s=r.atomIndices;o<s.length;o++){var a=s[o];if(n.has(a))i++}if(!i)return void 0;var u=new Int32Array(i);var c=0;for(var f=0,h=r.atomIndices;f<h.length;f++){var a=h[f];if(n.has(a))u[c++]=a}return e.Fragment.ofArray(t,u[0],u)}function y(t,n){var i=r.toQuery(t);var o=r.toQuery(n);return function(t){var r=i(t);var n=e.Context.Mask.ofFragments(o(t));var s=new e.FragmentSeqBuilder(t);for(var a=0,u=r.fragments;a<u.length;a++){var c=u[a];var f=m(t,c,n);if(f)s.add(f)}return s.getSeq()}}n.compileIntersectWith=y;function g(t,n){var i=r.toQuery(t);return function(t){var r=i(t).fragments,o=new e.FragmentSeqBuilder(t),s;for(var a=0;a<r.length;a++){s=r[a];if(n(s))o.add(s)}return o.getSeq()}}n.compileFilter=g;function b(t){var n=r.toQuery(t);return function(t){var r=e.Context.Mask.ofFragments(n(t)),i=0,o=0;for(var s=0,a=t.structure.data.atoms.count;s<a;s++){if(t.hasAtom(s)&&!r.has(s))i++}if(!i)return e.FragmentSeq.empty(t);var u=new Int32Array(i);for(var s=0,a=t.structure.data.atoms.count;s<a;s++){if(t.hasAtom(s)&&!r.has(s))u[o++]=s}return new e.FragmentSeq(t,[e.Fragment.ofArray(t,u[0],u)])}}n.compileComplement=b;function _(t){var n=t.map(function(t){return r.toQuery(t)});return function(t){var r=new e.HashFragmentSeqBuilder(t);for(var i=0,o=n;i<o.length;i++){var s=o[i];var a=s(t);for(var u=0,c=a.fragments;u<c.length;u++){var f=c[u];r.add(f)}}return r.getSeq()}}n.compileOr=_;function w(n){var i=r.toQuery(n);return function(r){var n=i(r).fragments,o=t.Utils.FastSet.create(),s=0,a;for(var u=0;u<n.length;u++){a=n[u].atomIndices;for(s=0;s<a.length;s++)o.add(a[s])}if(o.size===0)return e.FragmentSeq.empty(r);return new e.FragmentSeq(r,[e.Fragment.ofSet(r,o)])}}n.compileUnion=w;function x(r,n){return function(i){var o=i.structure,s=o.data.entities,a=o.data.atoms.name,u=[],c=0;var f=t.Utils.FastSet.ofArray(r);if(n){for(var h=0;h<o.data.entities.count;h++){if(s.type[h]!=="polymer")continue;var l=s.atomStartIndex[h],d=s.atomEndIndex[h];for(var p=l;p<d;p++){if(i.hasAtom(p)&&!f.has(a[p]))u[c++]=p}}}else{for(var h=0;h<s.count;h++){if(s.type[h]!=="polymer")continue;var l=s.atomStartIndex[h],d=s.atomEndIndex[h];for(var p=l;p<d;p++){if(i.hasAtom(p)&&f.has(a[p]))u[c++]=p}}}if(!u.length)return e.FragmentSeq.empty(i);return new e.FragmentSeq(i,[e.Fragment.ofArray(i,u[0],new Int32Array(u))])}}n.compilePolymerNames=x;function C(n,i){var o=r.toQuery(n);return function(r){var n=o(r),s=r.tree,a=t.Geometry.SubdivisionTree3D.createContextRadius(s,i,false),u=a.buffer,c=new e.HashFragmentSeqBuilder(r),f=r.structure.positions,h=f.x,l=f.y,d=f.z,p=r.structure.data.atoms.residueIndex,v=r.structure.data.residues.atomStartIndex,m=r.structure.data.residues.atomEndIndex,y=s.data;for(var g=0,b=n.fragments;g<b.length;g++){var _=b[g];var w=t.Utils.FastSet.create();for(var x=0,C=_.atomIndices;x<C.length;x++){var I=C[x];w.add(p[I]);a.nearest(h[I],l[I],d[I],i);for(var S=0,A=u.count;S<A;S++){w.add(p[y[u.indices[S]]])}}var k={count:0,start:v,end:m};w.forEach(function(t,e){e.count+=e.end[t]-e.start[t]},k);var E=new Int32Array(k.count),P={indices:E,offset:0,start:v,end:m};w.forEach(function(t,e){for(var r=e.start[t],n=e.end[t];r<n;r++){e.indices[e.offset++]=r}},P);Array.prototype.sort.call(E,function(t,e){return t-e});c.add(e.Fragment.ofArray(r,E[0],E))}return c.getSeq()}}n.compileAmbientResidues=C;function I(n){var i=r.toQuery(n);return function(r){var n=i(r),o=new e.HashFragmentSeqBuilder(r),s=r.structure.data.atoms.residueIndex,a=r.structure.data.residues.atomStartIndex,u=r.structure.data.residues.atomEndIndex;for(var c=0,f=n.fragments;c<f.length;c++){var h=f[c];var l=t.Utils.FastSet.create();for(var d=0,p=h.atomIndices;d<p.length;d++){var v=p[d];l.add(s[v])}var m={count:0,start:a,end:u};l.forEach(function(t,e){e.count+=e.end[t]-e.start[t]},m);var y=new Int32Array(m.count),g={indices:y,offset:0,start:a,end:u};l.forEach(function(t,e){for(var r=e.start[t],n=e.end[t];r<n;r++){e.indices[e.offset++]=r}},g);Array.prototype.sort.call(y,function(t,e){return t-e});o.add(e.Fragment.ofArray(r,y[0],y))}return o.getSeq()}}n.compileWholeResidues=I;function S(t,n){var i=r.toQuery(t);return function(t){var r=i(t);var o=new e.HashFragmentSeqBuilder(t);for(var s=0,a=r.fragments;s<a.length;s++){var u=a[s];var c=n(u);for(var f=0,h=c.fragments;f<h.length;f++){var l=h[f];o.add(l)}}return o.getSeq()}}n.compileFlatten=S})(R=e.Compiler||(e.Compiler={}))})(r=e.Query||(e.Query={}))})(e=t.Structure||(t.Structure={}))})(e=t.Core||(t.Core={}))})(s||(s={}));/*
 * Copyright (c) 2016 - now David Sehnal, licensed under Apache 2.0, See LICENSE file for more info.
 */
var s;(function(t){var e;(function(t){var e;(function(e){var r;(function(e){var r;(function(r){function n(t){return function(e){return function(r,n){return t(e(r,n))}}}function i(t){return function(e,r){return function(n,i){return t(e(n,i),r(n,i))}}}r.not=n(function(t){return!t});r.and=i(function(t,e){return t&&e});r.or=i(function(t,e){return t||e});var o=t.Utils.FastSet.ofArray(["N","CA","C","O","P","OP1","OP2","O3'","O5'","C3'","C5'","C4"]);r.backbone=function(t,e){return r.entityType(t,e)==="polymer"&&o.has(r.atomName(t,e))};r.sidechain=function(t,e){return r.entityType(t,e)==="polymer"&&!o.has(r.atomName(t,e))};function s(t){return function(e,r){return function(n,i){return t(e(n,i),r(n,i))}}}r.equal=s(function(t,e){return t===e});r.notEqual=s(function(t,e){return t!==e});r.greater=s(function(t,e){return t>e});r.lesser=s(function(t,e){return t<e});r.greaterEqual=s(function(t,e){return t>=e});r.lesserEqual=s(function(t,e){return t<=e});function a(t,e,r){return function(n,i){var o=t(n,i);return o>=e&&o<=r}}r.inRange=a;function u(t){return function(){return t}}r.value=u;function c(t,e,r){return function(n,i){var o=n.structure;return r(e(o))[t(o.data.atoms)[i]]}}r.residueSeqNumber=c(function(t){return t.residueIndex},function(t){return t.data.residues},function(t){return t.seqNumber});r.residueName=c(function(t){return t.residueIndex},function(t){return t.data.residues},function(t){return t.name});r.elementSymbol=c(function(t){return t.indices},function(t){return t.data.atoms},function(t){return t.elementSymbol});r.atomName=c(function(t){return t.indices},function(t){return t.data.atoms},function(t){return t.name});r.entityType=c(function(t){return t.entityIndex},function(t){return t.data.entities},function(t){return t.type});function f(t){return e.Builder.build(function(){return function(r){var n=[];for(var i=0,o=r.structure.data.atoms.count;i<o;i++){if(r.hasAtom(i)&&t(r,i))n[n.length]=i}if(!n.length)return e.FragmentSeq.empty(r);return new e.FragmentSeq(r,[e.Fragment.ofArray(r,n[0],new Int32Array(n))])}})}r.query=f})(r=e.Algebraic||(e.Algebraic={}))})(r=e.Query||(e.Query={}))})(e=t.Structure||(t.Structure={}))})(e=t.Core||(t.Core={}))})(s||(s={}));return s.Core};if(typeof module==="object"&&typeof module.exports==="object"){module.exports=__LiteMol_Core()}else if(typeof define==="function"&&define.amd){define(["require"],function(t){return __LiteMol_Core()})}else{var __target=!!window?window:this;if(!__target.LiteMol)__target.LiteMol={};__target.LiteMol.Core=__LiteMol_Core()}